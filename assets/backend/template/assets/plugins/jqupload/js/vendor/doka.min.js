/* eslint-disable */

/*!
 * Doka 5.8.0
 * Copyright 2019 PQINA Inc - All Rights Reserved
 * Please visit https://pqina.nl/doka/ for further information
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Doka=e():t.Doka=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=function(t,e){return e.parentNode.insertBefore(t,e)},i=function(t,e){return e.parentNode.insertBefore(t,e.nextSibling)};function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a=function(t){return"object"===o(t)&&null!==t};function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){l(t,e,n[e])})}return t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])},f=function(t){var e={};return u(t,function(n){!function(t,e,n){"function"!=typeof n?Object.defineProperty(t,e,n):t[e]=n}(e,n,t[n])}),e},s=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===n)return t.getAttribute(e)||t.hasAttribute(e);t.setAttribute(e,n)};function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var h=["svg","path"],p=function(t){return h.includes(t)},g=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===d(e)&&(n=e,e=null);var r=p(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);return e&&(p(t)?s(r,"class",e):r.className=e),u(n,function(t,e){s(r,t,e)}),r},m=function(t,e){return function(t,n){return void 0!==n?e.splice(n,0,t):e.push(t),t}},y=function(t,e){return function(n){return e.splice(e.indexOf(n),1),n.element.parentNode&&t.removeChild(n.element),n}};function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){E(t,e,n[e])})}return t}function E(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var w=function(t,e,n,r){var i=n[0]||t.left,o=n[1]||t.top,a=i+t.width,c=o+t.height*(r[1]||1),l={element:v({},t),inner:{left:t.left,top:t.top,right:t.right,bottom:t.bottom},outer:{left:i,top:o,right:a,bottom:c}};return e.filter(function(t){return!t.isRectIgnored()}).map(function(t){return t.rect}).forEach(function(t){_(l.inner,v({},t.inner)),_(l.outer,v({},t.outer))}),T(l.inner),l.outer.bottom+=l.element.marginBottom,l.outer.right+=l.element.marginRight,T(l.outer),l},_=function(t,e){e.top+=t.top,e.right+=t.left,e.bottom+=t.top,e.left+=t.left,e.bottom>t.bottom&&(t.bottom=e.bottom),e.right>t.right&&(t.right=e.right)},T=function(t){t.width=t.right-t.left,t.height=t.bottom-t.top},b=function(t){return"number"==typeof t},O=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.stiffness,n=void 0===e?.5:e,r=t.damping,i=void 0===r?.75:r,o=t.mass,a=void 0===o?10:o,c=t.delay,l=void 0===c?0:c,u=null,s=null,d=0,h=!1,p=null,g=f({interpolate:function(t){if(null===p&&(p=t),!(t-l<p||h)){if(!b(u)||!b(s))return h=!0,void(d=0);!function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001;return Math.abs(t-e)<r&&Math.abs(n)<r}(s+=d+=-(s-u)*n/a,u,d*=i)?g.onupdate(s):(s=u,d=0,h=!0,g.onupdate(s),g.oncomplete(s))}},target:{set:function(t){if(b(t)&&!b(s)&&(s=t,p=null),null===u&&(u=t,s=t,p=null),h&&(p=null),s===(u=t)||void 0===u)return h=!0,d=0,p=null,g.onupdate(s),void g.oncomplete(s);h=!1},get:function(){return u}},resting:{get:function(){return h}},onupdate:function(){},oncomplete:function(){},position:{get:function(){return s}}});return g},x=function(t){return t<.5?2*t*t:(4-2*t)*t-1};function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function A(t){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var I={spring:O,tween:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.duration,i=void 0===r?500:r,o=n.easing,a=void 0===o?x:o,c=n.delay,l=void 0===c?0:c,u=null,s=!0,d=!1,h=null,p=f({interpolate:function(n){s||null===h||(null===u&&(u=n),n-u<l||((t=n-u-l)<i?(e=t/i,p.onupdate((t>=0?a(d?1-e:e):0)*h)):(t=1,e=d?0:1,p.onupdate(e*h),p.oncomplete(e*h),s=!0)))},target:{get:function(){return d?0:h},set:function(t){if(null===h)return h=t,p.onupdate(t),void p.oncomplete(t);t<h?(h=1,d=!0):(d=!1,h=t),s=!1,u=null}},resting:{get:function(){return s}},onupdate:function(){},oncomplete:function(){}});return p}},C=function(t,e,n){var r=t[e]&&"object"===A(t[e][n])?t[e][n]:t[e]||t,i="string"==typeof r?r:r.type,o="object"===A(r)?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){R(t,e,n[e])})}return t}({},r):{};return I[i]?I[i](o):null};function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var M=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(e=Array.isArray(e)?e:[e]).forEach(function(e){t.forEach(function(t){var i=t,o=function(){return n[t]},a=function(e){return n[t]=e};"object"===S(t)&&(i=t.key,o=t.getter||o,a=t.setter||a),e[i]&&!r||(e[i]={get:o,set:a})})})};function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){D(t,e,n[e])})}return t}function D(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var k={opacity:1,scaleX:1,scaleY:1,translateX:0,translateY:0,rotateX:0,rotateY:0,rotateZ:0,originX:0,originY:0},G=function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!0;for(var n in e)if(e[n]!==t[n])return!0;return!1},U=function(t,e){var n=e.opacity,r=e.perspective,i=e.translateX,o=e.translateY,a=e.scaleX,c=e.scaleY,l=e.rotateX,u=e.rotateY,f=e.rotateZ,s=e.originX,d=e.originY,h=e.width,p=e.height,g="",m="";null==s&&null==d||(m+="transform-origin: ".concat(s||0,"px ").concat(d||0,"px;")),null!=r&&(g+="perspective(".concat(r,"px) ")),null==i&&null==o||(g+="translate3d(".concat(i||0,"px, ").concat(o||0,"px, 0) ")),null==a&&null==c||(g+="scale3d(".concat(null!=a?a:1,", ").concat(null!=c?c:1,", 1) ")),null!=f&&(g+="rotateZ(".concat(f,"rad) ")),null!=l&&(g+="rotateX(".concat(l,"rad) ")),null!=u&&(g+="rotateY(".concat(u,"rad) ")),""!=g&&(m+="transform:".concat(g,";")),null!=n&&(m+="opacity:".concat(n,";"),n<1&&(m+="pointer-events:none;"),0===n&&"BUTTON"===t.nodeName&&(m+="visibility:hidden;")),null!=h&&(m+="width:".concat(h,"px;")),null!=p&&(m+="height:".concat(p,"px;"));var y=t.elementCurrentStyle||"";m.length===y.length&&m===y||(t.style.cssText=m,t.elementCurrentStyle=m)},V={styles:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,i=t.viewExternalAPI,o=t.view,a=P({},n),c={};M(e,[r,i],n);var l=function(){return o.rect?w(o.rect,o.childViews,[n.translateX||0,n.translateY||0],[n.scaleX||0,n.scaleY||0]):null};return r.rect={get:l},i.rect={get:l},e.forEach(function(t){n[t]=void 0===a[t]?k[t]:a[t]}),{write:function(){if(G(c,n))return U(o.element,n),Object.assign(c,P({},n)),!0},destroy:function(){}}},listeners:function(t){var e,n=t.viewExternalAPI,r=t.view,i=[],o=(e=r.element,function(t,n){e.addEventListener(t,n)}),a=function(t){return function(e,n){t.removeEventListener(e,n)}}(r.element);return n.on=function(t,e){i.push({type:t,fn:e}),o(t,e)},n.off=function(t,e){i.splice(i.findIndex(function(n){return n.type===t&&n.fn===e}),1),a(t,e)},{write:function(){return!0},destroy:function(){i.forEach(function(t){a(t.type,t.fn)})}}},animations:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewInternalAPI,i=t.viewExternalAPI,o=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){L(t,e,n[e])})}return t}({},n),a=[];return u(e,function(t,e){var c=C(e);c&&(c.onupdate=function(e){n[t]=e},c.target=o[t],M([{key:t,setter:function(t){c.target!==t&&(c.target=t)},getter:function(){return n[t]}}],[r,i],n,!0),a.push(c))}),{write:function(t){var e=!0;return a.forEach(function(n){n.resting||(e=!1),n.interpolate(t)}),e},destroy:function(){}}},apis:function(t){var e=t.mixinConfig,n=t.viewProps,r=t.viewExternalAPI;M(e,r,n)}},B=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.layoutCalculated||(t.paddingTop=parseInt(n.paddingTop,10)||0,t.marginTop=parseInt(n.marginTop,10)||0,t.marginRight=parseInt(n.marginRight,10)||0,t.marginBottom=parseInt(n.marginBottom,10)||0,t.marginLeft=parseInt(n.marginLeft,10)||0,e.layoutCalculated=!0),t.left=e.offsetLeft||0,t.top=e.offsetTop||0,t.width=e.offsetWidth||0,t.height=e.offsetHeight||0,t.right=t.left+t.width,t.bottom=t.top+t.height,t.scrollTop=e.scrollTop,t.hidden=null===e.offsetParent&&"fixed"!==n.position,t};function N(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){j(t,e,n[e])})}return t}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var F=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.tag,n=void 0===e?"div":e,r=t.name,i=void 0===r?null:r,o=t.attributes,a=void 0===o?{}:o,c=t.read,l=void 0===c?function(){}:c,u=t.write,s=void 0===u?function(){}:u,d=t.create,h=void 0===d?function(){}:d,p=t.destroy,v=void 0===p?function(){}:p,E=t.filterFrameActionsForChild,_=void 0===E?function(t,e){return e}:E,T=t.didCreateView,b=void 0===T?function(){}:T,O=t.didWriteView,x=void 0===O?function(){}:O,R=t.shouldUpdateChildViews,A=void 0===R?function(){return!0}:R,I=t.ignoreRect,C=void 0!==I&&I,S=t.ignoreRectUpdate,M=void 0!==S&&S,L=t.mixins,P=void 0===L?[]:L;return function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=g(n,i?"doka--".concat(i):null,a),c=window.getComputedStyle(o,null),u=B(),d=null,p=!1,E=[],T=[],O={},R={},I=[s],S=[l],L=[v],D=function(){return o},k=function(){return[].concat(E)},G=function(){return d||(d=w(u,E,[0,0],[1,1]))},U=function(){return o.layoutCalculated=!1},j={element:{get:D},style:{get:function(){return c}},childViews:{get:k}},F=N({},j,{rect:{get:G},ref:{get:function(){return O}},is:function(t){return i===t},appendChild:(e=o,function(t,n){void 0!==n&&e.children[n]?e.insertBefore(t,e.children[n]):e.appendChild(t)}),createChildView:function(t){return function(e,n){return e(t,n)}}(t),linkView:function(t){return E.push(t),t},unlinkView:function(t){E.splice(E.indexOf(t),1)},appendChildView:m(0,E),removeChildView:y(o,E),registerWriter:function(t){return I.push(t)},registerReader:function(t){return S.push(t)},registerDestroyer:function(t){return L.push(t)},invalidateLayout:U,dispatch:t.dispatch,query:t.query}),z={element:{get:D},childViews:{get:k},rect:{get:G},resting:{get:function(){return p}},isRectIgnored:function(){return C},invalidateLayout:U,_read:function(){d=null,A({root:q,props:r})&&E.forEach(function(t){return t._read()}),!(M&&u.width&&u.height)&&B(u,o,c);var t={root:q,props:r,rect:u};S.forEach(function(e){return e(t)})},_write:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0===e.length;return I.forEach(function(i){!1===i({props:r,root:q,actions:e,timestamp:t})&&(n=!1)}),T.forEach(function(e){!1===e.write(t)&&(n=!1)}),A({props:r,root:q,actions:e,timestamp:t})&&(E.filter(function(t){return!!t.element.parentNode}).forEach(function(r){r._write(t,_(r,e))||(n=!1)}),E.forEach(function(r,i){r.element.parentNode||(q.appendChild(r.element,i),r._read(),r._write(t,_(r,e)),n=!1)})),p=n,x({props:r,root:q,actions:e,timestamp:t}),n},_destroy:function(){T.forEach(function(t){return t.destroy()}),L.forEach(function(t){t({root:q})}),E.forEach(function(t){return t._destroy()})}},W=N({},j,{rect:{get:function(){return u}}});Object.keys(P).sort(function(t,e){return"styles"===t?1:"styles"===e?-1:0}).forEach(function(t){var e=V[t]({mixinConfig:P[t],viewProps:r,viewState:R,viewInternalAPI:F,viewExternalAPI:z,view:f(W)});e&&T.push(e)});var q=f(F);h({root:q,props:r});var Y=(o.children||[]).length;return E.forEach(function(t,e){q.appendChild(t.element,Y+e)}),b(q),f(z)}},z=function(t,e){return function(n){var r=n.root,i=n.props,o=n.actions,a=void 0===o?[]:o,c=n.timestamp;if(a.filter(function(e){return t[e.type]}).forEach(function(e){return t[e.type]({root:r,props:i,action:e.data,timestamp:c})}),e)return e({root:r,props:i,actions:a,timestamp:c})}},W=function(t){return Array.isArray(t)},q=function(t){return null==t},Y=function(t){return t.trim()},H=function(t){return""+t},Z=function(t){return"boolean"==typeof t},X=function(t){return"string"==typeof t},K=function(t){return b(t)?t:X(t)?H(t).replace(/[a-z]+/gi,""):0},Q=function(t){return parseInt(K(t),10)},J=function(t){return b(t)&&isFinite(t)&&Math.floor(t)===t},$=function(t){if(J(t))return t;var e=H(t).trim();return/MB$/i.test(e)?(e=e.replace(/MB$i/,"").trim(),1e3*Q(e)*1e3):/KB/i.test(e)?(e=e.replace(/KB$i/,"").trim(),1e3*Q(e)):Q(e)};function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var et=function(t){return W(t)?"array":function(t){return null===t}(t)?"null":J(t)?"int":/^[0-9]+ ?(?:GB|MB|KB)$/gi.test(t)?"bytes":tt(t)},nt={array:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return q(t)?[]:W(t)?t:H(t).split(e).map(Y).filter(function(t){return t.length})},boolean:function(t){return Z(t)?t:"true"===t},int:function(t){return"bytes"===et(t)?$(t):Q(t)},float:function(t){return parseFloat(K(t))},bytes:$,string:function(t){return function(t){return"function"==typeof t}(t)?t:H(t)},object:function(t){try{return JSON.parse(t.replace(/{\s*'/g,'{"').replace(/'\s*}/g,'"}').replace(/'\s*:/g,'":').replace(/:\s*'/g,':"').replace(/,\s*'/g,',"').replace(/'\s*,/g,'",'))}catch(e){return t}},file:function(t){return t},function:function(t){return function(t){for(var e=self,n=t.split("."),r=null;r=n.shift();)if(!(e=e[r]))return null;return e}(t)}},rt=function(t,e,n){if(t===e)return t;var r,i=et(t);if(i!==n){var o=(r=t,nt[n](r));if(i=et(o),null===o)throw'Trying to assign value with incorrect type, allowed type: "'.concat(n,'"');t=o}return t},it=function(t){var e={};return u(t,function(n){var r,i,o,a=X(t[n])?t[n]:n,c=t[a];a===n?e[n]=(r=c[0],i=c[1],o=r,{enumerable:!0,get:function(){return o},set:function(t){o=rt(t,r,i)}}):e[n]=e[a]}),f(e)},ot=function(t){t.file=null,t.activeView=null,t.markup=[],t.rootRect={x:0,y:0,left:0,top:0,width:0,height:0},t.stage=null,t.stageOffset=null,t.image=null,t.zoomTimeoutId=null,t.instantUpdate=!1,t.filePromise=null,t.fileLoader=null,t.instructions={size:null,crop:null,filter:null,color:null},t.filter=null,t.filterName=null,t.filterValue=null,t.colorValues={},t.colorMatrices={},t.size={width:!1,height:!1,aspectRatioLocked:!0,aspectRatioPrevious:!1},t.crop={rectangle:null,transforms:null,rotation:null,flip:null,aspectRatio:null,isRotating:!1,isDirty:!1,limitToImageBounds:!0,draft:{rectangle:null,transforms:null}}},at=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.split(/(?=[A-Z])/).map(function(t){return t.toLowerCase()}).join(e)},ct=function(t){return function(e,n,r){var i={};return u(t,function(t){var n=at(t,"_").toUpperCase();i["SET_".concat(n)]=function(i){var o;try{o=r.options[t],r.options[t]=i.value}catch(t){}e("DID_SET_".concat(n),{value:r.options[t],prevValue:o})}}),i}},lt=function(t){return function(e){var n={};return u(t,function(t){n["GET_".concat(at(t,"_").toUpperCase())]=function(){return e.options[t]}}),n}},ut=function(){return Math.random().toString(36).substr(2,9)},ft=function(){var t=[],e=function(e,n){var r,i;r=t,i=t.findIndex(function(t){return t.event===e&&(t.cb===n||!n)}),r.splice(i,1)};return{fire:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.filter(function(t){return t.event===e}).map(function(t){return t.cb}).forEach(function(t){setTimeout(function(){t.apply(void 0,r)},0)})},on:function(e,n){t.push({event:e,cb:n})},onOnce:function(n,r){t.push({event:n,cb:function(){e(n,r),r.apply(void 0,arguments)}})},off:e}},st="boolean",dt="int",ht="number",pt="string",gt="array",mt="object",yt="function",vt="file",Et="undefined"!=typeof window&&void 0!==window.document,wt=function(){return Et},_t=null,Tt=function(){return null===_t&&(_t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream),_t};function bt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ot=function(){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){bt(t,e,n[e])})}return t}({},Rt)},xt=function(t,e){t=function(t){return X(Rt[t])?Rt[t]:t}(t),Rt[t][0]=rt(e,Rt[t][0],Rt[t][1])},Rt={id:[null,pt],className:[null,pt],src:[null,vt],maxImagePreviewWidth:[1500,dt],maxImagePreviewHeight:[1500,dt],allowPreviewFitToView:[!0,st],allowButtonCancel:[!0,st],allowButtonConfirm:[!0,st],allowDropFiles:[!1,st],allowBrowseFiles:[!0,st],allowAutoClose:[!0,st],allowAutoDestroy:[!1,st],utils:[["crop","filter","color","markup"],gt],initialState:[null,mt],outputData:[!1,st],outputFile:[!0,st],outputCorrectImageExifOrientation:[!0,st],outputStripImageHead:[!0,st],outputType:[null,pt],outputQuality:[null,dt],outputFit:["cover",pt],outputUpscale:[!0,st],outputWidth:[null,dt],outputHeight:[null,dt],outputCanvasBackgroundColor:[null,pt],outputCanvasMemoryLimit:[wt()&&Tt()?16777216:null,dt],size:[null,mt],sizeMin:[{width:1,height:1},mt],sizeMax:[{width:9999,height:9999},mt],filter:[null,mt],filters:[{original:{label:"Original",matrix:function(){return null}},chrome:{label:"Chrome",matrix:function(){return[1.398,-.316,.065,-.273,.201,-.051,1.278,-.08,-.273,.201,-.051,.119,1.151,-.29,.215,0,0,0,1,0]}},fade:{label:"Fade",matrix:function(){return[1.073,-.015,.092,-.115,-.017,.107,.859,.184,-.115,-.017,.015,.077,1.104,-.115,-.017,0,0,0,1,0]}},mono:{label:"Mono",matrix:function(){return[.212,.715,.114,0,0,.212,.715,.114,0,0,.212,.715,.114,0,0,0,0,0,1,0]}},noir:{label:"Noir",matrix:function(){return[.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,.15,1.3,-.25,.1,-.2,0,0,0,1,0]}}},mt],crop:[null,mt],cropShowSize:[!1,st],cropZoomTimeout:[null,dt],cropMask:[null,yt],cropMaskInset:[0,dt],cropAllowImageTurnLeft:[!0,st],cropAllowImageTurnRight:[!1,st],cropAllowImageFlipHorizontal:[!0,st],cropAllowImageFlipVertical:[!0,st],cropAllowToggleLimit:[!1,st],cropLimitToImageBounds:[!0,st],cropResizeMatchImageAspectRatio:[!1,st],cropResizeKeyCodes:[[18,91,92,93],gt],cropResizeScrollRectOnly:[!1,st],cropAspectRatio:[null,pt],cropAspectRatioOptions:[null,gt],cropMinImageWidth:[1,dt],cropMinImageHeight:[1,dt],colorBrightness:[0,ht],colorBrightnessRange:[[-.25,.25],gt],colorContrast:[1,ht],colorContrastRange:[[.5,1.5],gt],colorExposure:[1,ht],colorExposureRange:[[.5,1.5],gt],colorSaturation:[1,ht],colorSaturationRange:[[0,2],gt],markup:[null,gt],markupFilter:[function(){return!0},yt],markupAllowAddMarkup:[!0,st],markupFontSizeDefault:[2,ht],markupFontSizeOptions:[[["XL",.15],["L",.125],["M",.1],["S",.075],["XS",.05]],gt],markupFontFamilyDefault:[1,dt],markupFontFamilyOptions:[[["Serif","Palatino, 'Times New Roman', serif"],["Sans Serif","Helvetica, Arial, Verdana"],["Monospaced","Monaco, 'Lucida Console', monospaced"]],gt],markupShapeStyleDefault:[2,dt],markupShapeStyleOptions:[[["Fill",0,null,0],["Outline thick",.025,null,4],["Outline default",.015,null,2],["Outline thin",.005,null,1],["Outline dashed",.005,[.01],1]],gt],markupLineStyleDefault:[1,dt],markupLineStyleOptions:[[["Thick",.025,null,4],["Default",.015,null,2],["Thin",.005,null,1],["Dashed",.005,[.01],1]],gt],markupLineDecorationDefault:[1,dt],markupLineDecorationOptions:[[["None",[]],["Single arrow",["arrow-end"]],["Double arrow",["arrow-begin","arrow-end"]]],gt],markupColorDefault:[0,dt],markupColorOptions:[[["White","#fff","#f6f6f6"],["Silver","#9e9e9e"],["Black","#000","#333"],["Red","#f44336"],["Orange","#ff9800"],["Yellow","#ffeb3b"],["Green","#4caf50"],["Blue","#2196f3"],["Violet","#3f51b5"],["Purple","#9c27b0"]],gt],beforeCreateBlob:[null,yt],afterCreateBlob:[null,yt],onconfirm:[null,yt],oncancel:[null,yt],onclose:[null,yt],onloadstart:[null,yt],onload:[null,yt],onloaderror:[null,yt],onupdate:[null,yt],oninit:[null,yt],ondestroy:[null,yt],labelButtonReset:["Reset",pt],labelButtonCancel:["Cancel",pt],labelButtonConfirm:["Done",pt],labelButtonUtilCrop:["Crop",pt],labelButtonUtilResize:["Resize",pt],labelButtonUtilFilter:["Filter",pt],labelButtonUtilColor:["Colors",pt],labelButtonUtilMarkup:["Markup",pt],labelStatusMissingWebGL:["WebGL is required but is disabled on your browser",pt],labelStatusAwaitingImage:["Waiting for image…",pt],labelStatusLoadImageError:["Error loading image…",pt],labelStatusLoadingImage:["Loading image…",pt],labelStatusProcessingImage:["Processing image…",pt],labelColorBrightness:["Brightness",pt],labelColorContrast:["Contrast",pt],labelColorExposure:["Exposure",pt],labelColorSaturation:["Saturation",pt],labelMarkupTypeRectangle:["Square",pt],labelMarkupTypeEllipse:["Circle",pt],labelMarkupTypeText:["Text",pt],labelMarkupTypeLine:["Arrow",pt],labelMarkupSelectFontSize:["Size",pt],labelMarkupSelectFontFamily:["Font",pt],labelMarkupSelectLineDecoration:["Decoration",pt],labelMarkupSelectLineStyle:["Style",pt],labelMarkupSelectShapeStyle:["Style",pt],labelMarkupRemoveShape:["Remove",pt],labelButtonCropZoom:["Zoom",pt],labelButtonCropRotateLeft:["Rotate left",pt],labelButtonCropRotateRight:["Rotate right",pt],labelButtonCropRotateCenter:["Center rotation",pt],labelButtonCropFlipHorizontal:["Flip horizontal",pt],labelButtonCropFlipVertical:["Flip vertical",pt],labelButtonCropAspectRatio:["Aspect ratio",pt],labelButtonCropToggleLimit:["Crop selection",pt],labelButtonCropToggleLimitEnable:["Limited to image",pt],labelButtonCropToggleLimitDisable:["Select outside image",pt],pointerEventsPolyfillScope:["root",pt],styleCropCorner:["circle",pt],styleFullscreenSafeArea:[wt()&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?"bottom":"none",pt],styleLayoutMode:[null,pt]},At=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(n,Math.max(e,t))},It=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return parseFloat(t.toFixed(e))},Ct=function(t,e){return{x:It(t.x,e),y:It(t.y,e)}},St=function(t,e){return kt(t.x-e.x,t.y-e.y)},Mt=function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(St(t,e),St(t,e))},Lt=function(t,e){return Math.sqrt(Mt(t,e))},Pt=function(t,e){return kt(At(t.x,e.x,e.x+e.width),At(t.y,e.y,e.y+e.height))},Dt=function(t,e,n){var r=Math.cos(e),i=Math.sin(e),o=kt(t.x-n.x,t.y-n.y);return kt(n.x+r*o.x-i*o.y,n.y+i*o.x+r*o.y)},kt=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},Gt=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},Ut=function(t,e,n){return qt(e*(t.x-n.x)+n.x,e*(t.y-n.y)+n.y,e*t.width,e*t.height)},Vt=function(t,e){return qt(t.x+e.x,t.y+e.y,t.width,t.height)},Bt={translate:Vt,rotate:function(t,e,n){var r=function(t,e,n){return 0===e?{tl:t.tl,tr:t.tr,br:t.br,bl:t.bl}:{tl:Dt(t.tl,e,n),tr:Dt(t.tr,e,n),br:Dt(t.br,e,n),bl:Dt(t.bl,e,n)}}(Wt(t),e,n),i=r.tl,o=r.tr,a=r.br,c=r.bl,l=Math.min(i.x,o.x,a.x,c.x),u=Math.min(i.y,o.y,a.y,c.y),f=Math.max(i.x,o.x,a.x,c.x),s=Math.max(i.y,o.y,a.y,c.y);return qt(l,u,f-l,s-u)},scale:Ut},Nt=function(t){return qt(t.x,t.y,t.width,t.height)},jt=function(t){return{top:t.y,right:t.x+t.width,bottom:t.y+t.height,left:t.x}},Ft=function(t){var e=t.top,n=t.right,r=t.bottom,i=t.left;return{x:i,y:e,width:n-i,height:r-e}},zt=function(t){return kt(t.x+.5*t.width,t.y+.5*t.height)},Wt=function(t){return{tl:{x:t.x,y:t.y},tr:{x:t.x+t.width,y:t.y},br:{x:t.x+t.width,y:t.y+t.height},bl:{x:t.x,y:t.y+t.height}}},qt=function(t,e,n,r){return{x:t,y:e,width:n,height:r}},Yt=function(t){if(q(t))return t;if(/:/.test(t)){var e=t.split(":"),n=e[0];return e[1]/n}return parseFloat(t)},Ht=function(t,e){var n=t.width,r=n*e;return r>t.height&&(n=(r=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-r),width:n,height:r}},Zt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=t.height/t.width,i=e,o=1,a=r;a>i&&(o=(a=i)/r);var c=Math.max(1/o,i/a),l=t.width/(n*c*o);return{width:l,height:l*e}},Xt=function(t,e){return{x:t,y:e}},Kt=function(t,e){return Xt(t.x-e.x,t.y-e.y)},Qt=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(Kt(t,e),Kt(t,e))}(t,e))},Jt=function(t,e){var n=t,r=e,i=1.5707963267948966-e,o=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(i),l=Math.cos(i),u=n/o;return Xt(l*(u*a),l*(u*c))},$t=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},i=r.x>.5?1-r.x:r.x,o=r.y>.5?1-r.y:r.y,a=2*i*t.width,c=2*o*t.height,l=function(t,e){var n=t.width,r=t.height,i=Jt(n,e),o=Jt(r,e),a=Xt(t.x+Math.abs(i.x),t.y-Math.abs(i.y)),c=Xt(t.x+t.width+Math.abs(o.y),t.y+Math.abs(o.x)),l=Xt(t.x-Math.abs(o.y),t.y+t.height-Math.abs(o.x));return{width:Qt(a,c),height:Qt(a,l)}}(e,n);return Math.max(l.width/a,l.height/c)},te=function(t,e){var n=e.origin,r=e.translation;return function(t,e,n){return e.reduce(function(t,e){return(0,Bt[e[0]])(t,e[1],n)},t)}(t,[["scale",e.scale],["translate",r]],n)},ee=function(t,e){var n=t,r=e,i=1.5707963267948966-e,o=Math.sin(1.5707963267948966),a=Math.sin(r),c=Math.sin(i),l=Math.cos(i),u=n/o;return kt(l*(u*a),l*(u*c))},ne=function(t,e){var n=t.width,r=t.height,i=e%(Math.PI/2),o=ee(n,i),a=ee(r,i),c=Wt(t);return{tl:kt(c.tl.x+Math.abs(o.x),c.tl.y-Math.abs(o.y)),tr:kt(c.tr.x+Math.abs(a.y),c.tr.y+Math.abs(a.x)),br:kt(c.br.x-Math.abs(o.x),c.br.y+Math.abs(o.y)),bl:kt(c.bl.x-Math.abs(a.y),c.bl.y-Math.abs(a.x))}},re=function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=n.origin,o=n.translation,a=te(t,n),c={x:i.x+o.x,y:i.y+o.y},l=2*Math.PI+n.rotation%(2*Math.PI),u=ne(e,l),f=Dt(u.tl,-l,c),s=Dt(u.tr,-l,c),d=Dt(u.br,-l,c),h={x:Math.min(f.x,s.x,d.x),y:Math.min(f.y,s.y,d.y),width:Math.max(f.x,s.x,d.x)-Math.min(f.x,s.x,d.x),height:Math.max(f.y,s.y,d.y)-Math.min(f.y,s.y,d.y)},p=qt(h.x,h.y,h.width,h.height),g=zt(p),m=e.height/e.width,y={x:(g.x-a.x)/a.width,y:(g.y-a.y)/a.height},v=y.y>.5?1-y.y:y.y,E=2*(y.x>.5?1-y.x:y.x)*a.width,w=2*v*a.height;return{center:y,zoom:r?Math.min(E/p.width,w/p.height):Math.min(a.width/p.width,a.height/p.height),rotation:n.rotation,aspectRatio:m,scaleToFit:r}};function ie(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){oe(t,e,n[e])})}return t}function oe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ae=function(t,e){var n=ce(t,e);return{center:{x:It(n.center.x),y:It(n.center.y)},rotation:It(n.rotation),zoom:It(n.zoom),aspectRatio:It(n.aspectRatio),flip:ie({},e.flip),scaleToFit:n.scaleToFit}},ce=function(t,e){var n=re(t,e.rectangle,e.transforms,e.limitToImageBounds);return{center:{x:n.center.x,y:n.center.y},rotation:n.rotation,zoom:n.zoom,aspectRatio:n.aspectRatio,flip:ie({},e.flip),scaleToFit:n.scaleToFit}},le=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"width",o=t.width,a=t.height;if(!o&&!a)return{width:o,height:a};if(o=o&&At(o,e.width,n.width),a=a&&At(a,e.height,n.height),!r)return{width:o,height:a};if(a)if(o)"width"===i?a=o/r:"height"===i?o=a*r:(a*r<e.width?a=(o=e.width)/r:o/r<e.height&&(o=(a=e.height)*r),a*r>n.width?a=(o=n.width)/r:o/r>n.height&&(o=(a=n.height)*r));else{a=At(a*r,e.width,n.width)/r}else o=At(o/r,e.height,n.height)*r;return{width:o,height:a}},ue=function(t){var e;if(/^#/.test(t)){if(4===t.length){var n=t.split("");t="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]}var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);e=[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]}else if(/^rgb/.test(t)){(e=t.match(/\d+/g).map(function(t){return parseInt(t,10)})).length=3}return e};function fe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){se(t,e,n[e])})}return t}function se(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function de(t){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function he(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var pe=[],ge=function(t){var e=[];return u(t,function(t,n){return e.push(n)}),e.length?e.reduce(function(t,e){return n=he(t),r=e,(i=new Array(20))[0]=n[0]*r[0]+n[1]*r[5]+n[2]*r[10]+n[3]*r[15],i[1]=n[0]*r[1]+n[1]*r[6]+n[2]*r[11]+n[3]*r[16],i[2]=n[0]*r[2]+n[1]*r[7]+n[2]*r[12]+n[3]*r[17],i[3]=n[0]*r[3]+n[1]*r[8]+n[2]*r[13]+n[3]*r[18],i[4]=n[0]*r[4]+n[1]*r[9]+n[2]*r[14]+n[3]*r[19]+n[4],i[5]=n[5]*r[0]+n[6]*r[5]+n[7]*r[10]+n[8]*r[15],i[6]=n[5]*r[1]+n[6]*r[6]+n[7]*r[11]+n[8]*r[16],i[7]=n[5]*r[2]+n[6]*r[7]+n[7]*r[12]+n[8]*r[17],i[8]=n[5]*r[3]+n[6]*r[8]+n[7]*r[13]+n[8]*r[18],i[9]=n[5]*r[4]+n[6]*r[9]+n[7]*r[14]+n[8]*r[19]+n[9],i[10]=n[10]*r[0]+n[11]*r[5]+n[12]*r[10]+n[13]*r[15],i[11]=n[10]*r[1]+n[11]*r[6]+n[12]*r[11]+n[13]*r[16],i[12]=n[10]*r[2]+n[11]*r[7]+n[12]*r[12]+n[13]*r[17],i[13]=n[10]*r[3]+n[11]*r[8]+n[12]*r[13]+n[13]*r[18],i[14]=n[10]*r[4]+n[11]*r[9]+n[12]*r[14]+n[13]*r[19]+n[14],i[15]=n[15]*r[0]+n[16]*r[5]+n[17]*r[10]+n[18]*r[15],i[16]=n[15]*r[1]+n[16]*r[6]+n[17]*r[11]+n[18]*r[16],i[17]=n[15]*r[2]+n[16]*r[7]+n[17]*r[12]+n[18]*r[17],i[18]=n[15]*r[3]+n[16]*r[8]+n[17]*r[13]+n[18]*r[18],i[19]=n[15]*r[4]+n[16]*r[9]+n[17]*r[14]+n[18]*r[19]+n[19],i;var n,r,i},e.shift()):[]},me=function(t){return t.crop.draft.transforms?t.crop.draft.transforms.scale:t.crop.transforms.scale},ye=function(t){var e=t.image.width/t.image.naturalWidth,n=me(t);return{width:t.options.cropMinImageWidth*n*e,height:t.options.cropMinImageHeight*n*e}},ve=function(t){var e=me(t);return{width:t.image.width*e,height:t.image.height*e}},Ee=function(t){return t.options.cropAspectRatioOptions?t.options.cropAspectRatioOptions.map(function(t){var e={aspectRatio:null,width:null,height:null};return"number"==typeof t.value&&(e.aspectRatio=t.value),"string"==typeof t.value&&(e.aspectRatio=Yt(t.value)),"object"===de(t.value)&&null!==t.value&&(e.width=t.value.width,e.height=t.value.height,e.aspectRatio=e.height/e.width),{label:t.label,value:e}}):null},we=function(t){return{ALLOW_MANUAL_RESIZE:function(){return t.options.utils.includes("resize")},GET_SIZE:function(){return!1!==t.size.width&&!1!==t.size.height?{width:t.size.width,height:t.size.height}:{width:null,height:null}},GET_SIZE_INPUT:function(){return{width:t.size.width,height:t.size.height}},GET_SIZE_ASPECT_RATIO_LOCK:function(){return t.size.aspectRatioLocked},IS_ACTIVE_VIEW:function(e){return t.activeView===e},GET_ACTIVE_VIEW:function(){return t.activeView},GET_STYLES:function(){return Object.keys(t.options).filter(function(t){return/^style/.test(t)}).map(function(e){return{name:e,value:t.options[e]}})},GET_FILE:function(){return t.file},GET_IMAGE:function(){return t.image},GET_STAGE:function(){return fe({},t.stage,t.stageOffset)},GET_ROOT:function(){return t.rootRect},GET_ROOT_SIZE:function(){return{width:t.rootRect.width,height:t.rootRect.height}},GET_MIN_IMAGE_SIZE:function(){return{width:t.options.cropMinImageWidth,height:t.options.cropMinImageHeight}},GET_IMAGE_PREVIEW_SCALE_FACTOR:function(){return t.image.width/t.image.naturalWidth},GET_MIN_PREVIEW_IMAGE_SIZE:function(){var e=t.image.width/t.image.naturalWidth;return{width:t.options.cropMinImageWidth*e,height:t.options.cropMinImageHeight*e}},GET_MIN_CROP_SIZE:function(){return ye(t)},GET_MAX_CROP_SIZE:function(){return ve(t)},GET_MIN_PIXEL_CROP_SIZE:function(){var e=t.crop.transforms.scale,n=ye(t);return{width:n.width/e,height:n.height/e}},GET_MAX_PIXEL_CROP_SIZE:function(){var e=t.crop.transforms.scale,n=ve(t);return{width:n.width/e,height:n.height/e}},GET_CROP_ASPECT_RATIO_OPTIONS:function(){return Ee(t)},GET_ACTIVE_CROP_ASPECT_RATIO:function(){var e=t.crop.aspectRatio;return X(e)?Yt(e):e},GET_CROP_ASPECT_RATIO:function(){var e=X(t.options.cropAspectRatio)?Yt(t.options.cropAspectRatio):t.options.cropAspectRatio,n=Ee(t);return!n||n&&!n.length?e:n.find(function(t){return t.value.aspectRatio===e})?e:n[0].value.aspectRatio},GET_CROP_RECTANGLE_ASPECT_RATIO:function(){var e=t.crop,n=e.rectangle,r=e.aspectRatio;return n?n.width/n.height:r},GET_CROP_FLIP:function(){return t.crop.flip?fe({},t.crop.flip):fe({},t.instructions.crop.flip)},GET_CROP_ROTATION:function(){return fe({},t.crop.rotation)},GET_CROP:function(e,n){var r=pe[e];if(r&&r.ts===n)return r;var i=Re(t);return i&&(i.ts=n,pe[e]=i),i},GET_COLOR_MATRIX:function(){return ge(t.colorMatrices)},GET_COLOR_VALUES:function(){return fe({exposure:t.options.colorExposure,brightness:t.options.colorBrightness,contrast:t.options.colorContrast,saturation:t.options.colorSaturation},t.colorValues)},GET_PREVIEW_IMAGE_DATA:function(){return t.file.preview},GET_THUMB_IMAGE_DATA:function(){return t.file.thumb},GET_FILTER:function(){return t.filter},GET_UID:function(){return t.uid},GET_MARKUP_BY_ID:function(e){return t.markup.find(function(t){return t[1].id===e})},GET_BACKGROUND_COLOR:function(){var e=t.options.outputCanvasBackgroundColor;if(!e)return Te;if(_e[e])return _e[e];var n=ue(e);return _e[e]=n.concat(1),_e[e]}}},_e={},Te=[0,0,0,0],be=function(t,e){var n=function(t){return!1===t.size.width?function(t){return t.options.size?t.options.size.width:null}(t):t.size.width}(t),r=function(t){return!1===t.size.height?function(t){return t.options.size?t.options.size.height:null}(t):t.size.height}(t),i=e.width/e.height;return le({width:n,height:r},t.options.sizeMin,t.options.sizeMax,i)},Oe=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.zoom,i=e.rotation,o=e.center,a=e.aspectRatio,c=Zt(t,a,r),l={x:.5*c.width,y:.5*c.height},u={x:0,y:0,width:c.width,height:c.height,center:l},f=r*$t(t,Ht(u,a),i,n?o:{x:.5,y:.5});return{widthFloat:c.width/f,heightFloat:c.height/f,width:Math.round(c.width/f),height:Math.round(c.height/f)}},xe=function(t,e){var n,r,i=zt(e),o=zt(t);return r=i,!(It((n=o).x)===It(r.x)&&It(n.y)===It(r.y))},Re=function(t){if(!t.stage||!t.image)return null;var e=t.crop.draft.rectangle||{free:t.crop.rectangle,limited:t.crop.rectangle},n=t.crop.draft.transforms||t.crop.transforms,r=n.origin,i=n.translation,o=n.scale,a=n.interaction,c=t.crop.rotation,l=t.crop.flip,f=!(!t.crop.draft.rectangle&&!t.crop.draft.transforms),s=f||t.instantUpdate,d=xe(e.limited,t.stage),h=t.crop.isDirty||f,p=t.crop.isRotating,g=void 0===t.crop.limitToImageBounds||t.crop.limitToImageBounds,m={width:t.image.naturalWidth,height:t.image.naturalHeight},y=ge(t.colorMatrices),v={crop:Oe(m,ce(t.image,{rectangle:e.limited,transforms:{origin:r,translation:i,scale:o,rotation:c.main+c.sub},flip:l,limitToImageBounds:t.crop.limitToImageBounds}),t.crop.limitToImageBounds),image:be(t,e.limited)},E=v.image,w=v.crop,_=w.width,T=w.height,b=w.widthFloat/w.heightFloat;E.width&&E.height?(_=E.width,T=E.height):E.width&&!E.height?(_=E.width,T=E.width/b):E.height&&!E.width&&(T=E.height,_=E.height*b),v.currentWidth=Math.round(_),v.currentHeight=Math.round(T);var O={x:0,y:0},x=0,R=0;if(s&&a){if(a.translation){var A=a.translation.x-i.x,I=a.translation.y-i.y;O.x=100*Math.sign(A)*Math.log10(1+Math.abs(A)/100),O.y=100*Math.sign(I)*Math.log10(1+Math.abs(I)/100)}if(a.scale){var C=a.scale-o;x=.25*Math.sign(C)*Math.log10(1+Math.abs(C)/.25)}if(a.rotation){var S=a.rotation-(c.main+c.sub);R=.05*Math.sign(S)*Math.log10(1+Math.abs(S)/.05)}}var M={},L=e.free,P=jt(L),D=jt(e.limited);return u(P,function(t){var e=P[t]-D[t];M[t]=D[t]+5*Math.sign(e)*Math.log10(1+Math.abs(e)/5)}),{canRecenter:d,canReset:h,isDraft:s,isRotating:p,isLimitedToImageBounds:g,cropRect:{x:M.left,y:M.top,width:M.right-M.left,height:M.bottom-M.top},origin:r,translation:i,translationBand:O,scale:o,scaleBand:x,rotation:c,rotationBand:R,flip:l,interaction:a,cropStatus:v,colorMatrix:y,markup:t.markup}},Ae=function(t,e){if(1165519206!==t.getUint32(e+=2,!1))return-1;var n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);var r=t.getUint16(e,n);e+=2;for(var i=0;i<r;i++)if(274===t.getUint16(e+12*i,n))return t.getUint16(e+12*i+8,n)},Ie=function(t){return new Promise(function(e){var n=new FileReader;n.onload=function(){return e(function(t){var e=new DataView(t);if(65496!=e.getUint16(0,!1))return null;for(var n,r=e.byteLength,i=2;i<r;){if(e.getUint16(i+2,!1)<=8)return-1;if(n=e.getUint16(i,!1),i+=2,65505===n)return Ae(e,i);if(65280!=(65280&n))return null;i+=e.getUint16(i,!1)}}(n.result)||-1)},n.readAsArrayBuffer(t.slice(0,262144))})},Ce=1,Se=2,Me=function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=t.center,o=t.zoom,a=t.aspectRatio,c=zt(e),l={x:c.x-n.width*i.x,y:c.y-n.height*i.y},u=2*Math.PI+t.rotation%(2*Math.PI),f=o*$t(n,Ht(e,a||n.height/n.width),u,r?i:{x:.5,y:.5});return{origin:{x:i.x*n.width,y:i.y*n.height},translation:l,scale:f,rotation:t.rotation}};function Le(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Pe(t,e,n[e])})}return t}function Pe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var De=function(t){return{origin:Le({},t.origin),translation:Le({},t.translation),rotation:t.rotation,scale:t.scale}};function ke(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ge(t,e,n[e])})}return t}function Ge(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ue=function(t,e,n,r){var i,o,a,c=n.translation,l=n.scale,u=n.rotation,f=n.origin,s={origin:ke({},f),translation:ke({},c),scale:l,rotation:2*Math.PI+u%(2*Math.PI)},d=t.height/t.width,h={x:f.x+c.x,y:f.y+c.y},p=ne(e,s.rotation),g=Dt(p.tl,-s.rotation,h),m=Dt(p.tr,-s.rotation,h),y=Dt(p.br,-s.rotation,h),v=Dt(p.bl,-s.rotation,h),E={x:Math.min(g.x,m.x,y.x,v.x),y:Math.min(g.y,m.y,y.y,v.y),width:Math.max(g.x,m.x,y.x,v.x)-Math.min(g.x,m.x,y.x,v.x),height:Math.max(g.y,m.y,y.y,v.y)-Math.min(g.y,m.y,y.y,v.y)},w=qt(E.x,E.y,E.width,E.height),_=zt(w),T=jt(w),b=te(t,n),O=zt(b),x={x:b.x,y:b.y},R={x:O.x,y:O.y},A=_.x,I=_.y,C={x:x.x,y:x.y,width:b.width,height:b.height};if(i=b,o=jt(w),a=jt(i),!(o.left>=a.left&&o.top>=a.top&&o.bottom<=a.bottom&&o.right<=a.right))if("moving"===r){C.y>w.y?C.y=w.y:C.y+C.height<T.bottom&&(C.y=T.bottom-C.height),C.x>w.x?C.x=w.x:C.x+C.width<T.right&&(C.x=T.right-C.width);var S=te(t,ke({},n,{scale:s.scale})),M=zt(S);R.x=M.x,R.y=M.y,x.x=S.x,x.y=S.y,C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>w.y?C.y=w.y:C.y+C.height<T.bottom&&(C.y=T.bottom-C.height),C.x>w.x?C.x=w.x:C.x+C.width<T.right&&(C.x=T.right-C.width);var L={x:C.x-x.x,y:C.y-x.y},P={x:L.x*Math.cos(s.rotation)-L.y*Math.sin(s.rotation),y:L.x*Math.sin(s.rotation)+L.y*Math.cos(s.rotation)};s.translation.x+=P.x,s.translation.y+=P.y}else if("resizing"===r){b.width<w.width&&(C.width=w.width,C.height=C.width*d,C.height<w.height&&(C.height=w.height,C.width=C.height/d)),b.height<w.height&&(C.height=w.height,C.width=C.height/d,C.width<w.width&&(C.width=w.width,C.height=C.width*d)),C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>w.y?C.y=w.y:C.y+C.height<T.bottom&&(C.y=T.bottom-C.height),C.x>w.x?C.x=w.x:C.x+C.width<T.right&&(C.x=T.right-C.width),s.scale=$t(t,e,s.rotation,{x:(A-C.x)/C.width,y:(I-C.y)/C.height});var D=te(t,ke({},n,{scale:s.scale})),k=zt(D);R.x=k.x,R.y=k.y,x.x=D.x,x.y=D.y,C.x=R.x-.5*C.width,C.y=R.y-.5*C.height,C.y>w.y?C.y=w.y:C.y+C.height<T.bottom&&(C.y=T.bottom-C.height),C.x>w.x?C.x=w.x:C.x+C.width<T.right&&(C.x=T.right-C.width);var G={x:C.x-x.x,y:C.y-x.y},U={x:G.x*Math.cos(s.rotation)-G.y*Math.sin(s.rotation),y:G.x*Math.sin(s.rotation)+G.y*Math.cos(s.rotation)};s.translation.x+=U.x,s.translation.y+=U.y}else if("rotating"===r){var V=!1;if(C.y>w.y){var B=C.y-w.y;C.y=w.y,C.height+=2*B,V=!0}if(C.y+C.height<T.bottom){var N=T.bottom-(C.y+C.height);C.y=T.bottom-C.height,C.height+=2*N,V=!0}if(C.x>w.x){var j=C.x-w.x;C.x=w.x,C.width+=2*j,V=!0}if(C.x+C.width<T.right){var F=T.right-(C.x+C.width);C.x=T.right-C.width,C.width+=2*F,V=!0}V&&(s.scale=$t(t,e,s.rotation,{x:(A-b.x)/b.width,y:(I-b.y)/b.height}))}return ke({},s,{rotation:n.rotation})},Ve={n:function(t){return{x:t.x+.5*t.width,y:t.y}},e:function(t){return{x:t.x+t.width,y:t.y+.5*t.height}},s:function(t){return{x:t.x+.5*t.width,y:t.y+t.height}},w:function(t){return{x:t.x,y:t.y+.5*t.height}}},Be=function(t,e){return Ve[t](e)};function Ne(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var je=function(t,e,n){var r=n.origin,i=n.translation,o=2*Math.PI+n.rotation%(2*Math.PI),a=te(t,n),c={x:r.x+i.x,y:r.y+i.y},l=ne(e,o),u=Dt(l.tl,-o,c),f=Dt(l.tr,-o,c),s=Dt(l.br,-o,c),d={x:Math.min(u.x,f.x,s.x),y:Math.min(u.y,f.y,s.y),width:Math.max(u.x,f.x,s.x)-Math.min(u.x,f.x,s.x),height:Math.max(u.y,f.y,s.y)-Math.min(u.y,f.y,s.y)},h=qt(d.x,d.y,d.width,d.height),p=jt(h),g=jt(a),m=a;if(p.top<g.top||p.right>g.right||p.bottom>g.bottom||p.left<g.left){var y=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ne(t,e,n[e])})}return t}({},g);if(p.top<=y.top){var v=y.bottom-y.top,E=y.right-y.left,w=Math.max(1,h.height/v),_=v*w,T=E*w-E;y.bottom=p.top+_,y.top=p.top,y.left-=.5*T,y.right+=.5*T}if(p.bottom>=y.bottom){var b=y.bottom-y.top,O=y.right-y.left,x=Math.max(1,h.height/b),R=b*x,A=O*x-O;y.bottom=p.bottom,y.top=p.bottom-R,y.left-=.5*A,y.right+=.5*A}if(p.left<=y.left){var I=y.bottom-y.top,C=y.right-y.left,S=Math.max(1,h.width/C),M=C*S,L=I*S-I;y.right=p.left+M,y.left=p.left,y.top-=.5*L,y.bottom+=.5*L}if(p.right>=y.right){var P=y.bottom-y.top,D=y.right-y.left,k=Math.max(1,h.width/D),G=D*k,U=P*k-P;y.right=p.right,y.left=p.right-G,y.top-=.5*U,y.bottom+=.5*U}m=qt(y.left,y.top,y.right-y.left,y.bottom-y.top)}var V=Wt(m),B=zt(m),N=Dt(V.tl,o,c),j=Dt(V.br,o,c),F=N.x+.5*(j.x-N.x),z=N.y+.5*(j.y-N.y),W=Vt(m,{x:F-B.x,y:z-B.y}),q=Vt(h,{x:F-B.x,y:z-B.y}),Y=zt(q),H={x:W.x,y:W.y},Z=W.width,X=W.height,K=(Y.x-H.x)/Z,Q=(Y.y-H.y)/X,J=Z/t.width,$={x:K*t.width,y:Q*t.height},tt=1-J,et=$.x*tt,nt=$.y*tt,rt={x:H.x+Z*K,y:H.y+X*Q},it=Dt(H,o,{x:H.x+.5*Z,y:H.y+.5*X}),ot=Dt(H,o,rt),at=it.x-ot.x,ct=it.y-ot.y;return{origin:$,translation:{x:H.x-et+at,y:H.y-nt+ct},scale:J,rotation:n.rotation}},Fe={nw:function(t){return{x:t.x,y:t.y}},ne:function(t){return{x:t.x+t.width,y:t.y}},se:function(t){return{x:t.x+t.width,y:t.y+t.height}},sw:function(t){return{x:t.x,y:t.y+t.height}}},ze=function(t,e){return Fe[t](e)},We=Math.PI/2,qe=Math.PI/4,Ye=function(t){var e=It(qe),n=It(We),r=t/n,i=Math.floor(r)*n,o=t-i;return o>e&&(o-=n,i+=n),{main:i,sub:o}},He=function(t){return new Promise(function(e,n){var r=new Image;r.src=URL.createObjectURL(t),r.onerror=function(t){clearInterval(i),n(t)};var i=setInterval(function(){r.naturalWidth&&r.naturalHeight&&(clearInterval(i),URL.revokeObjectURL(r.src),e({width:r.naturalWidth,height:r.naturalHeight}))},1)})},Ze=function(t,e){var n={width:t.width,height:t.height};if(t.width>e.width||t.height>e.height){var r=t.height/t.width,i=e.width/t.width,o=e.height/t.height;i<o?(n.width=t.width*i,n.height=n.width*r):(n.height=t.height*o,n.width=n.height/r)}return n},Xe={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},Ke=function(t){t.width=1,t.height=1,t.getContext("2d").clearRect(0,0,1,1)},Qe=function(t){return t&&(t.horizontal||t.vertical)},Je=function(t,e,n){if(e<=1&&!Qe(n))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),i=t.naturalWidth,o=t.naturalHeight,a=e>=5&&e<=8;a?(r.width=o,r.height=i):(r.width=i,r.height=o);var c=r.getContext("2d");if(e&&c.transform.apply(c,function(t,e,n){return-1===n&&(n=1),Xe[n](t,e)}(i,o,e)),Qe(n)){var l=[1,0,0,1,0,0];(!a&&n.horizontal||a&n.vertical)&&(l[0]=-1,l[4]=i),(!a&&n.vertical||a&&n.horizontal)&&(l[3]=-1,l[5]=o),c.transform.apply(c,l)}return c.drawImage(t,0,0,i,o),r};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var r=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(r),i=n.length,o=new Uint8Array(i),a=0;a<i;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:e||"image/png"}))})}}));var $e=function(t,e){return rn(t.x*e,t.y*e)},tn=function(t,e){return rn(t.x+e.x,t.y+e.y)},en=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return 0===e?{x:0,y:0}:rn(t.x/e,t.y/e)},nn=function(t,e,n){var r=Math.cos(e),i=Math.sin(e),o=rn(t.x-n.x,t.y-n.y);return rn(n.x+r*o.x-i*o.y,n.y+i*o.x+r*o.y)},rn=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},on=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0;return"string"==typeof t?parseFloat(t)*n:"number"==typeof t?t*(r?e[r]:Math.min(e.width,e.height)):void 0},an=function(t,e,n){var r=t.borderStyle||t.lineStyle||"solid",i=t.backgroundColor||t.fontColor||"transparent",o=t.borderColor||t.lineColor||"transparent",a=on(t.borderWidth||t.lineWidth,e,n);return{"stroke-linecap":t.lineCap||"round","stroke-linejoin":t.lineJoin||"round","stroke-width":a||0,"stroke-dasharray":"string"==typeof r?"":r.map(function(t){return on(t,e,n)}).join(","),stroke:o,fill:i,opacity:t.opacity||1}},cn=function(t){return null!=t},ln=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=on(t.x,e,n,"width")||on(t.left,e,n,"width"),i=on(t.y,e,n,"height")||on(t.top,e,n,"height"),o=on(t.width,e,n,"width"),a=on(t.height,e,n,"height"),c=on(t.right,e,n,"width"),l=on(t.bottom,e,n,"height");return cn(i)||(i=cn(a)&&cn(l)?e.height-a-l:l),cn(r)||(r=cn(o)&&cn(c)?e.width-o-c:c),cn(o)||(o=cn(r)&&cn(c)?e.width-r-c:0),cn(a)||(a=cn(i)&&cn(l)?e.height-i-l:0),{x:r||0,y:i||0,width:o||0,height:a||0}};function un(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){fn(t,e,n[e])})}return t}function fn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var sn=function(t,e){return Object.keys(e).forEach(function(n){return t.setAttribute(n,e[n])})},dn=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&sn(n,e),n},hn={contain:"xMidYMid meet",cover:"xMidYMid slice"},pn={left:"start",center:"middle",right:"end"},gn=function(t){return function(e){return dn(t,{id:e.id})}},mn={image:function(t){var e=dn("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return e.onload=function(){e.setAttribute("opacity",t.opacity||1)},e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),e},rect:gn("rect"),ellipse:gn("ellipse"),text:gn("text"),line:function(t){var e=dn("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),n=dn("line");e.appendChild(n);var r=dn("path");e.appendChild(r);var i=dn("path");return e.appendChild(i),e}},yn={rect:function(t){return sn(t,un({},t.rect,t.styles))},ellipse:function(t){var e=t.rect.x+.5*t.rect.width,n=t.rect.y+.5*t.rect.height,r=.5*t.rect.width,i=.5*t.rect.height;return sn(t,un({cx:e,cy:n,rx:r,ry:i},t.styles))},image:function(t,e){sn(t,un({},t.rect,t.styles,{preserveAspectRatio:hn[e.fit]||"none"}))},text:function(t,e,n,r){var i=on(e.fontSize,n,r),o=e.fontFamily||"sans-serif",a=e.fontWeight||"normal",c=pn[e.textAlign]||"start";sn(t,un({},t.rect,t.styles,{"stroke-width":0,"font-weight":a,"font-size":i,"font-family":o,"text-anchor":c})),t.text!==e.text&&(t.text=e.text,t.textContent=e.text.length?e.text:" ")},line:function(t,e,n,r){sn(t,un({},t.rect,t.styles,{fill:"none"}));var i=t.childNodes[0],o=t.childNodes[1],a=t.childNodes[2],c=t.rect,l={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(sn(i,{x1:c.x,y1:c.y,x2:l.x,y2:l.y}),e.lineDecoration){o.style.display="none",a.style.display="none";var u=en({x:l.x-c.x,y:l.y-c.y}),f=on(.05,n,r);if(-1!==e.lineDecoration.indexOf("arrow-begin")){var s=$e(u,f),d=tn(c,s),h=nn(c,2,d),p=nn(c,-2,d);sn(o,{style:"display:block;",d:"M".concat(h.x,",").concat(h.y," L").concat(c.x,",").concat(c.y," L").concat(p.x,",").concat(p.y)})}if(-1!==e.lineDecoration.indexOf("arrow-end")){var g=$e(u,-f),m=tn(l,g),y=nn(l,2,m),v=nn(l,-2,m);sn(a,{style:"display:block;",d:"M".concat(y.x,",").concat(y.y," L").concat(l.x,",").concat(l.y," L").concat(v.x,",").concat(v.y)})}}}},vn=function(t,e){return mn[t](e)},En=function(t,e,n,r,i){t.rect=ln(n,r,i),t.styles=an(n,r,i),yn[e](t,n,r,i)},wn=function(t,e){return t[1].zIndex>e[1].zIndex?1:t[1].zIndex<e[1].zIndex?-1:0},_n=function(){var t={resize:function(t,e){var r=e.mode,a=void 0===r?"contain":r,c=e.upscale,l=void 0!==c&&c,u=e.width,f=e.height,s=e.matrix;if(s=!s||i(s)?null:s,!u&&!f)return o(t,s);null===u?u=f:null===f&&(f=u);if("force"!==a){var d=u/t.width,h=f/t.height,p=1;if("cover"===a?p=Math.max(d,h):"contain"===a&&(p=Math.min(d,h)),p>1&&!1===l)return o(t,s);u=t.width*p,f=t.height*p}for(var g=t.width,m=t.height,y=Math.round(u),v=Math.round(f),E=t.data,w=new Uint8ClampedArray(y*v*4),_=g/y,T=m/v,b=Math.ceil(.5*_),O=Math.ceil(.5*T),x=0;x<v;x++)for(var R=0;R<y;R++){for(var A=4*(R+x*y),I=0,C=0,S=0,M=0,L=0,P=0,D=0,k=(x+.5)*T,G=Math.floor(x*T);G<(x+1)*T;G++)for(var U=Math.abs(k-(G+.5))/O,V=(R+.5)*_,B=U*U,N=Math.floor(R*_);N<(R+1)*_;N++){var j=Math.abs(V-(N+.5))/b,F=Math.sqrt(B+j*j);if(F>=-1&&F<=1&&(I=2*F*F*F-3*F*F+1)>0){var z=E[(j=4*(N+G*g))+3];D+=I*z,S+=I,z<255&&(I=I*z/250),M+=I*E[j],L+=I*E[j+1],P+=I*E[j+2],C+=I}}w[A]=M/C,w[A+1]=L/C,w[A+2]=P/C,w[A+3]=D/S,s&&n(A,w,s)}return{data:w,width:y,height:v}},filter:o},e=function(e,n){var r=e.transforms,i=null;if(r.forEach(function(t){"filter"===t.type&&(i=t)}),i){var o=null;r.forEach(function(t){"resize"===t.type&&(o=t)}),o&&(o.data.matrix=i.data,r=r.filter(function(t){return"filter"!==t.type}))}n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(r,e.imageData))};function n(t,e,n){for(var r=0,i=0,o=0,a=e[t]/255,c=e[t+1]/255,l=e[t+2]/255,u=e[t+3]/255;r<4;r++)o=255*(a*n[i=5*r]+c*n[i+1]+l*n[i+2]+u*n[i+3]+n[i+4]),e[t+r]=Math.max(0,Math.min(o,255))}self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})};var r=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function i(t){return self.JSON.stringify(t||[])===r}function o(t,e){if(!e||i(e))return t;for(var n=t.data,r=n.length,o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],f=e[5],s=e[6],d=e[7],h=e[8],p=e[9],g=e[10],m=e[11],y=e[12],v=e[13],E=e[14],w=e[15],_=e[16],T=e[17],b=e[18],O=e[19],x=0,R=0,A=0,I=0,C=0;x<r;x+=4)R=n[x]/255,A=n[x+1]/255,I=n[x+2]/255,C=n[x+3]/255,n[x]=Math.max(0,Math.min(255*(R*o+A*a+I*c+C*l+u),255)),n[x+1]=Math.max(0,Math.min(255*(R*f+A*s+I*d+C*h+p),255)),n[x+2]=Math.max(0,Math.min(255*(R*g+A*m+I*y+C*v+E),255)),n[x+3]=Math.max(0,Math.min(255*(R*w+A*_+I*T+C*b+O),255));return t}},Tn=function(t,e){if(1165519206===t.getUint32(e+4,!1)){e+=4;var n=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,n);var r=t.getUint16(e,n);e+=2;for(var i=0;i<r;i++)if(274===t.getUint16(e+12*i,n))return t.setUint16(e+12*i+8,1,n),!0;return!1}},bn=function(t){return new Promise(function(e){var n=new FileReader;n.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,r,i=2,o=!1;i<e.byteLength&&(n=e.getUint16(i,!1),r=e.getUint16(i+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(o||(o=Tn(e,i)),!(i+r>e.byteLength));)i+=r;return t.slice(0,i)}(n.result)||null)},n.readAsArrayBuffer(t.slice(0,262144))})},On=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var r=new n;return r.append(t),r.getBlob(e)}return new Blob([t],{type:e})},xn=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),r=new Worker(n),i=[];return{transfer:function(){},post:function(t,e,n){var o=Math.random().toString(36).substr(2,9);i[o]=e,r.onmessage=function(t){var e=i[t.data.id];e&&(e(t.data.message),delete i[t.data.id])},r.postMessage({id:o,message:t},n)},terminate:function(){r.terminate(),URL.revokeObjectURL(n)}}},Rn=function(t,e){return new Promise(function(n){var r,i={width:t.width,height:t.height},o=t.getContext("2d"),a=e.sort(wn).map(function(t){return function(){return new Promise(function(e){Cn[t[0]](o,i,t[1],e)&&e()})}});(r=a,r.reduce(function(t,e){return t.then(function(t){return e().then(Array.prototype.concat.bind(t))})},Promise.resolve([]))).then(function(){return n(t)})})},An=function(t,e){t.beginPath(),t.lineCap=e["stroke-linecap"],t.lineJoin=e["stroke-linejoin"],t.lineWidth=e["stroke-width"],e["stroke-dasharray"].length&&t.setLineDash(e["stroke-dasharray"].split(",")),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.globalAlpha=e.opacity||1},In=function(t){t.fill(),t.stroke(),t.globalAlpha=1},Cn={rect:function(t,e,n){var r=ln(n,e),i=an(n,e);return An(t,i),t.rect(r.x,r.y,r.width,r.height),In(t),!0},ellipse:function(t,e,n){var r=ln(n,e),i=an(n,e);An(t,i);var o=r.x,a=r.y,c=r.width,l=r.height,u=c/2*.5522848,f=l/2*.5522848,s=o+c,d=a+l,h=o+c/2,p=a+l/2;return t.moveTo(o,p),t.bezierCurveTo(o,p-f,h-u,a,h,a),t.bezierCurveTo(h+u,a,s,p-f,s,p),t.bezierCurveTo(s,p+f,h+u,d,h,d),t.bezierCurveTo(h-u,d,o,p+f,o,p),In(t),!0},image:function(t,e,n,r){var i=ln(n,e),o=an(n,e);An(t,o);var a=new Image;a.onload=function(){if("cover"===n.fit){var e=i.width/i.height,o=e>1?a.width:a.height*e,c=e>1?a.width/e:a.height,l=.5*a.width-.5*o,u=.5*a.height-.5*c;t.drawImage(a,l,u,o,c,i.x,i.y,i.width,i.height)}else if("contain"===n.fit){var f=Math.min(i.width/a.width,i.height/a.height),s=f*a.width,d=f*a.height,h=i.x+.5*i.width-.5*s,p=i.y+.5*i.height-.5*d;t.drawImage(a,0,0,a.width,a.height,h,p,s,d)}else t.drawImage(a,0,0,a.width,a.height,i.x,i.y,i.width,i.height);In(t),r()},a.src=n.src},text:function(t,e,n){var r=ln(n,e),i=an(n,e);An(t,i);var o=on(n.fontSize,e),a=n.fontFamily||"sans-serif",c=n.fontWeight||"normal",l=n.textAlign||"left";return t.font="".concat(c," ").concat(o,"px ").concat(a),t.textAlign=l,t.fillText(n.text,r.x,r.y),In(t),!0},line:function(t,e,n){var r=ln(n,e),i=an(n,e);An(t,i),t.beginPath();var o={x:r.x,y:r.y},a={x:r.x+r.width,y:r.y+r.height};t.moveTo(o.x,o.y),t.lineTo(a.x,a.y);var c=en({x:a.x-o.x,y:a.y-o.y}),l=.04*Math.min(e.width,e.height);if(-1!==n.lineDecoration.indexOf("arrow-begin")){var u=$e(c,l),f=tn(o,u),s=nn(o,2,f),d=nn(o,-2,f);t.moveTo(s.x,s.y),t.lineTo(o.x,o.y),t.lineTo(d.x,d.y)}if(-1!==n.lineDecoration.indexOf("arrow-end")){var h=$e(c,-l),p=tn(a,h),g=nn(a,2,p),m=nn(a,-2,p);t.moveTo(g.x,g.y),t.lineTo(a.x,a.y),t.lineTo(m.x,m.y)}return In(t),!0}},Sn=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(r,i){if(!t||!function(t){return/^image/.test(t.type)}(t))return i({status:"not an image file",file:t});var o=n.stripImageHead,a=n.beforeCreateBlob,c=n.afterCreateBlob,l=n.canvasMemoryLimit,u=e.crop,f=e.size,s=e.filter,d=e.markup,h=e.output,p=e.image&&e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,g=h&&h.quality,m=null===g?null:g/100,y=h&&h.type||null,v=h&&h.background||null,E=[];!f||"number"!=typeof f.width&&"number"!=typeof f.height||E.push({type:"resize",data:f}),s&&20===s.length&&E.push({type:"filter",data:s});var w=function(t){var e=c?c(t):t;Promise.resolve(e).then(r)},_=function(t,e){var n=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e}(t),r=d.length?Rn(n,d):n;Promise.resolve(r).then(function(t){(function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(r){var i=n?n(t):t;Promise.resolve(i).then(function(t){t.toBlob(r,e.type,e.quality)})})})(t,e,a).then(function(e){if(Ke(t),o)return w(e);bn(e).then(function(t){null!==t&&(e=new Blob([t,e.slice(20)],{type:e.type})),w(e)})}).catch(i)})};if(/svg/.test(t.type)&&null===y)return function(t,e,n,r){return new Promise(function(i){var o=r.background,a=void 0===o?null:o,c=new FileReader;c.onloadend=function(){var t=c.result,r=document.createElement("div");r.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",r.innerHTML=t;var o=r.querySelector("svg");document.body.appendChild(r);var l=o.getBBox();r.parentNode.removeChild(r);var u=r.querySelector("title"),f=o.getAttribute("viewBox")||"",s=o.getAttribute("width")||"",d=o.getAttribute("height")||"",h=parseFloat(s)||null,p=parseFloat(d)||null,g=(s.match(/[a-z]+/)||[])[0]||"",m=(d.match(/[a-z]+/)||[])[0]||"",y=f.split(" ").map(parseFloat),v=y.length?{x:y[0],y:y[1],width:y[2],height:y[3]}:l,E=null!=h?h:v.width,w=null!=p?p:v.height;o.style.overflow="visible",o.setAttribute("width",E),o.setAttribute("height",w);var _="";if(n&&n.length){var T={width:E,height:w};_=n.sort(wn).reduce(function(t,e){var n=vn(e[0],e[1]);return En(n,e[0],e[1],T),n.removeAttribute("id"),1===n.getAttribute("opacity")&&n.removeAttribute("opacity"),t+"\n"+n.outerHTML+"\n"},""),_="\n\n<g>".concat(_.replace(/&nbsp;/g," "),"</g>\n\n")}var b=e.aspectRatio||w/E,O=E,x=O*b,R=void 0===e.scaleToFit||e.scaleToFit,A=$t({width:E,height:w},Ht({width:O,height:x},b),e.rotation,R?e.center:{x:.5,y:.5}),I=e.zoom*A,C=e.rotation*(180/Math.PI),S={x:.5*O,y:.5*x},M={x:S.x-E*e.center.x,y:S.y-w*e.center.y},L=["rotate(".concat(C," ").concat(S.x," ").concat(S.y,")"),"translate(".concat(S.x," ").concat(S.y,")"),"scale(".concat(I,")"),"translate(".concat(-S.x," ").concat(-S.y,")"),"translate(".concat(M.x," ").concat(M.y,")")],P=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-E:0," ").concat(e.flip.vertical?-w:0,")")],D='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(O).concat(g,'" height="').concat(x).concat(m,'" \nviewBox="0 0 ').concat(O," ").concat(x,'" ').concat(a?'style="background:'+a+'" ':"",'\npreserveAspectRatio="xMinYMin"\nxmlns:xlink="http://www.w3.org/1999/xlink"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generated by PQINA - https://pqina.nl/ --\x3e\n<title>').concat(u?u.textContent:"",'</title>\n<g transform="').concat(L.join(" "),'">\n<g transform="').concat(P.join(" "),'">\n').concat(o.outerHTML).concat(_,"\n</g>\n</g>\n</svg>");i(D)},c.readAsText(t)})}(t,u,d,{background:v}).then(function(t){r(On(t,"image/svg+xml"))});var T=URL.createObjectURL(t);(function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=function(t){n(t)},r.src=t})})(T).then(function(e){URL.revokeObjectURL(T);var n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.canvasMemoryLimit,o=r.background,a=void 0===o?null:o,c=n.zoom||1,l=Je(t,e,n.flip),u={width:l.width,height:l.height},f=n.aspectRatio||u.height/u.width,s=Zt(u,f,c);if(i){var d=s.width*s.height;if(d>i){var h=Math.sqrt(i)/Math.sqrt(d);u.width=Math.floor(u.width*h),u.height=Math.floor(u.height*h),s=Zt(u,f,c)}}var p=document.createElement("canvas"),g={x:.5*s.width,y:.5*s.height},m={x:0,y:0,width:s.width,height:s.height,center:g},y=void 0===n.scaleToFit||n.scaleToFit,v=c*$t(u,Ht(m,f),n.rotation,y?n.center:{x:.5,y:.5});p.width=Math.round(s.width/v),p.height=Math.round(s.height/v),g.x/=v,g.y/=v;var E=g.x-u.width*(n.center?n.center.x:.5),w=g.y-u.height*(n.center?n.center.y:.5),_=p.getContext("2d");a&&(_.fillStyle=a,_.fillRect(0,0,p.width,p.height)),_.translate(g.x,g.y),_.rotate(n.rotation||0),_.drawImage(l,E-g.x,w-g.y,u.width,u.height);var T=_.getImageData(0,0,p.width,p.height);return Ke(p),T}(e,p,u,{canvasMemoryLimit:l,background:v}),r={quality:m,type:y||t.type};if(!E.length)return _(n,r);var i=xn(_n);i.post({transforms:E,imageData:n},function(t){_(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(t),r),i.terminate()},[n.data.buffer])}).catch(i)})},Mn=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(e+t).slice(-e.length)},Ln=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return"".concat(t.getFullYear(),"-").concat(Mn(t.getMonth()+1,"00"),"-").concat(Mn(t.getDate(),"00"),"_").concat(Mn(t.getHours(),"00"),"-").concat(Mn(t.getMinutes(),"00"),"-").concat(Mn(t.getSeconds(),"00"))},Pn=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t("GET_CROP_ASPECT_RATIO"),o={center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null};n?Object.assign(o,n):e.options.crop?Object.assign(o,e.options.crop):o.aspectRatio=i;var a=r.width,c=r.height;if(a&&c)o.aspectRatio=c/a;else if(e.instructions.size){var l=e.instructions.size,u=l.width,f=l.height;u&&f&&(o.aspectRatio=f/u)}return o},Dn=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},kn={jpeg:"jpg","svg+xml":"svg"},Gn=function(t){return Array.isArray(t)&&20===t.length};function Un(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Vn(t,e,n[e])})}return t}function Vn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Bn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Nn=["x","y","left","top","right","bottom","width","height"],jn=function(t){var e=Bn(t,2),n=e[0],r=e[1],i=!1!==r.allowSelect,o=!1!==r.allowMove,a=!1!==r.allowResize,c=!1!==r.allowInput,l=!1!==r.allowDestroy,u=void 0===r.allowEdit||r.allowEdit;return(!0===r.allowResize||!0===r.allowMove||!0===r.allowInput||r.allowEdit)&&(i=!0),!1===r.allowMove&&(a=!1),!0===r.allowResize&&(o=!0),[n,Un({zIndex:0,id:Math.random().toString(36).substr(2,9)},r,Nn.reduce(function(t,e){var n;return t[e]="string"==typeof(n=r[e])&&/%/.test(n)?parseFloat(n)/100:n,t},{}),{isDestroyed:!1,isSelected:!1,isDirty:!0,allowDestroy:l,allowSelect:i,allowMove:o,allowResize:a,allowInput:c,allowEdit:u})]};function Fn(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function zn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Wn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){qn(t,e,n[e])})}return t}function qn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Yn={contrast:function(t){return[t,0,0,0,.5*(1-t),0,t,0,0,.5*(1-t),0,0,t,0,.5*(1-t),0,0,0,1,0]},exposure:function(t){return[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0]},brightness:function(t){return[1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0]},saturation:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return[.213+.787*t,.715-.715*t,.072-.072*t,0,0,.213-.213*t,.715+.285*t,.072-.072*t,0,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,0,1,0]}},Hn=Math.PI/2,Zn=function(t){var e={upscale:t("GET_OUTPUT_UPSCALE"),mode:t("GET_OUTPUT_FIT"),width:t("GET_OUTPUT_WIDTH"),height:t("GET_OUTPUT_HEIGHT")},n=t("GET_SIZE_INPUT");if(t("ALLOW_MANUAL_RESIZE")&&(n.width||n.height)){var r=n.width,i=n.height,o=t("GET_CROP_RECTANGLE_ASPECT_RATIO");r&&!i?i=r/o:i&&!r&&(r=i*o),e.width=r,e.height=i,e.upscale=!0,e.mode="force"}return e},Xn=function(t,e){var n=e("GET_UID"),r=e("GET_CROP",n,Date.now()),i={width:r.cropStatus.currentWidth,height:r.cropStatus.currentHeight},o=t.mode,a=t.width,c=t.height,l=t.upscale;if(!a&&!c)return i;if(null===a?a=c:null===c&&(c=a),"force"!==o){var u=a/i.width,f=c/i.height,s=1;if("cover"===o?s=Math.max(u,f):"contain"===o&&(s=Math.min(u,f)),s>1&&!1===l)return i;a=i.width*s,c=i.height*s}return{width:Math.round(a),height:Math.round(c)}},Kn=function(t){return t.markup.filter(function(t){return!t[1].isDestroyed})},Qn=function(t,e,n){return new Promise(function(r,i){var o={data:null,file:null},a=ae(e.image,e.crop),c=Zn(n),l={crop:a,image:Wn({},Xn(c,n),{orientation:e.file.orientation}),size:c,output:{type:n("GET_OUTPUT_TYPE"),quality:n("GET_OUTPUT_QUALITY"),background:e.options.outputCanvasBackgroundColor},filter:e.colorMatrices.filter?{id:e.filterName,value:e.filterValue,matrix:e.colorMatrices.filter}:null,color:Object.keys(e.colorValues).length?Object.keys(e.colorValues).reduce(function(t,n){return t[n]={value:e.colorValues[n],matrix:e.colorMatrices[n].map(function(t){return It(t,5)})},t},{}):null,markup:Kn(e).map(function(t){return[t[0],Wn({},t[1])]}),colorMatrix:n("GET_COLOR_MATRIX")};if(t.data&&(o.data=l),t.file){var u={beforeCreateBlob:n("GET_BEFORE_CREATE_BLOB"),afterCreateBlob:n("GET_AFTER_CREATE_BLOB"),stripImageHead:n("GET_OUTPUT_STRIP_IMAGE_HEAD"),canvasMemoryLimit:n("GET_OUTPUT_CANVAS_MEMORY_LIMIT")},f=e.file.data,s=Wn({},l,{filter:l.colorMatrix,markup:l.markup});Sn(f,s,u).then(function(t){var e;o.file=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i="string"==typeof n?t.slice(0,t.size,n):t.slice(0,t.size,t.type);return i.lastModifiedDate=new Date,X(e)||(e=Ln()),e&&null===r&&e.split(".").pop()?i.name=e:(r=r||function(t){if("string"!=typeof t)return"";var e=t.split("/").pop();return/svg/.test(e)?"svg":/zip|compressed/.test(e)?"zip":/plain/.test(e)?"txt":/msword/.test(e)?"doc":/[a-z]+/.test(e)?"jpeg"===e?"jpg":e:""}(i.type),i.name=e+(r?"."+r:"")),i}(t,function(t,e){var n=function(t){return t.substr(0,t.lastIndexOf("."))||t}(t),r=e.split("/")[1],i=kn[r]||r;return"".concat(n,".").concat(i)}(f.name,(e=t.type,/jpeg|png|svg\+xml/.test(e)?e:"image/jpeg"))),r(o)}).catch(i)}else r(o)})},Jn=function(t){t.crop.draft.rotateMinScale=null},$n=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];!function(t){t.crop.draft.rotateMinScale||(t.crop.draft.rotateMinScale=t.crop.transforms.scale)}(t);var o=Wn({},t.crop.transforms,{scale:t.crop.draft.rotateMinScale});t.crop.draft.transforms=lr(t.image,t.crop.rectangle,o,e.main+e.sub,n,t.crop.draft.transforms?t.crop.draft.transforms.rotation:t.crop.rotation.main+t.crop.rotation.sub,r,i),t.crop.rotation=Ye(t.crop.draft.transforms.rotation)},tr=function(t,e,n){if(null!==t.stage){or(t),t.size.width=!!t.instructions.size&&t.instructions.size.width,t.size.height=!!t.instructions.size&&t.instructions.size.height,t.size.aspectRatioLocked=!0,t.size.aspectRatioPrevious=!1,t.crop.rectangle=Ht(t.stage,t.instructions.crop.aspectRatio||t.image.aspectRatio),t.crop.draft.rectangle=null;var r=void 0===t.instructions.crop.scaleToFit?void 0===t.crop.limitToImageBounds?t.options.cropLimitToImageBounds:t.crop.limitToImageBounds:t.instructions.crop.scaleToFit;t.crop.transforms=Me(t.instructions.crop,t.stage,t.image,r),t.crop.draft.transforms=null,t.crop.rotation=Ye(t.instructions.crop.rotation),t.crop.flip=Wn({},t.instructions.crop.flip);var i=e("GET_CROP_ASPECT_RATIO_OPTIONS")||[],o=i.map(function(t){return t.value.aspectRatio}).find(function(e){return e===t.instructions.crop.aspectRatio}),a=i.find(function(t){return null===t.value.aspectRatio});o?t.crop.aspectRatio=o:a&&i.length?t.crop.aspectRatio=null:t.crop.aspectRatio=e("GET_CROP_ASPECT_RATIO"),t.crop.isDirty=!1,t.instructions.markup&&n("MARKUP_SET_VALUE",{value:t.instructions.markup.map(jn).sort(wn)}),n("CROP_SET_LIMIT",{value:r,silent:!0}),Object.keys(t.instructions.color).forEach(function(e){return n("COLOR_SET_VALUE",{key:e,value:t.instructions.color[e]})}),n("FILTER_SET_VALUE",{value:t.instructions.filter}),Jn(t)}},er=function(t,e){if(t.stage){or(t);var n=t.crop.rectangle,r=n.height/n.width,i=t.crop.aspectRatio;if(null!==i&&It(r,3)!==i){var o=e("GET_MIN_CROP_SIZE");o.width=It(o.width),o.height=It(o.height);var a=Math.min(n.width,n.height);Math.min(a*i,a/i)<Math.max(o.width,o.height)&&(t.crop.rectangle=function(t,e,n){var r=Nt(t);return r.width=Math.min(r.height,r.width),r.height=r.width,r.height=r.width*e,r.height<n.height&&(r.height=n.height,r.width=r.height/e),r.width<n.width&&(r.width=n.width,r.height=r.width*e),r}(Wn({},t.crop.rectangle),i,o),t.crop.draft.transforms=je(t.image,t.crop.rectangle,t.crop.transforms))}var c=t.crop.draft.transforms||t.crop.transforms,l=re(t.image,t.crop.rectangle,c,t.crop.limitToImageBounds);t.crop.aspectRatio&&(l.aspectRatio=t.crop.aspectRatio),t.crop.transforms=Me(l,t.stage,t.image,l.scaleToFit),t.crop.draft.transforms=null;var u=t.crop.aspectRatio||t.crop.rectangle.height/t.crop.rectangle.width;t.crop.rectangle=Ht(t.stage,u),t.crop.draft.rectangle=null,Jn(t)}},nr=function(t){var e,n,r,i,o,a,c,l,u,f,s,d,h,p,g,m,y,v,E,w,_,T,b,O,x,R,A,I,C,S,M,L,P,D,k,G,U,V,B;t.crop.draft.rectangle=null,t.crop.transforms=t.crop.draft.transforms||t.crop.transforms,t.crop.transforms.interaction=null,t.crop.draft.transforms=null,t.crop.transforms=Wn({},t.crop.transforms,(e=t.image,n=t.crop.rectangle,r=t.crop.transforms,i=r.origin,o=r.translation,a=r.scale,c=2*Math.PI+r.rotation%(2*Math.PI),l={x:i.x+o.x,y:i.y+o.y},u=ne(n,c),f=Dt(u.tl,-c,l),s=Dt(u.tr,-c,l),d=Dt(u.br,-c,l),h=Dt(u.bl,-c,l),p=qt(Math.min(f.x,s.x,d.x,h.x),Math.min(f.y,s.y,d.y,h.y),Math.max(f.x,s.x,d.x,h.x)-Math.min(f.x,s.x,d.x,h.x),Math.max(f.y,s.y,d.y,h.y)-Math.min(f.y,s.y,d.y,h.y)),g=qt(p.x,p.y,p.width,p.height),m=te(e,r),y=Wt(m),v=zt(m),E=Dt(y.tl,c,l),w=Dt(y.br,c,l),_=E.x+.5*(w.x-E.x),T=E.y+.5*(w.y-E.y),b=Vt(m,{x:_-v.x,y:T-v.y}),O=Vt(g,{x:_-v.x,y:T-v.y}),x=zt(O),R={x:b.x,y:b.y},A=b.width,I=b.height,C=(x.x-R.x)/A,S=(x.y-R.y)/I,M={x:C*e.width,y:S*e.height},P=M.x*(L=1-a),D=M.y*L,k={x:R.x+A*C,y:R.y+I*S},G=Dt(R,c,{x:R.x+.5*A,y:R.y+.5*I}),U=Dt(R,c,k),V=G.x-U.x,B=G.y-U.y,{origin:Ct(M),translation:Ct({x:R.x-P+V,y:R.y-D+B})})),t.crop.isRotating=!1,t.crop.isDirty=!0},rr=function(t,e,n){var r=e("GET_CROP_ZOOM_TIMEOUT");r&&(clearTimeout(t.zoomTimeoutId),t.zoomTimeoutId=setTimeout(function(){n("CROP_ZOOM")},r))},ir=function(t,e,n){or(t),rr(t,e,n)},or=function(t){clearTimeout(t.zoomTimeoutId)},ar=function(t){t.crop.draft.transforms=De(t.crop.transforms),t.crop.draft.rectangle={limited:Nt(t.crop.rectangle),free:Nt(t.crop.rectangle)},or(t)},cr=function(t,e){return Math.min(t.width/e.width,t.height/e.height)},lr=function(t,e,n,r,i,o,a,c){var l=Wn({},De(n),{rotation:r}),u=c?Ue(t,e,l,"rotating"):l,f=cr(e,i);return It(u.scale,5)>It(f,5)?(a&&(o+=2*a),Wn({},De(n),{rotation:o,interaction:{rotation:u.rotation}})):(u.scale=Math.min(f,u.scale),u.interaction={rotation:u.rotation},u)},ur=function(t,e,n,r,i,o){var a=Math.max(1e-10,r),c=Wn({},De(n),{scale:a}),l=o?Ue(t,e,c,"resizing"):c,u=cr(e,i);return l.scale=Math.min(u,l.scale),l.interaction={scale:a},l},fr=function(t){return!1===t.file},sr=function(t,e,n){return Wn({SET_UID:function(t){var e=t.id;n.uid=e},AWAIT_IMAGE:function(){n.file||(n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},250))},REQUEST_REMOVE_IMAGE:function(){t("UNLOAD_IMAGE"),n.file=!1,n.noImageTimeout=setTimeout(function(){t("AWAITING_IMAGE")},500)},DID_UNLOAD_IMAGE:function(){t("ABORT_IMAGE")},REQUEST_ABORT_IMAGE:function(e){t("UNLOAD_IMAGE"),n.file=!1,n.queuedFile=e},DID_SET_SRC:function(e){e.value!==e.prevValue&&(clearTimeout(n.noImageTimeout),t("REQUEST_LOAD_IMAGE",{source:e.value}))},ABORT_IMAGE:function(){if(n.file=null,n.queuedFile){var e=n.queuedFile;n.queuedFile=null,t("REQUEST_LOAD_IMAGE",e)}},REQUEST_LOAD_IMAGE:function(e){var r,i=e.source,o=e.success,a=void 0===o?function(){}:o,c=e.failure,l=void 0===c?function(t){}:c,u=e.options,f=e.resolveOnConfirm,s=void 0!==f&&f;if(clearTimeout(n.noImageTimeout),!i)return l();null===n.file?(ot(n),n.file={uid:ut()},t("DID_REQUEST_LOAD_IMAGE",{source:i}),(r=i,new Promise(function(t,e){if(X(r)){var n=null;fetch(r).then(function(t){if(t.headers&&(n=t.headers.get("Content-Type")),t.ok)return t.blob();e(t)}).then(function(i){if(!i)return e(r);!i.type.length&&n&&(i=i.slice(0,i.size,n)),t(i)}).catch(e)}else if(r instanceof Blob)t(r);else{if("IMG"===r.nodeName){var i=function(e){var n=document.createElement("canvas");n.width=e.naturalWidth,n.height=e.naturalHeight,n.getContext("2d").drawImage(e,0,0),n.toBlob(t)};return r.complete?void i(r):void(r.onload=function(){return i(r)})}"CANVAS"!==r.nodeName?e(r):r.toBlob(t)}})).then(function(e){if(fr(n))return t("ABORT_IMAGE");e.name||(e.name=Ln()),n.file.orientation=-1,n.file.data=e,t("LOAD_IMAGE",{success:a,failure:l,options:u,resolveOnConfirm:s},!0),t("KICK")}).catch(function(e){if(fr(n))return t("ABORT_IMAGE");t("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_LOAD_ERROR",data:e}}),l(e)})):t("REQUEST_ABORT_IMAGE",{source:i,success:a,failure:l,options:u,resolveOnConfirm:s})},LOAD_IMAGE:function(r){var i=r.success,o=r.failure,a=r.options,c=void 0===a?{}:a,l=r.resolveOnConfirm;if(fr(n))return t("ABORT_IMAGE");var u=n.file.data;Promise.all([He(u),Ie(u)]).then(function(r){var a=zn(r,2),u=a[0],f=a[1];if(fr(n))return t("ABORT_IMAGE");if(n.file.orientation=e("GET_OUTPUT_CORRECT_IMAGE_EXIF_ORIENTATION")?f:-1,n.file.orientation>-1){var s=u.width,d=u.height;f>=5&&f<=8&&(u.width=d,u.height=s)}var h=e("GET_MIN_IMAGE_SIZE");if(u.width<h.width||u.height<h.height)return t("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_MIN_SIZE_VALIDATION_ERROR",data:{size:u,minImageSize:h}}}),ot(n),void o();var p=Ze(u,{width:e("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e("GET_MAX_IMAGE_PREVIEW_HEIGHT")});if(n.image={x:0,y:0,width:p.width,height:p.height,naturalWidth:u.width,naturalHeight:u.height,aspectRatio:u.height/u.width},e("ALLOW_MANUAL_RESIZE")&&c.size&&(n.size.width=c.size.width,n.size.height=c.size.height,n.size.aspectRatioLocked=!0,n.size.aspectRatioPrevious=!1,n.instructions.size={width:c.size.width,height:c.size.height}),n.instructions.crop=Pn(e,n,c.crop?Wn({},c.crop):null,n.size),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,!1===n.instructions.crop.scaleToFit&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),void 0===c.filter)n.instructions.filter=n.options.filter;else{var g=c.filter;n.instructions.filter=null===g?g:g.id||g.matrix||g}var m=n.options.markup||[];n.instructions.markup=m.concat(c.markup||[]),n.instructions.color=Object.keys(Yn).reduce(function(t,e){return t[e]=c.color&&void 0!==c.color[e]?"number"==typeof c.color[e]?c.color[e]:c.color[e].value:n.options["color".concat(Dn(e))],t},{}),t("DID_LOAD_IMAGE",{image:Wn({size:n.file.data.size,name:n.file.data.name,type:n.file.data.type,orientation:f},u)}),n.filePromise={resolveOnConfirm:l,success:i,failure:o}}).catch(function(e){if(fr(n))return t("ABORT_IMAGE");t("DID_LOAD_IMAGE_ERROR",{error:{status:"IMAGE_UNKNOWN_ERROR",data:e}}),ot(n),o()})},CHANGE_VIEW:function(e){var r=e.id;n.activeView=r,t("SHOW_VIEW",{id:r})},UPDATE_ROOT_RECT:function(t){var e=t.rect;n.rootRect=e},DID_RESIZE_STAGE:function(r){var i=r.size,o=r.offset,a=r.animate,c=null===n.stage;if(n.stage=qt(0,0,i.width,i.height),n.stageOffset=kt(o.x,o.y),!e("GET_ALLOW_PREVIEW_FIT_TO_VIEW")){var l=Math.min(i.width,n.image.naturalWidth),u=Math.min(i.height,n.image.naturalHeight);n.stage=qt(0,0,l,u),n.stageOffset=kt(o.x+.5*i.width-.5*l,o.y+.5*i.height-.5*u)}if(c){if(tr(n,e,t),!n.filePromise.resolveOnConfirm){var f=ae(n.image,n.crop),s=Zn(e);n.filePromise.success({crop:f,image:{orientation:n.file.orientation},size:s,output:{type:e("GET_OUTPUT_TYPE"),quality:e("GET_OUTPUT_QUALITY")}})}}else n.instantUpdate=!a,er(n,e),setTimeout(function(){n.instantUpdate=!1},16)},RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK:function(t){var e=t.value;n.size.aspectRatioLocked=e},RESIZE_SET_OUTPUT_SIZE:function(r){var i=r.width,o=r.height,a=le({width:i=i||null,height:o=o||null},e("GET_SIZE_MIN"),e("GET_SIZE_MAX"),e("GET_CROP_RECTANGLE_ASPECT_RATIO"));if(n.size.width=a.width?Math.round(a.width):null,n.size.height=a.height?Math.round(a.height):null,i&&o){var c=o/i;if(c===n.crop.aspectRatio)return;!1===n.size.aspectRatioPrevious&&(n.size.aspectRatioPrevious=n.crop.aspectRatio),t("CROP_SET_ASPECT_RATIO",{value:c})}else!1!==n.size.aspectRatioPrevious&&(t("CROP_SET_ASPECT_RATIO",{value:n.size.aspectRatioPrevious}),n.size.aspectRatioPrevious=!1)},CROP_SET_ASPECT_RATIO:function(t){var r=t.value;if(or(n),n.crop.aspectRatio=r,n.crop.aspectRatio&&er(n,e),n.crop.isDirty=!0,n.size.width&&n.size.height)if(n.crop.aspectRatio){var i=n.size.width*n.crop.aspectRatio,o=At(i,e("GET_SIZE_MIN").height,e("GET_SIZE_MAX").height);n.size.height=o,n.size.width=o/n.crop.aspectRatio}else n.size.height=null},DID_SET_CROP_ASPECT_RATIO:function(e){var n=e.value,r=e.prevValue;Yt(n)!==Yt(r)&&t("CROP_SET_ASPECT_RATIO",{value:n})},CROP_ZOOM:function(){n.stage&&(or(n),er(n,e))},DID_SET_CROP_LIMIT_TO_IMAGE_BOUNDS:function(e){var r=e.value,i=e.prevValue;n.crop.limitToImageBounds=r,!1===i&&r&&t("CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS")},CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS:function(){var t=n.stage,r=n.image,i=n.crop.rectangle.height/n.crop.rectangle.width,o=Ht(t,i);n.crop.rectangle=o,n.crop.transforms=Ue(r,n.crop.rectangle,n.crop.transforms,"moving"),n.crop.transforms=Ue(r,n.crop.rectangle,n.crop.transforms,"resizing"),n.crop.transforms=Ue(r,n.crop.rectangle,n.crop.transforms,"rotating"),n.crop.draft.rectangle=null,n.crop.draft.transforms=null,er(n,e)},CROP_SET_LIMIT:function(e){var r=e.value,i=e.silent,o=void 0!==i&&i,a=n.crop.limitToImageBounds!==r;n.crop.limitToImageBounds=r,a&&!o&&(n.crop.isDirty=!0),a&&r&&t("CROP_ENABLED_LIMIT_TO_IMAGE_BOUNDS")},CROP_IMAGE_RESIZE_GRAB:function(){ar(n),or(n)},CROP_IMAGE_ROTATE_GRAB:function(){ar(n),or(n),n.crop.isRotating=!0},CROP_RECT_DRAG_GRAB:function(){ar(n),or(n)},CROP_RECT_DRAG_RELEASE:function(){!function(t){t.crop.rectangle=t.crop.draft.rectangle.limited,t.crop.draft.rectangle=null,nr(t),Jn(t)}(n),rr(n,e,t)},CROP_RECT_EDGE_DRAG:function(t){var r=t.offset,i=t.origin,o=t.anchor,a=n.image,c=n.stage,l=/n|s/.test(i)?Se:Ce,u=Be(i,n.crop.rectangle),f=Be(o,n.crop.rectangle),s=Pt({x:u.x+(l===Ce?r.x:0),y:u.y+(l===Se?r.y:0)},c),d=e("GET_MIN_CROP_SIZE"),h=e("GET_MAX_CROP_SIZE");d.width=It(d.width),d.height=It(d.height);var p=cr(n.crop.rectangle,e("GET_MIN_PREVIEW_IMAGE_SIZE"))/(n.crop.draft.transforms.scale||n.crop.transforms.scale);h.width=It(h.width*p),h.height=It(h.height*p);var g={x:Math.sign(u.x-f.x),y:Math.sign(u.y-f.y)};n.crop.draft.rectangle=function(t,e,n,r,i,o,a,c,l){var u=o.left,f=o.right,s=o.top,d=o.bottom,h=f-u,p=d-s,g=i.left,m=i.right,y=i.top,v=i.bottom;if(n===Se){if(y=t.y>0?r.y:Math.min(r.y,Math.max(e.y,s)),v=t.y>0?Math.max(r.y,Math.min(e.y,d)):r.y,a){var E=(v-y)/a;g=r.x-.5*E,m=r.x+.5*E}}else if(g=t.x>0?r.x:Math.min(r.x,Math.max(e.x,u)),m=t.x>0?Math.max(r.x,Math.min(e.x,f)):r.x,a){var w=(m-g)*a;y=r.y-.5*w,v=r.y+.5*w}var _,T,b,O,x=c.width,R=c.height;if(n===Se?(_=r.x-.5*x,T=r.x+.5*x,t.y<0?(b=r.y-R,O=r.y):t.y>0&&(b=r.y,O=r.y+R)):(b=r.y-.5*R,O=r.y+.5*R,t.x<0?(_=r.x-x,T=r.x):t.x>0&&(_=r.x,T=r.x+x)),a)if(n===Se){var A=Math.min((v-y)/a,h),I=A*a;g<u&&(m=(g=u)+A),m>f&&(g=(m=f)-A),r.x=g+.5*A,t.y<0?y=r.y-I:t.y>0&&(v=r.y+I)}else{var C=Math.min((m-g)*a,p),S=C/a;y<s&&(v=(y=s)+C),v>d&&(y=(v=d)-C),r.y=y+.5*C,t.x<0?g=r.x-S:t.x>0&&(m=r.x+S)}var M=Ft({top:y,right:m,bottom:v,left:g}),L=function(){var e=x*a;n===Ce?(y=r.y-.5*e,v=r.y+.5*e):t.y<0?(v=r.y,y=v-e):t.y>0&&(y=r.y,v=y+e)},P=function(){var e=R/a;n===Se?(g=r.x-.5*e,m=r.x+.5*e):t.x<0?(m=r.x,g=m-e):t.x>0&&(g=r.x,m=g+e)};m<T&&(m=T,g=T-x,a&&L()),g>_&&(g=_,m=_+x,a&&L()),y>b&&(y=b,v=b+R,a&&P()),v<O&&(v=O,y=O-R,a&&P());var D=l.width,k=l.height;if(a&&(a<1?D=k/a:k=D*a),m-g>D&&(t.x<0?g=r.x-D:m=r.x+D),v-y>k&&(t.y<0?y=r.y-k:v=r.y+k),m-g==0&&(t.x>0?m=r.x+2:g=r.x-2),v-y==0&&(t.y>0?v=r.y+2:y=r.y-2),Math.round(g)<u||Math.round(m)>f||Math.round(y)<s||Math.round(v)>d){var G=d-s,U=f-u;if(g<u){g=u;var V=Math.min(m-g,U);m=g+V}if(m>f){m=f;var B=Math.min(m-g,U);g=m-B}if(y<s){y=s;var N=Math.min(v-y,G);v=y+N}if(v>d){v=d;var j=Math.min(v-y,G);y=v-j}M=Ft({top:y,right:m,bottom:v,left:g})}return{free:M,limited:Ft({top:y,right:m,bottom:v,left:g})}}(g,s,l,f,jt(n.crop.rectangle),jt(c),n.crop.aspectRatio,d,h),n.crop.limitToImageBounds&&(n.crop.draft.transforms=je(a,n.crop.draft.rectangle.limited,n.crop.transforms))},CROP_RECT_CORNER_DRAG:function(t){var r=t.offset,i=t.origin,o=t.anchor,a=n.image,c=n.stage,l=ze(i,n.crop.rectangle),u=ze(o,n.crop.rectangle),f={x:l.x+r.x,y:l.y+r.y},s=e("GET_MIN_CROP_SIZE"),d=e("GET_MAX_CROP_SIZE");s.width=It(s.width),s.height=It(s.height);var h=cr(n.crop.rectangle,e("GET_MIN_PREVIEW_IMAGE_SIZE"))/(n.crop.draft.transforms.scale||n.crop.transforms.scale);d.width=It(d.width*h),d.height=It(d.height*h);var p={x:Math.sign(l.x-u.x),y:Math.sign(l.y-u.y)};n.crop.draft.rectangle=function(t,e,n,r,i,o,a){var c=jt(r),l=c.left,u=c.right,f=c.top,s=c.bottom,d=Pt({x:e.x,y:e.y},r),h=t.x>0?n.x:Math.min(d.x,n.x),p=t.x>0?Math.max(n.x,d.x):n.x,g=t.y>0?n.y:Math.min(d.y,n.y),m=t.y>0?Math.max(n.y,d.y):n.y;if(i){var y=d.x-n.x;t.x>0?p=Math.max(n.x,n.x+t.x*y):h=Math.min(n.x,n.x-t.x*y),t.y>0?m=Math.max(n.y,n.y+t.x*y*i):g=Math.min(n.y,n.y-t.x*y*i)}var v=Ft({top:g,right:p,bottom:m,left:h});Ft({top:g,right:p,bottom:m,left:h});if(o.width&&o.height){var E=o.width,w=o.height;i&&(1===i?w=E=Math.max(E,w):E<w?E=w/i:E>w?w=E*i:E=w/i),p-h<E&&(t.x>0?p=n.x+E:h=n.x-E),m-g<w&&(t.y>0?m=n.y+w:g=n.y-w);var _=a.width,T=a.height;i&&(i<1?_=T/i:T=_*i),p-h>_&&(t.x<0?h=n.x-_:p=n.x+_),m-g>T&&(t.y<0?g=n.y-T:m=n.y+T)}if(p-h==0&&(t.x>0?p=n.x+2:h=n.x-2),m-g==0&&(t.y>0?m=n.y+2:g=n.y-2),Math.round(h)<l||Math.round(p)>u||Math.round(g)<f||Math.round(m)>s){var b=s-f,O=u-l;if(h<l){h=l;var x=Math.min(p-h,O);p=h+x,i&&(t.y>0&&(m=n.y+x*i),t.y<0&&(g=n.y-x*i))}if(p>u){p=u;var R=Math.min(p-h,O);h=p-R,i&&(t.y>0&&(m=n.y+R*i),t.y<0&&(g=n.y-R*i))}if(g<f){g=f;var A=Math.min(m-g,b);m=g+A,i&&(t.x>0&&(p=n.x+A/i),t.x<0&&(h=n.x-A/i))}if(m>s){m=s;var I=Math.min(m-g,b);g=m-I,i&&(t.x>0&&(p=n.x+I/i),t.x<0&&(h=n.x-I/i))}v=Ft({top:g,right:p,bottom:m,left:h})}return{free:v,limited:Ft({top:g,right:p,bottom:m,left:h})}}(p,f,u,c,n.crop.aspectRatio,s,d),n.crop.limitToImageBounds&&(n.crop.draft.transforms=je(a,n.crop.draft.rectangle.limited,n.crop.transforms))},CROP_IMAGE_DRAG_GRAB:function(){return ar(n)||or(n)},CROP_IMAGE_DRAG_RELEASE:function(){nr(n),Jn(n),rr(n,e,t)},CROP_IMAGE_ROTATE_RELEASE:function(){nr(n),rr(n,e,t)},CROP_IMAGE_DRAG:function(t){var e,r,i,o,a,c,l,u,f=t.value;or(n),n.crop.draft.transforms=(e=n.image,r=n.crop.rectangle,i=n.crop.transforms,o=f,a=n.crop.limitToImageBounds,c={x:i.translation.x+o.x,y:i.translation.y+o.y},l=Wn({},De(i),{translation:c}),(u=a?Ue(e,r,l,"moving"):l).interaction={translation:c},u)},CROP_IMAGE_RESIZE_RELEASE:function(){e("GET_CROP_RESIZE_MATCH_IMAGE_ASPECT_RATIO")&&function(t){if(t.crop.draft.targetSize>=t.crop.draft.transforms.scale)return!1;if(null!==t.crop.aspectRatio)return!1;if(!1===t.crop.limitToImageBounds)return!1;if(0!==It(t.crop.rotation.sub,5))return!1;var e=It(t.crop.rotation.main/Hn,5)%2!=0?t.image.width/t.image.height:t.image.height/t.image.width,n=t.crop.rectangle.height/t.crop.rectangle.width;if(e===n)return!1;var r=Ht(t.stage,n);!!Gt(r,t.crop.rectangle)&&(t.crop.rectangle=Ht(t.stage,e))}(n),nr(n),Jn(n),rr(n,e,t)},CROP_IMAGE_RESIZE:function(t){var r=t.value;or(n);var i=n.crop.transforms;n.crop.draft.targetSize=i.scale+i.scale*r,n.crop.draft.transforms=ur(n.image,n.crop.rectangle,i,n.crop.draft.targetSize,e("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_MULTIPLY:function(t){var r=t.value;or(n);var i=n.crop.transforms;n.crop.draft.targetSize=i.scale*r,n.crop.draft.transforms=ur(n.image,n.crop.rectangle,i,n.crop.draft.targetSize,e("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_RESIZE_AMOUNT:function(t){var r=t.value;or(n);var i=n.crop.transforms;n.crop.draft.targetSize=(n.crop.draft.transforms?n.crop.draft.transforms.scale:i.scale)+r,n.crop.draft.transforms=ur(n.image,n.crop.rectangle,i,n.crop.draft.targetSize,e("GET_MIN_PREVIEW_IMAGE_SIZE"),n.crop.limitToImageBounds)},CROP_IMAGE_ROTATE:function(t){var r=t.value;or(n),n.crop.isRotating=!0,$n(n,{main:n.crop.rotation.main,sub:r},e("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds)},CROP_IMAGE_ROTATE_ADJUST:function(t){var r=t.value;or(n),$n(n,{main:n.crop.rotation.main,sub:Math.min(Math.PI/4,Math.max(-Math.PI/4,n.crop.rotation.sub+r))},e("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds),nr(n)},CROP_IMAGE_ROTATE_CENTER:function(){or(n),$n(n,{main:n.crop.rotation.main,sub:0},e("GET_MIN_PREVIEW_IMAGE_SIZE"),!1,n.crop.limitToImageBounds),nr(n)},CROP_IMAGE_ROTATE_LEFT:function(){ir(n,e,t),$n(n,{main:n.crop.rotation.main-Hn,sub:n.crop.rotation.sub},e("GET_MIN_PREVIEW_IMAGE_SIZE"),-Hn,n.crop.limitToImageBounds),nr(n),e("GET_CROP_FORCE_LETTERBOX")&&t("CROP_UPDATE_LETTERBOX")},CROP_IMAGE_ROTATE_RIGHT:function(){ir(n,e,t),$n(n,{main:n.crop.rotation.main+Hn,sub:n.crop.rotation.sub},e("GET_MIN_PREVIEW_IMAGE_SIZE"),Hn,n.crop.limitToImageBounds),nr(n),e("GET_CROP_FORCE_LETTERBOX")&&t("CROP_UPDATE_LETTERBOX")},CROP_IMAGE_FLIP_HORIZONTAL:function(){ir(n,e,t),0===It(n.crop.rotation.main%Math.PI/2,5)?n.crop.flip.horizontal=!n.crop.flip.horizontal:n.crop.flip.vertical=!n.crop.flip.vertical,n.crop.isDirty=!0},CROP_IMAGE_FLIP_VERTICAL:function(){ir(n,e,t),0===It(n.crop.rotation.main%Math.PI/2,5)?n.crop.flip.vertical=!n.crop.flip.vertical:n.crop.flip.horizontal=!n.crop.flip.horizontal,n.crop.isDirty=!0},DID_RECEIVE_IMAGE_DATA:function(t){var e=t.previewData,r=t.thumbData;n.file.preview=e,n.file.thumb=r},MARKUP_SET_VALUE:function(t){var e=t.value;n.markup=e},MARKUP_ADD:function(e){n.markup.forEach(function(t){return t[1].isSelected=!1}),n.markup=n.markup.filter(function(t){return!t[1].isDestroyed});var r=jn(e);n.markup.push(r),n.markup.sort(wn),t("MARKUP_SELECT",{id:r[1].id}),n.crop.isDirty=!0},MARKUP_SELECT:function(t){var e=t.id;n.markup.forEach(function(t){t[1].isSelected=t[1].id===e,t[1].isDirty=!0})},MARKUP_ELEMENT_DRAG:function(t){var e=t.id,r=t.origin,i=t.offset,o=t.size,a=n.markup.find(function(t){return t[1].id===e});if(a){var c=a[1],l=r.x/o.width,u=r.y/o.height,f=r.width/o.width,s=r.height/o.height,d=i.x/o.width,h=i.y/o.height;c.x=l+d,c.y=u+h,c.width=f,c.height=s,c.left=void 0,c.top=void 0,c.right=void 0,c.bottom=void 0,c.isDirty=!0,n.crop.isDirty=!0}},MARKUP_ELEMENT_RESIZE:function(t){var e=t.id,r=t.corner,i=t.origin,o=t.offset,a=t.size,c=n.markup.find(function(t){return t[1].id===e});if(c){var l=zn(c,2),u=l[0],f=l[1],s=(i.x+o.x)/a.width,d=(i.y+o.y)/a.height;if(/n/.test(r))if("line"===u)f.height=f.height-(d-f.y),f.y=d;else{var h=f.y+f.height;d>h&&(d=h),f.height=f.height-(d-f.y),f.y=d}if(/w/.test(r))if("line"===u)f.width=f.width-(s-f.x),f.x=s;else{var p=f.x+f.width;s>p&&(s=p),f.width=f.width-(s-f.x),f.x=s}/s/.test(r)&&(f.height="line"===u?d-f.y:Math.max(0,d-f.y)),/e/.test(r)&&(f.width="line"===u?s-f.x:Math.max(0,s-f.x)),f.left=void 0,f.top=void 0,f.right=void 0,f.bottom=void 0,f.isDirty=!0,n.crop.isDirty=!0}},MARKUP_DELETE:function(e){var r=e.id,i=n.markup.find(function(t){return t[1].id===r});if(i){var o=i[1];o.allowDestroy&&(o.isDestroyed=!0,o.isSelected=!1,o.isDirty=!0);for(var a=null,c=n.markup.length;c>0;){c--;var l=n.markup[c][1];if(!l.isDestroyed&&l.allowDestroy){a=l.id;break}}t("MARKUP_SELECT",{id:a})}},MARKUP_UPDATE:function(t){var e=t.id,r=t.props,i=n.markup.find(function(t){return t[1].id===e});if(i){var o=i[1];Object.keys(r).forEach(function(t){o[t]=r[t]}),o.isDirty=!0,n.crop.isDirty=!0}},COLOR_SET_COLOR_VALUE:function(e){var r=e.key,i=e.value;n.crop.isDirty=!0,t("COLOR_SET_VALUE",{key:r,value:i})},COLOR_SET_VALUE:function(e){var r=e.key,i=e.value;n.colorValues[r]=i,t("SET_COLOR_MATRIX",{key:r,matrix:Yn[r](i)})}},Object.keys(Yn).reduce(function(r,i){var o=i.toUpperCase(),a=Dn(i);return r["SET_COLOR_".concat(o)]=function(r){var c=r.value;if(c!==r.prevValue){var l=zn(e("GET_COLOR_".concat(o,"_RANGE")),2),u=l[0],f=l[1],s=At(c,u,f);n.options["color".concat(a)]=s,n.instructions.color||(n.instructions.color={}),n.instructions.color[i]=s,t("COLOR_SET_VALUE",{key:i,value:s})}},r},{}),{SET_COLOR_MATRIX:function(e){var r=e.key,i=e.matrix;i?n.colorMatrices[r]=Fn(i):delete n.colorMatrices[r],t("DID_SET_COLOR_MATRIX",{key:r,matrix:i})},FILTER_SET_FILTER:function(e){var r=e.value;n.crop.isDirty=!0,t("FILTER_SET_VALUE",{value:r})},FILTER_SET_VALUE:function(r){var i=r.value,o=Gn(i)?i:null;if(X(i)){var a=e("GET_FILTERS");u(a,function(t,e){t===i&&(o=e.matrix())})}n.filter=i,n.filterName=X(i)?i:null,t("SET_COLOR_MATRIX",{key:"filter",matrix:o})},DID_SET_FILTER:function(e){var n=e.value;n!==e.prevValue&&(t("FILTER_SET_VALUE",{value:n}),t("SET_DATA",{filter:n}))},DID_SET_SIZE:function(e){var n=e.value;n!==e.prevValue&&t("SET_DATA",{size:n})},DID_SET_CROP:function(e){var n=e.value;n!==e.prevValue&&t("SET_DATA",{crop:n})},DID_SET_MARKUP:function(e){var n=e.value,r=e.prevValue;n!==r&&JSON.stringify(n)===JSON.stringify(r)||t("SET_DATA",{markup:n})},SET_DATA:function(r){if(r.size&&e("ALLOW_MANUAL_RESIZE")){var i=Wn({width:null,height:null},r.size),o=le(i,e("GET_SIZE_MIN"),e("GET_SIZE_MAX"),null);n.instructions.size=Wn({},o),t("RESIZE_SET_OUTPUT_SIZE",o)}r.filter&&(n.instructions.filter=r.filter),n.instructions.markup=r.markup||[],n.instructions.color=Object.keys(Yn).reduce(function(t,e){return t[e]=void 0===r.color||void 0===r.color[e]?n.options["color".concat(Dn(e))]:r.color[e],t},{}),r.crop&&(n.instructions.crop=Pn(e,n,r.crop,n.size),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,!1===n.instructions.crop.scaleToFit&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),t("EDIT_RESET"))},DID_SET_INITIAL_STATE:function(t){var r=t.value||{},i=r.crop,o=r.filter,a=r.color,c=r.size,l=void 0===c?{}:c,u=r.markup,f=void 0===u?[]:u,s=Wn({width:null,height:null},l),d=le(s,e("GET_SIZE_MIN"),e("GET_SIZE_MAX"),null);n.instructions.size=Wn({},d),n.instructions.crop=Pn(e,n,i),n.crop.limitToImageBounds=n.options.cropLimitToImageBounds,!1===n.instructions.crop.scaleToFit&&(n.crop.limitToImageBounds=n.instructions.crop.scaleToFit),n.instructions.filter=o||null,n.instructions.color=Object.keys(Yn).reduce(function(t,e){return t[e]=void 0===a||void 0===a[e]?n.options["color".concat(Dn(e))]:a[e],t},{}),n.instructions.markup=f,n.crop.isDirty=!0},GET_DATA:function(r){var i=r.success,o=r.failure,a=r.file,c=r.data;if(n.file&&n.stage){var l={file:Z(a)?a:e("GET_OUTPUT_FILE"),data:Z(c)?c:e("GET_OUTPUT_DATA"),success:i,failure:o};t(l.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",l)}},REQUEST_PREPARE_OUTPUT:function(e){var n=e.file,r=e.data,i=e.success,o=e.failure;t("PREPARE_OUTPUT",{file:n,data:r,success:i,failure:o},!0),t("DID_REQUEST_PREPARE_OUTPUT")},PREPARE_OUTPUT:function(r){var i=r.file,o=r.data,a=r.success,c=void 0===a?function(){}:a,l=r.failure,u=void 0===l?function(){}:l;if(fr(n))return t("ABORT_IMAGE");Qn({file:i,data:o},n,e).then(function(e){if(t("DID_PREPARE_OUTPUT"),fr(n))return t("ABORT_IMAGE");c(e)}).catch(function(e){if(fr(n))return t("ABORT_IMAGE");u(e)})},EDIT_RESET:function(){or(n),tr(n,e,t)},EDIT_CONFIRM:function(){if(n.file&&n.stage){or(n),t("CROP_ZOOM");var r={file:e("GET_OUTPUT_FILE"),data:e("GET_OUTPUT_DATA"),success:function(e){n.filePromise.resolveOnConfirm&&n.filePromise.success(e),t("DID_CONFIRM",{output:e})},failure:console.error};t(r.file?"REQUEST_PREPARE_OUTPUT":"PREPARE_OUTPUT",r)}},EDIT_CANCEL:function(){n.filePromise&&n.filePromise.success(null),t("DID_CANCEL")},EDIT_CLOSE:function(){or(n)},EDIT_DESTROY:function(){ot(n)},SET_OPTIONS:function(e){var n=e.options;u(n,function(e,n){t("SET_".concat(at(e,"_").toUpperCase()),{value:n})})}})},dr=function(t,e){return F({ignoreRect:!0,name:t,mixins:e,create:function(t){var e=t.root,n=t.props;n.className&&e.element.classList.add(n.className),n.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})},hr=F({ignoreRect:!0,ignoreRectUpdate:!0,name:"button",mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}},apis:["id"],listeners:!0},tag:"button",create:function(t){var e=t.root,n=t.props;e.element.innerHTML="".concat(n.icon||"","<span>").concat(n.label,"</span>"),e.element.setAttribute("type",n.type||"button"),n.name&&n.name.split(" ").forEach(function(t){e.element.className+=" doka--button-".concat(t)}),e.ref.handleClick=function(){"string"==typeof n.action?e.dispatch(n.action):n.action()},e.element.addEventListener("click",e.ref.handleClick),n.create&&n.create({root:e,props:n})},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),pr=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;return'<svg width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 ').concat(e," ").concat(e,'" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">').concat(t,"</svg>")},gr=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return F({ignoreRect:!0,tag:t,create:function(t){t.root.element.textContent=e}})},mr=function(t){t.element.dataset.viewStatus="idle",yr(t)},yr=function(t){t.ref.busyIndicators.forEach(function(t){t.translateY=-10,t.opacity=0,t.markedForRemoval=!0})},vr=function(t,e,n){t.element.dataset.viewStatus="busy";var r=Er(t,e,n);yr(t),t.ref.busyIndicators.push(r),r.markedForRemoval=!1,r.translateY=0,r.opacity=1},Er=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.appendChildView(t.createChildView(dr("status-bubble",{styles:["opacity","translateY"],apis:["markedForRemoval"],animations:{opacity:{type:"tween",duration:500},translateY:{type:"spring",mass:20}}}),{translateY:20,opacity:0,controls:[{view:dr("status-bubble-inner"),controls:n?[{view:hr,label:"Close",name:"icon-only status-bubble-close",icon:pr('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></g>'),action:n},{view:gr("p",e)}]:[{view:gr("p",e)}]}]}))},wr=F({name:"edit-status",ignoreRect:!0,create:function(t){var e=t.root;e.ref.busyIndicators=[],e.element.setAttribute("tabindex",-1)},write:z({MISSING_WEBGL:function(t){var e=t.root,n=/fullscreen/.test(e.query("GET_STYLE_LAYOUT_MODE"));vr(e,e.query("GET_LABEL_STATUS_MISSING_WEB_G_L"),n?function(){e.dispatch("EDIT_CANCEL")}:null)},AWAITING_IMAGE:function(t){var e=t.root;vr(e,e.query("GET_LABEL_STATUS_AWAITING_IMAGE"))},DID_PRESENT_IMAGE:function(t){var e=t.root;mr(e)},DID_LOAD_IMAGE_ERROR:function(t){var e=t.root,n=/fullscreen/.test(e.query("GET_STYLE_LAYOUT_MODE"));vr(e,e.query("GET_LABEL_STATUS_LOAD_IMAGE_ERROR"),n?function(){e.dispatch("EDIT_CANCEL")}:null)},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root;vr(e,e.query("GET_LABEL_STATUS_LOADING_IMAGE"))},DID_REQUEST_PREPARE_OUTPUT:function(t){var e=t.root;vr(e,e.query("GET_LABEL_STATUS_PROCESSING_IMAGE"))},DID_PREPARE_OUTPUT:function(t){var e=t.root;mr(e)}}),didWriteView:function(t){var e=t.root;e.ref.busyIndicators=e.ref.busyIndicators.filter(function(t){return!t.markedForRemoval||0!==t.opacity||(e.removeChildView(t),!1)})}}),_r={down:"pointerdown",move:"pointermove",up:"pointerup"},Tr=function(){var t=[],e=function(e){return t.findIndex(function(t){return t.pointerId===e.pointerId})};return{update:function(n){var r=e(n);r<0||(t[r]=n)},multiple:function(){return t.length>1},count:function(){return t.length},active:function(){return t.concat()},push:function(n){(function(t){return e(t)>=0})(n)||t.push(n)},pop:function(n){var r=e(n);r<0||t.splice(r,1)}}},br=function(t,e,n,r){return t.addEventListener(_r[e],n,r)},Or=function(t,e,n){return t.removeEventListener(_r[e],n)},xr=function(t,e){"contains"in t&&t.contains(e);var n=e;do{if(n===t)return!0}while(n=n.parentNode);return!1},Rr=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{stopPropagation:!0,cancelOnMultiple:!1},o={x:0,y:0},a={enabled:!0,origin:null,cancel:!1,cancelled:!1,pointers:Tr()},c=function(t){return{x:t.pageX-o.x,y:t.pageY-o.y}},l=null,u=function(t,e){e&&(l||f(t,e),cancelAnimationFrame(l),l=requestAnimationFrame(function(){f(t,e),l=null}))},f=function(t,e){return e.apply(null,[t,c(t)])},s=function(n){var r=0===a.pointers.count();r&&(a.active=!1,a.cancel=!1,a.cancelled=!1),a.pointers.push(n),br(document.documentElement,"up",h),r?(t===n.target||xr(t,n.target))&&n.isPrimary&&(n.preventDefault(),i.stopPropagation&&(n.stopPropagation(),n.stopImmediatePropagation()),a.active=!0,o.x=n.pageX,o.y=n.pageY,br(document.documentElement,"move",d),e(n)):i.cancelOnMultiple&&(a.cancel=!0)},d=function(t){t.isPrimary&&(a.cancelled||(t.preventDefault(),i.stopPropagation&&t.stopPropagation(),u(t,n),a.cancel&&(a.cancelled=!0,u(t,r))))},h=function t(e){a.pointers.pop(e),0===a.pointers.count()&&(Or(document.documentElement,"move",d),Or(document.documentElement,"up",t)),a.active&&(a.cancelled||(e.preventDefault(),i.stopPropagation&&e.stopPropagation(),u(e,n),u(e,r)))};return br(document.documentElement,"down",s),{enable:function(){a.enabled||br(document.documentElement,"down",s),a.enabled=!0},disable:function(){a.enabled&&Or(document.documentElement,"down",s),a.enabled=!1},destroy:function(){Or(document.documentElement,"up",h),Or(document.documentElement,"move",d),Or(document.documentElement,"down",s)}}},Ar={type:"spring",stiffness:.4,damping:.65,mass:7};function Ir(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Cr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Sr=function(t,e){return Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})},Mr=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&Sr(n,e),n},Lr=["nw","se"],Pr=["nw","n","ne","w","e","sw","s","se"],Dr={nw:"nwse",n:"ns",ne:"nesw",w:"ew",e:"ew",sw:"nesw",s:"ns",se:"nwse"},kr={nw:function(t){return{x:t.x,y:t.y}},n:function(t){return{x:t.x+.5*t.width,y:t.y}},ne:function(t){return{x:t.x+t.width,y:t.y}},w:function(t){return{x:t.x,y:t.y+.5*t.height}},e:function(t){return{x:t.x+t.width,y:t.y+.5*t.height}},sw:function(t){return{x:t.x,y:t.y+t.height}},s:function(t){return{x:t.x+.5*t.width,y:t.y+t.height}},se:function(t){return{x:t.x+t.width,y:t.y+t.height}}},Gr=F({tag:"div",name:"image-markup",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:"spring",markupX:Ar,markupY:Ar,markupWidth:Ar,markupHeight:Ar},listeners:!0,apis:["toolsReference","onSelect","onDrag","markupX","markupY","markupWidth","markupHeight","allowInteraction"]},create:function(t){var e=t.root,n=t.props,r=n.onSelect,i=void 0===r?function(){}:r,o=n.onUpdate,a=void 0===o?function(){}:o,c=Mr("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"});e.ref.canvas=c;var l=e.query("GET_ROOT_SIZE");c.setAttribute("width",l.width),c.setAttribute("height",l.height);var u=document.createElement("input");Sr(u,{type:"text",autocomplete:"off",autocapitalize:"off"}),u.addEventListener("keydown",function(t){t.stopPropagation(),13===t.keyCode||9===t.keyCode?(t.target.blur(),s()):8!==t.keyCode||e.ref.input.value.length||e.dispatch("MARKUP_DELETE",{id:e.ref.selected.id})}),e.appendChild(u),e.ref.input=u,e.ref.elements=[],e.ref.viewSize={},e.ref.resetSelected=function(){return e.ref.selected={id:null,type:null,settings:{}},e.ref.selected},e.ref.resetSelected();var f=function(t){return t.id?t:t.parentNode},s=function(){e.ref.resetSelected(),i(null)};e.ref.handleDeselect=function(t){var r;e.query("IS_ACTIVE_VIEW","markup")&&(e.ref.selected.id&&t.target!==e.ref.removeButton.element&&(r=t.target,e.ref.selected.id!==f(r).id&&(function(t){return xr(e.ref.manipulatorGroup,t)||t===e.ref.input}(t.target)||n.isMarkupUtil(t.target)||s())))},br(document.body,"down",e.ref.handleDeselect),e.ref.handleTextInput=function(){return a(e.ref.selected.id,{text:e.ref.input.value})},e.ref.input.addEventListener("input",e.ref.handleTextInput),e.ref.handleAttemptDelete=function(t){e.query("IS_ACTIVE_VIEW","markup")&&(!e.ref.selected.id||8!==t.keyCode&&46!==t.keyCode||(t.stopPropagation(),t.preventDefault(),e.dispatch("MARKUP_DELETE",{id:e.ref.selected.id})))},document.body.addEventListener("keydown",e.ref.handleAttemptDelete);var d=Mr("g"),h=Mr("g");d.appendChild(h),e.ref.shapeGroup=h;var p=Mr("g",{fill:"none",class:"doka--manipulator-group"}),g=Mr("rect",{x:0,y:0,width:0,height:0,fill:"none"}),m=Mr("line",{x1:0,y1:0,x2:0,y2:0});p.appendChild(m),p.appendChild(g),e.ref.manipulatorLine=m,e.ref.manipulatorRect=g,e.ref.manipulators=[];for(var y=0;y<10;y++){var v=Mr("circle",{r:6,"stroke-width":2,style:"display:none"});p.appendChild(v),e.ref.manipulators.push(v)}d.appendChild(p),e.ref.manipulatorGroup=p,c.appendChild(d),e.element.appendChild(c),e.ref.shapeOffsetGroup=d,e.ref.removeButton=e.appendChildView(e.createChildView(hr,{label:e.query("GET_LABEL_MARKUP_REMOVE_SHAPE"),name:"destroy-shape",action:function(){e.dispatch("MARKUP_DELETE",{id:e.ref.selected.id})}})),e.query("IS_ACTIVE_VIEW","markup")&&(e.element.dataset.active=!0)},destroy:function(t){var e=t.root;e.ref.elements.concat(e.ref.manipulators).forEach(function(t){t.dragger&&t.dragger.destroy()}),e.ref.input.removeEventListener("input",e.ref.handleTextInput),document.body.removeEventListener("keydown",e.ref.handleAttemptDelete),Or(document.body,"down",e.ref.handleDeselect)},read:function(t){var e=t.root;if(!e.rect.element.hidden)for(var n in e.ref.elements){var r=e.ref.elements[n];if(r&&"text"===r.nodeName&&r.parentNode){var i=r.getBBox();r.bbox={x:i.x,y:i.y,width:i.width,height:i.height}}}},write:z({SHOW_VIEW:function(t){var e=t.root;"markup"===t.action.id?e.element.dataset.active=!0:e.element.dataset.active=!1},MARKUP_SET_VALUE:function(t){t.root.ref.shapeGroup.innerHTML=""},UPDATE_ROOT_RECT:function(t){var e=t.root,n=t.action,r=e.ref.canvas;r.setAttribute("width",n.rect.width),r.setAttribute("height",n.rect.height),e.ref.previousScale=null}},function(t){var e=t.root,n=t.props,r=t.timestamp;if(!(e.opacity<=0)){var i=e.query("GET_CROP",n.id,r);if(i){var o=i.markup,a=i.cropStatus,c=n.onSelect,l=n.onDrag,u=e.ref,f=u.viewSize,s=u.shapeOffsetGroup,d=u.manipulators,h=u.manipulatorLine,p=u.manipulatorRect,g=u.removeButton,m=e.query("GET_OUTPUT_WIDTH"),y=e.query("GET_OUTPUT_HEIGHT"),v=a.image,E=a.crop,w=E.width,_=E.height,T=E.widthFloat/E.heightFloat;if(m||y){var b=e.query("GET_OUTPUT_FIT");m&&!y&&(y=m),y&&!m&&(m=y);var O,x=m/w,R=y/_;if("force"===b)w=m,_=y;else"cover"===b?O=Math.max(x,R):"contain"===b&&(O=Math.min(x,R)),w*=O,_*=O}else v.width&&v.height?(w=v.width,_=v.height):v.width&&!v.height?(w=v.width,_=v.width/T):v.height&&!v.width&&(_=v.height,w=v.height*T);var A=It(e.markupX,3),I=It(e.markupY,3),C=It(e.markupWidth,3),S=It(e.markupHeight,3),M=It(Math.min(e.markupWidth/w,e.markupHeight/_),4);if(f.width=C,f.height=S,Vr(e,{markupX:A,markupY:I,scale:M,markup:o,currentWidth:w,currentHeight:_})&&(s.setAttribute("transform","translate(".concat(A," ").concat(I,")")),e.ref.previousX=A,e.ref.previousY=I,e.ref.previousScale=M,e.ref.previousCurrentHeight=_,e.ref.previousCurrentWidth=w,e.ref.previousMarkupLength=o.length,!(f.width<1||f.height<1))){var L,P=o.find(function(t){return t[1].isSelected}),D=P&&e.ref.selected.id!==P[1].id||e.ref.selected.id&&!P;L=P?e.ref.selected={id:P[1].id,type:P[0],settings:P[1]}:e.ref.resetSelected(),e.ref.input.hidden="text"!==e.ref.selected.type,g.element.dataset.active=null!==e.ref.selected.id,h.setAttribute("style","opacity:0"),p.setAttribute("style","opacity:0"),d.forEach(function(t){return t.setAttribute("style","opacity:0;pointer-events:none;")});var k=e.query("GET_MARKUP_FILTER");o.filter(k).sort(wn).forEach(function(t,r){var i=Cr(t,2),o=i[0],a=i[1],u=a.id,s=a.isDestroyed,m=a.isDirty,y=a.isSelected,v=a.allowSelect,E=a.allowMove,w=a.allowResize,_=a.allowInput;if(s){var T=e.ref.elements[u];T&&(T.dragger&&T.dragger.destroy(),e.ref.elements[u]=null,T.parentNode.removeChild(T))}else{var b,O,x,R=e.ref.elements[u];if(!R)if(R=vn(o,a),e.ref.elements[u]=R,v)R.dragger=Rr(R,function(){O=Date.now(),b=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ir(t,e,n[e])})}return t}({},R.rect),(x=u===e.ref.selected.id)||c(u)},function(t,e){E&&l(u,b,e,f,M)},function(t,n){if(_&&"text"===o&&x){var r=Mt({x:0,y:0},n),i=Date.now()-O;if(!(r>10||i>750)){e.ref.input.focus();var a=e.markupX+R.bbox.x,c=R.bbox.width,l=(t.offsetX-a)/c,u=Math.round(e.ref.input.value.length*l);e.ref.input.setSelectionRange(u,u)}}}),R.dragger.disable();else R.setAttribute("style","pointer-events:none;");if(R.dragger&&(n.allowInteraction?R.dragger.enable():R.dragger.disable()),r!==R.index){R.index=r;var A=e.ref.shapeGroup;A.insertBefore(R,A.childNodes[r+1])}if(m&&En(R,o,a,f,M),y){var I=g.rect.element.width,C=g.rect.element.height,S=e.markupX-.5*I,L=e.markupY-C-15,P="text"===o?R.bbox:R.rect;"line"===o?(S+=P.x,L+=P.y,Sr(h,{x1:P.x,y1:P.y,x2:P.x+P.width,y2:P.y+P.height,style:"opacity:1"})):P&&(L+=P.y,S+=P.x+.5*P.width,Sr(p,{x:P.x-("text"===o?5:0),y:P.y,width:P.width+("text"===o?10:0),height:P.height,style:"opacity:1"}));var D=e.markupY+10,k=e.markupY+e.markupHeight-10,G=e.markupX+10,U=e.markupX+e.markupWidth-10;if(L<D?L=D:L+C>k&&(L=k-C),S<G?S=G:S+I>U&&(S=U-I),P||(g.element.dataset.active="false"),g.element.setAttribute("style","transform: translate3d(".concat(S,"px, ").concat(L,"px, 0)")),"text"===o&&P){var V=P.width+65,B=e.markupWidth-P.x,N="\n                        width: ".concat(Math.min(V,B),"px;\n                        height: ").concat(P.height,"px;\n                        color: ").concat(R.getAttribute("fill"),";\n                        font-family: ").concat(R.getAttribute("font-family"),";\n                        font-size: ").concat(R.getAttribute("font-size").replace(/px/,""),"px;\n                        font-weight: ").concat(R.getAttribute("font-weight")||"normal",";\n                    ");Tt()?N+="\n                            left: ".concat(Math.round(e.markupX+P.x),"px;\n                            top: ").concat(Math.round(e.markupY+P.y),"px;\n                        "):N+="\n                            transform: translate3d(".concat(Math.round(e.markupX+P.x),"px,").concat(Math.round(e.markupY+P.y),"px,0);\n                        "),e.ref.input.setAttribute("style",N),R.setAttribute("fill","none")}if("text"===o)return;if(!w)return;var j="line"===o?Lr:Pr;d.forEach(function(t,e){var n=j[e];if(n){var r="line"===o?"move":"".concat(Dr[n],"-resize"),i=kr[n](R.rect);Sr(t,{cx:i.x,cy:i.y,style:"opacity:1;cursor:".concat(r)})}})}a.isDirty=!1}}),D&&(Nr(e),"text"===L.type?e.ref.input.value=L.settings.text:e.ref.selected.id&&Br(e,n.onResize))}}}})}),Ur=function(t){return t.forEach(function(t){return t[1].isDirty=!0})},Vr=function(t,e){var n=e.markup,r=e.markupX,i=e.markupY,o=e.currentWidth,a=e.currentHeight,c=e.scale;return r!==t.ref.previousX?(Ur(n),!0):i!==t.ref.previousY?(Ur(n),!0):c!==t.ref.previousScale?(Ur(n),!0):a!==t.ref.previousCurrentHeight?(Ur(n),!0):o!==t.ref.previousCurrentWidth?(Ur(n),!0):n.length!==t.ref.previousMarkupLength||!!n.find(function(t){return t[1].isDirty})},Br=function(t,e){var n=t.ref.selected.id,r="g"===t.ref.elements[n].nodeName?Lr:Pr;t.ref.manipulators.forEach(function(i,o){var a=r[o];if(a){var c=null;i.dragger=Rr(i,function(){c={x:parseFloat(s(i,"cx")),y:parseFloat(s(i,"cy"))}},function(r,i){e(n,a,c,i,t.ref.viewSize)},null,{stopPropagation:!0})}})},Nr=function(t){t.ref.manipulators.forEach(function(t){t.dragger&&(t.dragger.destroy(),t.dragger=null)})},jr={38:"up",40:"down",37:"left",39:"right",189:"minus",187:"plus",72:"h",76:"l",81:"q",82:"r",84:"t",86:"v",90:"z",219:"left_bracket",221:"right_bracket"},Fr=function(t,e,n,r,i){var o=null,a=!0,c={enabled:!0},l=function(t){var i=jr[t.keyCode]||t.keyCode;n[i]&&(t.stopPropagation(),a&&(o=e(i),a=!1),n[i](o),r(o))},u=function(t){var e=jr[t.keyCode]||t.keyCode;n[e]&&(t.stopPropagation(),i(o),a=!0)};return t.addEventListener("keydown",l),t.addEventListener("keyup",u),{enable:function(){c.enabled||(t.addEventListener("keydown",l),t.addEventListener("keyup",u)),c.enabled=!0},disable:function(){c.enabled&&(t.removeEventListener("keydown",l),t.removeEventListener("keyup",u)),c.enabled=!1},destroy:function(){t.removeEventListener("keydown",l),t.removeEventListener("keyup",u)}}},zr={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},Wr=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4?arguments[4]:void 0;e=Math.round(e),n=Math.round(n);var o=i||document.createElement("canvas"),a=o.getContext("2d");return r>=5&&r<=8?(o.width=n,o.height=e):(o.width=e,o.height=n),a.save(),function(t,e,n,r){-1!==r&&t.transform.apply(t,zr[r](e,n))}(a,e,n,r),a.drawImage(t,0,0,e,n),a.restore(),o},qr=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},Yr=function(t,e,n){var r=t.createShader(n);return t.shaderSource(r,e),t.compileShader(r),r},Hr=function(t,e,n){var r=t.createProgram();return t.attachShader(r,Yr(t,e,t.VERTEX_SHADER)),t.attachShader(r,Yr(t,n,t.FRAGMENT_SHADER)),t.linkProgram(r),r},Zr=function(){return{x:arguments.length<3?0:arguments.length<=0?void 0:arguments[0],y:arguments.length<3?0:arguments.length<=1?void 0:arguments[1],width:arguments.length<3?arguments.length<=0?void 0:arguments[0]:arguments.length<=2?void 0:arguments[2],height:1===arguments.length?arguments.length<=0?void 0:arguments[0]:arguments.length<3?arguments.length<=1?void 0:arguments[1]:arguments.length<=3?void 0:arguments[3]}},Xr=function(t,e){return{x:t.x*e,y:t.y*e,width:t.width*e,height:t.height*e}},Kr=function(){var t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Qr=function(t,e,n,r,i){var o=1/Math.tan(e/2),a=1/(r-i);t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,t[10]=(i+r)*a,t[14]=2*i*r*a},Jr=function(t,e){var n=e[0],r=e[1],i=e[2];t[12]=t[0]*n+t[4]*r+t[8]*i+t[12],t[13]=t[1]*n+t[5]*r+t[9]*i+t[13],t[14]=t[2]*n+t[6]*r+t[10]*i+t[14],t[15]=t[3]*n+t[7]*r+t[11]*i+t[15]},$r=function(t,e){var n=e[0],r=e[1],i=e[2];t[0]=t[0]*n,t[1]=t[1]*n,t[2]=t[2]*n,t[3]=t[3]*n,t[4]=t[4]*r,t[5]=t[5]*r,t[6]=t[6]*r,t[7]=t[7]*r,t[8]=t[8]*i,t[9]=t[9]*i,t[10]=t[10]*i,t[11]=t[11]*i},ti=function(t,e){var n=Math.sin(e),r=Math.cos(e),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],f=t[10],s=t[11];t[4]=i*r+l*n,t[5]=o*r+u*n,t[6]=a*r+f*n,t[7]=c*r+s*n,t[8]=l*r-i*n,t[9]=u*r-o*n,t[10]=f*r-a*n,t[11]=s*r-c*n},ei=function(t,e){var n=Math.sin(e),r=Math.cos(e),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],u=t[9],f=t[10],s=t[11];t[0]=i*r-l*n,t[1]=o*r-u*n,t[2]=a*r-f*n,t[3]=c*r-s*n,t[8]=i*n+l*r,t[9]=o*n+u*r,t[10]=a*n+f*r,t[11]=c*n+s*r},ni=function(t,e){var n=Math.sin(e),r=Math.cos(e),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],u=t[5],f=t[6],s=t[7];t[0]=i*r+l*n,t[1]=o*r+u*n,t[2]=a*r+f*n,t[3]=c*r+s*n,t[4]=l*r-i*n,t[5]=u*r-o*n,t[6]=f*r-a*n,t[7]=s*r-c*n};function ri(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var ii="\nattribute vec4 aPosition;\nvoid main() {\n\tgl_Position = aPosition;\n}\n",oi=function(t,e,n){var r=Zr(),i=null,o=30*Math.PI/180,a=Math.tan(o/2),c={antialias:!1,alpha:!1},l=t.getContext("webgl",c)||t.getContext("experimental-webgl",c);if(!l)return null;l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA);var u=Hr(l,ii,"\nprecision mediump float;\n\nuniform vec2 uViewportSize;\nuniform vec3 uColorStart;\nuniform vec3 uColorEnd;\nuniform vec2 uOverlayLeftTop;\nuniform vec2 uOverlayRightBottom;\nuniform vec4 uColorCanvasBackground;\n\nvoid main() {\n\n\tfloat x = gl_FragCoord.x;\n\tfloat y = gl_FragCoord.y;\n\n\tvec2 center = vec2(.5, .5);\n\tvec2 st = vec2(x / uViewportSize.x, y / uViewportSize.y);\n\tfloat mixValue = distance(st, center) * 1.5; // expand outside view (same as doka--root::after)\n\tvec3 color = mix(uColorStart, uColorEnd, mixValue);\n\n\tif (uColorCanvasBackground[3] == 1.0) {\n\n\t\tfloat innerLeft = uOverlayLeftTop.x;\n\t\tfloat innerRight = uOverlayRightBottom.x;\n\t\tfloat innerTop = uOverlayRightBottom.y;\n\t\tfloat innerBottom = uOverlayLeftTop.y;\n\n\t\tif (x < innerLeft || x > innerRight || y < innerTop || y > innerBottom) {\n\t\t\tgl_FragColor = vec4(color, 1.0);\n\t\t\treturn;\n\t\t}\n\n\t\tgl_FragColor = uColorCanvasBackground;\n\t\treturn;\n\t}\n\t\n\tgl_FragColor = vec4(color, 1.0);\n}\n"),f=l.getUniformLocation(u,"uColorStart"),s=l.getUniformLocation(u,"uColorEnd"),d=l.getUniformLocation(u,"uViewportSize"),h=l.getAttribLocation(u,"aPosition"),p=l.getUniformLocation(u,"uOverlayLeftTop"),g=l.getUniformLocation(u,"uOverlayRightBottom"),m=l.getUniformLocation(u,"uColorCanvasBackground"),y=l.createBuffer(),v=new Float32Array([1,-1,1,1,-1,-1,-1,1]);l.bindBuffer(l.ARRAY_BUFFER,y),l.bufferData(l.ARRAY_BUFFER,v,l.STATIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,null);var E=Hr(l,ii,"\nprecision mediump float;\n\nuniform vec2 uOverlayLeftTop;\nuniform vec2 uOverlayRightBottom;\nuniform vec4 uOutlineColor;\nuniform float uOutlineWidth;\n\nvoid main() {\n\n\tfloat x = gl_FragCoord.x;\n\tfloat y = gl_FragCoord.y;\n\n\tfloat innerLeft = uOverlayLeftTop.x;\n\tfloat innerRight = uOverlayRightBottom.x;\n\tfloat innerTop = uOverlayRightBottom.y;\n\tfloat innerBottom = uOverlayLeftTop.y;\n\n\tfloat outerLeft = innerLeft - uOutlineWidth;\n\tfloat outerRight = innerRight + uOutlineWidth;\n\tfloat outerTop = innerTop - uOutlineWidth;\n\tfloat outerBottom = innerBottom + uOutlineWidth;\n\t\n\tif (x < outerLeft || x > outerRight || y < outerTop || y > outerBottom) {\n\t\tdiscard;\n\t}\n\n\tif (x < innerLeft || x > innerRight || y < innerTop || y > innerBottom) {\n\t\tgl_FragColor = uOutlineColor;\n\t}\n}\n"),w=l.getAttribLocation(E,"aPosition"),_=l.getUniformLocation(E,"uOutlineWidth"),T=l.getUniformLocation(E,"uOutlineColor"),b=l.getUniformLocation(E,"uOverlayLeftTop"),O=l.getUniformLocation(E,"uOverlayRightBottom"),x=l.createBuffer(),R=new Float32Array([1,-1,1,1,-1,-1,-1,1]);l.bindBuffer(l.ARRAY_BUFFER,x),l.bufferData(l.ARRAY_BUFFER,R,l.STATIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,null);var A=Hr(l,"\nattribute vec4 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 uMatrix;\n\n// send to fragment shader\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nvoid main () {\n    vPosition = uMatrix * aPosition;\n    gl_Position = vPosition;\n    vTexCoord = aTexCoord;\n}\n","\nprecision mediump float;\n\nuniform sampler2D uTexture;\nuniform vec2 uTextureSize;\n\nuniform float uColorOpacity;\nuniform mat4 uColorMatrix;\nuniform vec4 uColorOffset;\n\nuniform vec4 uOverlayColor;\nuniform vec2 uOverlayLeftTop;\nuniform vec2 uOverlayRightBottom;\n\n// received from vertex shader\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nvoid main () {\n\n\t// get texture color\n\tvec4 color = texture2D(uTexture, vTexCoord);\n\t\n\t// apply color matrix\n\tcolor = color * uColorMatrix + uColorOffset;\n\n\t// test if falls within \n    if ((gl_FragCoord.x < uOverlayLeftTop.x || gl_FragCoord.x > uOverlayRightBottom.x) || \n        (gl_FragCoord.y > uOverlayLeftTop.y || gl_FragCoord.y < uOverlayRightBottom.y)) {\n\t\tcolor *= uOverlayColor;\n\t}\n\t\n    gl_FragColor = color * uColorOpacity;\n}\n");l.useProgram(A);var I=l.getUniformLocation(A,"uMatrix"),C=l.getUniformLocation(A,"uTexture"),S=l.getUniformLocation(A,"uTextureSize"),M=l.getUniformLocation(A,"uOverlayColor"),L=l.getUniformLocation(A,"uOverlayLeftTop"),P=l.getUniformLocation(A,"uOverlayRightBottom"),D=l.getUniformLocation(A,"uColorOpacity"),k=l.getUniformLocation(A,"uColorOffset"),G=l.getUniformLocation(A,"uColorMatrix"),U=l.getAttribLocation(A,"aPosition"),V=l.getAttribLocation(A,"aTexCoord"),B=function(t,e,n,r,i){var o=t.createTexture();t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.uniform1i(e,r),t.uniform2f(n,i.width,i.height);try{t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)}catch(e){t.texImage2D(t.TEXTURE_2D,0,t.RGBA,i.width,i.height,0,t.RGBA,t.UNSIGNED_BYTE,null)}return o}(l,C,S,0,e),N=e.width*n,j=e.height*n,F=-.5*N,z=.5*j,W=.5*N,q=-.5*j,Y=new Float32Array([F,z,F,q,W,z,W,q]),H=new Float32Array([0,0,0,1,1,0,1,1]),Z=Y.length/2,X=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,X),l.bufferData(l.ARRAY_BUFFER,Y,l.STATIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,null);var K=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,K),l.bufferData(l.ARRAY_BUFFER,H,l.STATIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,null);return{release:function(){t.width=1,t.height=1},resize:function(e,o){var a,c;t.width=e*n,t.height=o*n,t.style.width="".concat(e,"px"),t.style.height="".concat(o,"px"),r.width=e*n,r.height=o*n,a=r.width,c=r.height,i=a/c,l.viewport(0,0,l.canvas.width,l.canvas.height)},update:function(t,c,v,R,C,S,N,j,F,z,W,q,Y,H,Q,J,$,tt,et){W=W?Xr(W,n):Zr(r.width,r.height);var nt=.5*r.width,rt=.5*r.height,it=e.width*n,ot=e.height*n;t*=n,c*=n,v*=n,R*=n;var at=ot/2/a*(r.height/W.height)*-1;at/=-a*at*2/r.height;var ct=.5*it,lt=.5*ot;t-=ct,c-=lt;var ut=j,ft=-(nt-ct)+v,st=rt-lt-R,dt=Kr();Qr(dt,o,i,1,2*-at),Jr(dt,[ft,st,at]),Jr(dt,[t,-c,0]),$r(dt,[ut,ut,ut]),ni(dt,-N),Jr(dt,[-t,c,0]),ei(dt,S),ti(dt,C),l.clearColor(H[0],H[1],H[2],1),l.clear(l.COLOR_BUFFER_BIT),l.useProgram(u),l.uniform3fv(f,Q),l.uniform3fv(s,J),l.uniform4fv(m,et.map(function(t,e){return e<3?t/255:t})),l.uniform2f(d,r.width,r.height),l.uniform2f(p,q.x*n,r.height-q.y*n),l.uniform2f(g,(q.x+q.width)*n,r.height-(q.y+q.height)*n),l.bindBuffer(l.ARRAY_BUFFER,y),l.vertexAttribPointer(h,2,l.FLOAT,!1,0,0),l.enableVertexAttribArray(h),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.useProgram(A),l.bindFramebuffer(l.FRAMEBUFFER,null),l.bindTexture(l.TEXTURE_2D,B),l.bindBuffer(l.ARRAY_BUFFER,X),l.vertexAttribPointer(U,2,l.FLOAT,!1,0,0),l.enableVertexAttribArray(U),l.bindBuffer(l.ARRAY_BUFFER,K),l.vertexAttribPointer(V,2,l.FLOAT,!1,0,0),l.enableVertexAttribArray(V),l.uniformMatrix4fv(I,!1,dt),q=Xr(q,n),l.uniform2f(L,q.x,r.height-q.y),l.uniform2f(P,q.x+q.width,r.height-(q.y+q.height)),l.uniform4fv(M,Y),l.uniform1f(D,z),l.uniform4f(k,F[4],F[9],F[14],F[19]),l.uniformMatrix4fv(G,!1,[].concat(ri(F.slice(0,4)),ri(F.slice(5,9)),ri(F.slice(10,14)),ri(F.slice(15,19)))),l.drawArrays(l.TRIANGLE_STRIP,0,Z),l.useProgram(E),l.uniform1f(_,$),l.uniform4fv(T,tt),l.uniform2f(b,q.x,r.height-q.y),l.uniform2f(O,q.x+q.width,r.height-(q.y+q.height)),l.bindBuffer(l.ARRAY_BUFFER,x),l.vertexAttribPointer(w,2,l.FLOAT,!1,0,0),l.enableVertexAttribArray(w),l.drawArrays(l.TRIANGLE_STRIP,0,4)}}};function ai(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ci=function(t){var e=0,n={},r=O(t),i=O(t),o=O(t),a=O(t);return r.onupdate=function(t){return n.x=t},r.oncomplete=function(){return e++},i.onupdate=function(t){return n.y=t},i.oncomplete=function(){return e++},o.onupdate=function(t){return n.width=t},o.oncomplete=function(){return e++},a.onupdate=function(t){return n.height=t},a.oncomplete=function(){return e++},{interpolate:function(t){r.interpolate(t),i.interpolate(t),o.interpolate(t),a.interpolate(t)},setTarget:function(t){e=0,r.target=t?t.x:null,i.target=t?t.y:null,o.target=t?t.width:null,a.target=t?t.height:null},getRect:function(){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ai(t,e,n[e])})}return t}({},n)},isStable:function(){return 4===e}}},li=function(t){var e=0,n={},r=O(t),i=O(t),o=O(t);return r.onupdate=function(t){return n.r=t},r.oncomplete=function(){return e++},i.onupdate=function(t){return n.g=t},i.oncomplete=function(){return e++},o.onupdate=function(t){return n.b=t},o.oncomplete=function(){return e++},{interpolate:function(t){r.interpolate(t),i.interpolate(t),o.interpolate(t)},setTarget:function(t){e=0,r.target=t?t[0]:null,i.target=t?t[1]:null,o.target=t?t[2]:null},getColor:function(){return[n.r,n.g,n.b]},isStable:function(){return 3===e}}},ui={stiffness:.25,damping:.25,mass:2.5},fi=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],si=F({name:"image-gl",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{apis:["top","left","width","height","xOrigin","yOrigin","xTranslation","yTranslation","xRotation","yRotation","zRotation","scale","overlay","stage","colorMatrix","colorOpacity","overlayOpacity","outlineWidth","isDraft"],animations:{xTranslation:Ar,yTranslation:Ar,xOrigin:Ar,yOrigin:Ar,scale:Ar,xRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},yRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},zRotation:{type:"spring",stiffness:.25,damping:.25,mass:2.5},colorOpacity:{type:"tween",delay:150,duration:750},overlayOpacity:"spring",introScale:{type:"spring",stiffness:.25,damping:.75,mass:15},outlineWidth:Ar}},create:function(t){var e=t.root;e.ref.canvas=document.createElement("canvas"),e.ref.canvas.width=0,e.ref.canvas.height=0,e.appendChild(e.ref.canvas),e.ref.gl=null,e.introScale=1,e.ref.isPreview="preview"===e.query("GET_STYLE_LAYOUT_MODE"),e.ref.shouldZoom=!e.ref.isPreview,e.ref.didZoom=!1,e.ref.backgroundColor=null,e.ref.backgroundColorSpring=li(ui),e.ref.backgroundColorCenter=null,e.ref.backgroundColorCenterSpring=li(ui),e.ref.overlaySpring=ci(Ar),e.ref.stageSpring=ci(Ar),e.ref.outlineSpring=O(Ar),e.ref.colorMatrixSpring=[],e.ref.colorMatrixStable=!0,e.ref.colorMatrixStableCount=0,e.ref.colorMatrixPositions=[];for(var n=0;n<20;n++)!function(){var t=n,r=O(ui);r.target=fi[t],r.onupdate=function(n){e.ref.colorMatrixPositions[t]=n},r.oncomplete=function(){e.ref.colorMatrixStableCount++},e.ref.colorMatrixSpring[t]=r}();e.ref.dragger=Rr(e.element,function(){e.dispatch("CROP_IMAGE_DRAG_GRAB")},function(t,n){e.dispatch("CROP_IMAGE_DRAG",{value:n})},function(){e.dispatch("CROP_IMAGE_DRAG_RELEASE")},{cancelOnMultiple:!0});var r=0,i=0;e.ref.keyboard=Fr(e.element,function(){return r=0,i=0,{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20},plus:function(){r+=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:r}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},minus:function(){r-=.1,e.dispatch("CROP_IMAGE_RESIZE_AMOUNT",{value:r}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")},left_bracket:function(){i-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:i})},right_bracket:function(){i+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:i})},h:function(){e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")},l:function(){e.dispatch("CROP_IMAGE_ROTATE_LEFT")},q:function(){e.dispatch("CROP_RESET")},r:function(){e.dispatch("CROP_IMAGE_ROTATE_RIGHT")},v:function(){e.dispatch("CROP_IMAGE_FLIP_VERTICAL")},z:function(){e.dispatch("CROP_ZOOM")}},function(t){t&&e.dispatch("CROP_IMAGE_DRAG",{value:t})},function(t){t&&e.dispatch("CROP_IMAGE_DRAG_RELEASE")});var o=e.query("GET_FILE"),a=URL.createObjectURL(o.data),c=function(t){var n=Ze(t,{width:e.query("GET_MAX_IMAGE_PREVIEW_WIDTH"),height:e.query("GET_MAX_IMAGE_PREVIEW_HEIGHT")}),r=Wr(t,n.width,n.height,o.orientation),i=Math.max(1,.75*window.devicePixelRatio),a=r.height/r.width,c=96*i,l=Wr(r,a>1?c:c/a,a>1?c*a:c),u=r.getContext("2d").getImageData(0,0,r.width,r.height),f=l.getContext("2d").getImageData(0,0,l.width,l.height);Ke(r),Ke(l),e.ref.gl=oi(e.ref.canvas,u,i),e.ref.gl?(e.dispatch("DID_RECEIVE_IMAGE_DATA",{previewData:u,thumbData:f}),e.dispatch("DID_PRESENT_IMAGE")):e.dispatch("MISSING_WEBGL")},l=function(){var t;(t=a,new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=function(t){n(t)},r.src=t})).then(c)};if(function(t){return"createImageBitmap"in window&&function(t){return/^image/.test(t.type)&&!/svg/.test(t.type)}(t)}(o.data)){var u=xn(qr);u.post({file:o.data},function(t){u.terminate(),t?c(t):l()})}else l();e.ref.previousLeft,e.ref.previousTop,e.ref.previousWidth,e.ref.previousHeight,e.ref.canvasStyle=getComputedStyle(e.ref.canvas),e.ref.previousBackgroundColor},destroy:function(t){var e=t.root;e.ref.gl&&(e.ref.gl.release(),e.ref.gl=null),e.ref.dragger.destroy()},read:function(t){var e=t.root,n=e.ref.canvasStyle.backgroundColor,r=e.ref.canvasStyle.color;if("transparent"!==r&&""!==r||(r=null),"transparent"!==n&&""!==n||(n=null),n&&n!==e.ref.previousBackgroundColor){var i=ue(n).map(function(t){return t/255}),o=(i[0]+i[1]+i[2])/3;e.ref.backgroundColor=i,e.ref.backgroundColorCenter=i.map(function(t){return o>.5?t-.15:t+.15}),e.ref.previousBackgroundColor=n}r&&r!==e.ref.previousOutlineColor&&(e.ref.outlineColor=ue(r).map(function(t){return t/255}).concat(1),e.ref.previousOutlineColor=r)},write:z({SHOW_VIEW:function(t){var e=t.root;"crop"===t.action.id?(e.element.setAttribute("tabindex",0),e.ref.dragger.enable()):(e.element.removeAttribute("tabindex"),e.ref.dragger.disable())}},function(t){var e=t.root,n=t.props,r=t.timestamp;if(e.ref.gl&&n.width&&n.height){var i=e.ref,o=i.gl,a=i.shouldZoom,c=i.stageSpring,l=i.overlaySpring,u=i.backgroundColorSpring,f=i.backgroundColorCenterSpring;n.width===e.ref.previousWidth&&n.height===e.ref.previousHeight||(e.ref.gl.resize(n.width,n.height),e.ref.previousWidth=n.width,e.ref.previousHeight=n.height),n.left===e.ref.previousLeft&&n.top===e.ref.previousTop||(e.ref.canvas.style.transform="translate(".concat(-n.left,"px, ").concat(-n.top,"px)"),e.ref.previousLeft=n.left,e.ref.previousTop=n.top),a&&!e.ref.didZoom&&(e.introScale=null,e.introScale=1.15,e.introScale=1,e.ref.didZoom=!0),u.setTarget(e.ref.backgroundColor),u.interpolate(r);var s=u.isStable();f.setTarget(e.ref.backgroundColorCenter),f.interpolate(r);var d=f.isStable();e.ref.colorMatrixStableCount=0;var h=n.colorMatrix||fi,p=e.ref.colorMatrixSpring.map(function(t,n){return t.target=h[n],t.interpolate(r),e.ref.colorMatrixPositions[n]}),g=20===e.ref.colorMatrixStableCount;n.isDraft&&l.setTarget(null),l.setTarget(n.overlay),l.interpolate(r);var m=l.isStable();n.isDraft&&c.setTarget(null),c.setTarget(n.stage),c.interpolate(r);var y=c.isStable();return o.update(e.xOrigin,e.yOrigin,e.xTranslation+n.left,e.yTranslation+n.top,e.xRotation,e.yRotation,e.zRotation,e.scale*e.introScale,p,e.ref.isPreview?1:e.colorOpacity,c.getRect(),l.getRect(),[1,1,1,1-e.overlayOpacity],u.getColor(),f.getColor(),u.getColor(),e.outlineWidth,e.ref.outlineColor,e.query("GET_BACKGROUND_COLOR")),m&&y&&g&&s&&d}})});function di(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var hi=F({name:"image",ignoreRect:!0,mixins:{apis:["offsetTop"]},create:function(t){var e=t.root,n=t.props;e.ref.imageGL=e.appendChildView(e.createChildView(si)),e.ref.createMarkup=function(){return e.ref.markup?e.ref.markup:(e.ref.markup=e.appendChildView(e.createChildView(Gr,{id:n.id,opacity:0,onSelect:function(t){e.dispatch("MARKUP_SELECT",{id:t})},onDrag:function(t,n,r,i,o){e.dispatch("MARKUP_ELEMENT_DRAG",{id:t,origin:n,offset:r,size:i,scale:o})},onResize:function(t,n,r,i,o){e.dispatch("MARKUP_ELEMENT_RESIZE",{id:t,corner:n,origin:r,offset:i,size:o})},onUpdate:function(t,n){e.dispatch("MARKUP_UPDATE",{id:t,props:n})},isMarkupUtil:function(t){var e=t;do{if("doka--markup-tools"===e.className)return!0}while(e=e.parentNode);return!1}})),e.ref.markup)},e.ref.removeMarkup=function(){e.ref.markup&&(e.removeChildView(e.ref.markup),e.ref.markup=null)},e.ref.isModal=/modal/.test(e.query("GET_STYLE_LAYOUT_MODE"))},write:z({DID_PRESENT_IMAGE:function(t){t.root.ref.imageGL.colorOpacity=1}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.ref.imageGL,o=e.ref.markup,a=e.query("GET_CROP",n.id,r);if(a){var c=a.isDraft,l=a.cropRect,u=a.cropStatus,f=a.origin,s=a.translation,d=a.translationBand,h=a.scale,p=a.scaleBand,g=a.rotation,m=a.rotationBand,y=a.flip,v=a.colorMatrix,E=e.query("GET_ROOT"),w=e.query("GET_STAGE"),_=w.x,T=w.y;c&&(i.scale=null,i.zRotation=null,i.xTranslation=null,i.yTranslation=null,i.xOrigin=null,i.yOrigin=null),i.colorMatrix=v;var b=e.query("IS_ACTIVE_VIEW","crop"),O=e.query("IS_ACTIVE_VIEW","markup"),x=b?.75:.95,R=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){di(t,e,n[e])})}return t}({},l),A=1,I=b?1:5;if(e.query("IS_ACTIVE_VIEW","resize")){var C=u.image.width,S=u.image.height;A=null===C&&null===S?u.crop.width/l.width:null===C?S/l.height:C/l.width,A/=window.devicePixelRatio;var M=l.width*A,L=l.height*A;R.x=R.x+(.5*l.width-.5*M),R.y=R.y+(.5*l.height-.5*L),R.width=M,R.height=L}var P=e.ref.isModal?0:E.left,D=e.ref.isModal?0:E.top,k=e.ref.isModal?0:E.width-e.rect.element.width,G=e.ref.isModal?0:E.height-e.rect.element.height-n.offsetTop,U=(h+p)*A;i.isDraft=c,i.overlayOpacity=x,i.xOrigin=f.x,i.yOrigin=f.y,i.xTranslation=s.x+d.x+_,i.yTranslation=s.y+d.y+T,i.left=P,i.top=D+n.offsetTop,i.width=e.rect.element.width+k,i.height=e.rect.element.height+G+n.offsetTop,i.scale=U,i.xRotation=y.vertical?Math.PI:0,i.yRotation=y.horizontal?Math.PI:0,i.zRotation=g.main+g.sub+m,i.stage={x:w.x+P,y:w.y+D+n.offsetTop,width:w.width,height:w.height},i.overlay={x:R.x+_+P,y:R.y+T+D+n.offsetTop,width:R.width,height:R.height},i.outlineWidth=I,a.markup.length&&!o?o=e.ref.createMarkup():!a.markup.length&&o&&(e.ref.removeMarkup(),o=null),o&&(c&&(o.translateX=null,o.translateY=null,o.markupX=null,o.markupY=null,o.markupWidth=null,o.markupHeight=null),o.opacity=b?.3:1,o.markupX=R.x+_,o.markupY=R.y+T,o.markupWidth=R.width,o.markupHeight=R.height,o.allowInteraction=O)}})}),pi=F({name:"crop-rotator-line",ignoreRect:!0,ignoreRectUpdate:!0,mixins:{styles:["translateX"],animations:{translateX:"spring"}},create:function(t){for(var e=t.root,n='<svg viewBox="-90 -5 180 10" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">',r=0;r<=180;r+=2){var i=r*(176/180)-90+2,o=r%10==0?.5:.2;if(n+='<circle fill="currentColor" cx="'.concat(i,'" cy="').concat(0,'" r="').concat(o,'"/>'),r%10==0)n+='<text fill="currentColor" x="'.concat(i+(i<0?-2.25:0===i?-.75:-1.5),'" y="').concat(3.5,'">').concat(-90+r,"&deg;</text>")}n+="</svg>",e.element.innerHTML=n}}),gi=F({name:"crop-rotator",ignoreRect:!0,mixins:{styles:["opacity","translateY"],animations:{opacity:{type:"spring",damping:.5,mass:5},translateY:"spring"},apis:["rotation","animate","setAllowInteraction"]},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("tabindex",0);var r=document.createElement("button");r.innerHTML="<span>".concat(e.query("GET_LABEL_BUTTON_CROP_ROTATE_CENTER"),"</span>"),r.className="doka--crop-rotator-center",r.addEventListener("click",function(){e.dispatch("CROP_IMAGE_ROTATE_CENTER")}),e.appendChild(r);var i=null;e.appendChildView(e.createChildView(function(t,e){return F({name:t,ignoreRect:!0,create:e})}("crop-rotator-line-mask",function(t){var e=t.root,n=t.props;i=e.appendChildView(e.createChildView(pi,{translateX:Math.round(312*n.rotation)}))}),n)),e.ref.line=i;var o=document.createElement("div");o.className="doka--crop-rotator-bar",e.appendChild(o);var a=Math.PI/4,c=0;e.ref.dragger=Rr(o,function(){c=i.translateX/312,e.dispatch("CROP_IMAGE_ROTATE_GRAB")},function(t,n){var r=n.x/e.rect.element.width*(Math.PI/2),i=At(c+r,-a,a);e.dispatch("CROP_IMAGE_ROTATE",{value:-i})},function(){e.dispatch("CROP_IMAGE_ROTATE_RELEASE")},{stopPropagation:!0}),n.setAllowInteraction=function(t){t?e.ref.dragger.enable():e.ref.dragger.disable()},e.ref.keyboard=Fr(e.element,function(){c=0},{left:function(){c+=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})},right:function(){c-=Math.PI/128,e.dispatch("CROP_IMAGE_ROTATE_ADJUST",{value:c})}},function(){},function(){}),e.ref.prevRotation},destroy:function(t){var e=t.root;e.ref.dragger.destroy(),e.ref.keyboard.destroy()},write:function(t){var e=t.root,n=t.props,r=t.timestamp,i=n.animate,o=n.rotation;if(e.ref.prevRotation!==o){e.ref.prevRotation=o,i||0===o||(e.ref.line.translateX=null);var a=0,c=e.query("GET_CROP",n.id,r);if(c&&c.interaction&&c.interaction.rotation){var l=Ye(c.interaction.rotation).sub-o;a=.025*Math.sign(l)*Math.log10(1+Math.abs(l)/.025)}e.ref.line.translateX=Math.round(312*(-o-a))}}}),mi=["nw","ne","se","sw"],yi=["n","e","s","w"],vi=wt()&&1===window.devicePixelRatio?function(t){return Math.round(t)}:function(t){return t},Ei=F({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect-focal-line",mixins:{styles:["translateX","translateY","scaleX","scaleY","opacity"],animations:{translateX:"spring",translateY:"spring",scaleX:"spring",scaleY:"spring",opacity:"spring"}}}),wi=function(t){return F({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-edge-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],apis:["setAllowInteraction"]},create:function(e){var n=e.root,r=e.props;n.element.classList.add("doka--crop-rect-edge"),n.element.setAttribute("tabindex",0),n.element.setAttribute("role","button");var i,o=t,a=(i=t,yi[(yi.indexOf(i)+2)%yi.length]);n.ref.dragger=Rr(n.element,function(){n.dispatch("CROP_RECT_DRAG_GRAB")},function(t,e){return n.dispatch("CROP_RECT_EDGE_DRAG",{offset:e,origin:o,anchor:a})},function(){return n.dispatch("CROP_RECT_DRAG_RELEASE")},{stopPropagation:!0,cancelOnMultiple:!0}),r.setAllowInteraction=function(t){t?n.ref.dragger.enable():n.ref.dragger.disable()},n.ref.keyboard=Fr(n.element,function(){return{x:0,y:0}},{up:function(t){t.y-=20},down:function(t){t.y+=20},left:function(t){t.x-=20},right:function(t){t.x+=20}},function(t){n.dispatch("CROP_RECT_DRAG_GRAB"),n.dispatch("CROP_RECT_EDGE_DRAG",{offset:t,origin:o,anchor:a})},function(){n.dispatch("CROP_RECT_DRAG_RELEASE")})},destroy:function(t){var e=t.root;e.ref.keyboard.destroy(),e.ref.dragger.destroy()}})},_i=function(t,e,n){return F({ignoreRect:!0,ignoreRectUpdate:!0,tag:"div",name:"crop-rect-corner-".concat(t),mixins:{styles:["translateX","translateY","scaleX","scaleY"],animations:{translateX:Ar,translateY:Ar,scaleX:{type:"spring",delay:n},scaleY:{type:"spring",delay:n},opacity:{type:"spring",delay:e}},apis:["setAllowInteraction"]},create:function(e){var n=e.root,r=e.props;n.element.classList.add("doka--crop-rect-corner"),n.element.setAttribute("role","button"),n.element.setAttribute("tabindex",-1);var i,o=t,a=(i=t,mi[(mi.indexOf(i)+2)%mi.length]);n.ref.dragger=Rr(n.element,function(){n.dispatch("CROP_RECT_DRAG_GRAB")},function(t,e){n.dispatch("CROP_RECT_CORNER_DRAG",{offset:e,origin:o,anchor:a})},function(){n.dispatch("CROP_RECT_DRAG_RELEASE")},{stopPropagation:!0,cancelOnMultiple:!0}),r.setAllowInteraction=function(t){t?n.ref.dragger.enable():n.ref.dragger.disable()}},destroy:function(t){t.root.ref.dragger.destroy()}})},Ti=F({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-rect",mixins:{apis:["rectangle","draft","rotating","enabled"]},create:function(t){var e=t.root;e.ref.wasRotating=!1;mi.forEach(function(t,n){var r=10*n,i=250+r+50,o=250+r;e.ref[t]=e.appendChildView(e.createChildView(_i(t,i,o),{opacity:0,scaleX:.5,scaleY:.5}))}),yi.forEach(function(t){e.ref[t]=e.appendChildView(e.createChildView(wi(t)))}),e.ref.lines=[];for(var n=0;n<10;n++)e.ref.lines.push(e.appendChildView(e.createChildView(Ei,{opacity:0})));e.ref.animationDir=null,e.ref.previousRotating,e.ref.previousRect={},e.ref.previousEnabled,e.ref.previousDraft},write:function(t){var e=t.root,n=t.props,r=n.rectangle,i=n.draft,o=n.rotating,a=n.enabled;if(r&&(!Gt(r,e.ref.previousRect)||o!==e.ref.previousRotating||a!==e.ref.previousEnabled||i!==e.ref.previousDraft)){e.ref.previousRect=r,e.ref.previousRotating=o,e.ref.previousEnabled=a,e.ref.previousDraft=i;var c=e.ref,l=c.n,u=c.e,f=c.s,s=c.w,d=c.nw,h=c.ne,p=c.se,g=c.sw,m=c.lines,y=c.animationDir,v=r.x,E=r.y,w=r.x+r.width,_=r.y+r.height,T=_-E,b=w-v,O=Math.min(b,T);e.element.dataset.indicatorSize=O<80?"none":"default",yi.forEach(function(t){return e.ref[t].setAllowInteraction(a)}),mi.forEach(function(t){return e.ref[t].setAllowInteraction(a)});var x=e.query("IS_ACTIVE_VIEW","crop");if(x&&"in"!==y?(e.ref.animationDir="in",mi.map(function(t){return e.ref[t]}).forEach(function(t){t.opacity=1,t.scaleX=1,t.scaleY=1})):x||"out"===y||(e.ref.animationDir="out",mi.map(function(t){return e.ref[t]}).forEach(function(t){t.opacity=0,t.scaleX=.5,t.scaleY=.5})),Oi(i,d,v,E),Oi(i,h,w,E),Oi(i,p,w,_),Oi(i,g,v,_),bi(i,l,v,E,b/100,1),bi(i,u,w,E,1,T/100),bi(i,f,v,_,b/100,1),bi(i,s,v,E,1,T/100),o){e.ref.wasRotating=!0;var R=m.slice(0,5),A=1/R.length;R.forEach(function(t,e){bi(i,t,v,E+T*(A+e*A),b/100,.01),t.opacity=.5});var I=m.slice(5);A=1/I.length,I.forEach(function(t,e){bi(i,t,v+b*(A+e*A),E,.01,T/100),t.opacity=.5})}else if(i){e.ref.wasRotating=!1;var C=m[0],S=m[1],M=m[2],L=m[3];bi(i,C,v,E+.333*T,b/100,.01),bi(i,S,v,E+.666*T,b/100,.01),bi(i,M,v+.333*b,E,.01,T/100),bi(i,L,v+.666*b,E,.01,T/100),C.opacity=.5,S.opacity=.5,M.opacity=.5,L.opacity=.5}else{var P=m[0],D=m[1],k=m[2],G=m[3];!e.ref.wasRotating&&P.opacity>0&&(bi(i,P,v,E+.333*T,b/100,.01),bi(i,D,v,E+.666*T,b/100,.01),bi(i,k,v+.333*b,E,.01,T/100),bi(i,G,v+.666*b,E,.01,T/100)),m.forEach(function(t){return t.opacity=0})}}}}),bi=function(t,e,n,r,i,o){t&&(e.translateX=null,e.translateY=null,e.scaleX=null,e.scaleY=null),e.translateX=vi(n),e.translateY=vi(r),e.scaleX=i,e.scaleY=o},Oi=function(t,e,n,r){t&&(e.translateX=null,e.translateY=null),e.translateX=vi(n),e.translateY=vi(r)},xi=function(t,e){if(!/svg/.test(t.namespaceURI)||"innerHTML"in t)t.innerHTML=e;else{var n=document.createElement("div");n.innerHTML="<svg>"+e+"</svg>";for(var r=n.firstChild;r.firstChild;)t.appendChild(r.firstChild)}},Ri=F({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-mask",tag:"svg",mixins:{styles:["opacity","translateX","translateY"],animations:{scale:Ar,maskWidth:Ar,maskHeight:Ar,translateX:Ar,translateY:Ar,opacity:{type:"tween",delay:0,duration:1e3}},apis:["rectangle","animate","maskWidth","maskHeight","scale"]},create:function(t){var e=t.root;e.customWriter=e.query("GET_CROP_MASK")(e.element,xi)||function(){}},didWriteView:function(t){var e=t.root,n=t.props,r=n.maskWidth,i=n.maskHeight,o=n.scale;if(r&&i){e.element.setAttribute("width",vi(r)),e.element.setAttribute("height",vi(i));var a=e.query("GET_CROP_MASK_INSET");e.customWriter({x:o*a,y:o*a,width:r-o*a*2,height:i-o*a*2},{width:r,height:i})}}}),Ai=function(t,e){var n=t.childNodes[0];n?e!==n.nodeValue&&(n.nodeValue=e):(n=document.createTextNode(e),t.appendChild(n))},Ii=F({ignoreRect:!0,name:"crop-size",mixins:{styles:["translateX","translateY","opacity"],animations:{translateX:"spring",translateY:"spring",opacity:"spring"},listeners:!0},create:function(t){var e=t.root,n=g("span");n.className="doka--crop-size-info doka--crop-resize-percentage",e.ref.resizePercentage=n,e.appendChild(n);var r=g("span");r.className="doka--crop-size-info";var i=g("span");i.className="doka--crop-size-multiply",i.textContent="×";var o=g("span"),a=g("span");e.ref.outputWidth=o,e.ref.outputHeight=a,r.appendChild(o),r.appendChild(i),r.appendChild(a),e.appendChild(r),e.ref.previousValues={width:0,height:0,percentage:0}},write:function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=e.ref,c=a.outputWidth,l=a.outputHeight,u=a.resizePercentage,f=a.previousValues,s=o.image,d=o.crop,h=o.currentWidth,p=o.currentHeight,g=s.width?Math.round(s.width/d.width*100):0;h!==f.width&&(Ai(c,h),f.width=h),p!==f.height&&(Ai(l,p),f.height=p),g!==f.percentage&&(s.width?Ai(u,"".concat(g,"%")):Ai(u,""),f.percentage=g)}}}),Ci={type:"spring",stiffness:.4,damping:.65,mass:7},Si=F({name:"crop-subject",ignoreRect:!0,mixins:{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250},translateX:Ci,translateY:Ci}},create:function(t){var e=t.root,n=t.props;e.opacity=1,e.query("GET_CROP_MASK")&&(e.ref.maskView=e.appendChildView(e.createChildView(Ri))),e.ref.cropView=e.appendChildView(e.createChildView(Ti)),e.query("GET_CROP_SHOW_SIZE")&&(e.ref.cropSize=e.appendChildView(e.createChildView(Ii,{id:n.id,opacity:1,scaleX:1,scaleY:1,translateX:null}))),e.query("GET_CROP_ZOOM_TIMEOUT")||(e.ref.btnZoom=e.appendChildView(e.createChildView(dr("zoom-wrapper",{styles:["opacity","translateX","translateY"],animations:{opacity:{type:"tween",duration:250}}}),{opacity:0,controls:[{view:hr,label:e.query("GET_LABEL_BUTTON_CROP_ZOOM"),name:"zoom",icon:pr('<g fill="currentColor" fill-rule="nonzero"><path d="M12.5 19a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13zm0-2a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9z"/><path d="M15.765 17.18a1 1 0 1 1 1.415-1.415l3.527 3.528a1 1 0 0 1-1.414 1.414l-3.528-3.527z"/></g>',26),action:function(){return e.dispatch("CROP_ZOOM")}}]})))},write:z({CROP_RECT_DRAG_RELEASE:function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r),o=e.ref.btnZoom;if(o){var a=i.cropRect;o.translateX=a.x+.5*a.width,o.translateY=a.y+.5*a.height}}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o=e.ref,a=o.cropView,c=o.maskView,l=o.btnZoom,u=o.cropSize,f=i.cropRect,s=i.isRotating,d=i.isDraft,h=i.scale;if(e.query("IS_ACTIVE_VIEW","crop")){var p=e.query("GET_STAGE");if(e.translateX=p.x-e.rect.element.left,e.translateY=p.y-e.rect.element.top,a.draft=d,a.rotating=s,a.rectangle=f,a.enabled=!0,u){d&&(u.translateX=null,u.translateY=null);var g=Mi(e.rect.element,u.rect.element,f);u.translateX=d?g.x:vi(g.x),u.translateY=d?g.y:vi(g.y)}c&&(d&&(c.translateX=null,c.translateY=null,c.maskWidth=null,c.maskHeight=null),c.translateX=vi(f.x),c.translateY=vi(f.y),c.maskWidth=f.width,c.maskHeight=f.height,c.scale=h),l&&(l.opacity=i.canRecenter&&!i.isDraft?1:0)}else a.enabled=!1}})}),Mi=function(t,e,n){var r=n.x,i=n.x+n.width,o=n.y+n.height,a=i-e.width-16,c=o-e.height-16;return e.width>n.width-32&&(a=r+(.5*n.width-.5*e.width),(c=o+16)>t.height-e.height&&(c=o-e.height-16)),{x:a=Math.max(0,Math.min(a,t.width-e.width)),y:c}},Li=function(){return performance.now()};function Pi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Di(t,e,n[e])})}return t}function Di(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ki=function(t,e){var n=function(t,e){for(;1===t.nodeType&&!e(t);)t=t.parentNode;return 1===t.nodeType?t:null}(e,function(t){return t.classList.contains("doka--root")});return!!n&&n.contains(t)},Gi=function(t){var e=t.root,n=t.props,r=t.action.position,i=n.pivotPoint,o=e.ref,a=o.indicatorA,c=o.indicatorB,l=i.x-r.x,u=i.y-r.y,f={x:i.x+l,y:i.y+u},s={x:i.x-l,y:i.y-u};a.style.cssText="transform: translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0)"),c.style.cssText="transform: translate3d(".concat(s.x,"px, ").concat(s.y,"px, 0)")},Ui=function(t){return{x:t.pageX,y:t.pageY}},Vi=F({ignoreRect:!0,ignoreRectUpdate:!0,name:"crop-resizer",mixins:{apis:["pivotPoint","scrollRect"]},create:function(t){var e=t.root,n=t.props;e.ref.isActive=!1,e.ref.isCropping=!1,e.ref.indicatorA=document.createElement("div"),e.appendChild(e.ref.indicatorA),e.ref.indicatorB=document.createElement("div"),e.appendChild(e.ref.indicatorB);var r=e.query("GET_CROP_RESIZE_KEY_CODES"),i={origin:{x:null,y:null},position:{x:null,y:null},selecting:!1,enabled:!1,scrollY:0,offsetX:0,offsetY:0},o=Li();e.ref.state=i;var a=Tr(),c=0,l=!1;e.ref.resizeStart=function(t){if(e.ref.isActive&&(0===a.count()&&(l=!1),a.push(t),br(document.documentElement,"up",e.ref.resizeEnd),ki(e.element,t.target)&&a.multiple())){t.stopPropagation(),t.preventDefault();var n=a.active(),r=Ui(n[0]),i=Ui(n[1]);c=Lt(r,i),br(document.documentElement,"move",e.ref.resizeMove),l=!0}},e.ref.resizeMove=function(t){if(e.ref.isActive&&l&&(t.preventDefault(),2===a.count())){a.update(t);var n=a.active(),r=Ui(n[0]),i=Ui(n[1]),o=(Lt(r,i)-c)/c;e.dispatch("CROP_IMAGE_RESIZE",{value:o})}},e.ref.resizeEnd=function(t){if(e.ref.isActive){a.pop(t);var n=0===a.count();n&&(Or(document.documentElement,"move",e.ref.resizeMove),Or(document.documentElement,"up",e.ref.resizeEnd)),l&&(t.preventDefault(),n&&e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))}},br(document.documentElement,"down",e.ref.resizeStart);var u=performance.now(),f=0,s=1,d=function(t,e){var n=null,r=null;return function(){var i=arguments;if(!r)return t.apply(null,Array.from(arguments)),void(r=Li());clearTimeout(n),n=setTimeout(function(){Li()-r>=e&&(t.apply(null,Array.from(i)),r=Li())},e-(Li()-r))}}(function(t){if(!e.ref.isCropping){var n=Math.sign(t.wheelDelta||t.deltaY),r=Li(),i=r-u;u=r,(i>750||f!==n)&&(s=1,f=n),s+=.05*n,e.dispatch("CROP_IMAGE_RESIZE_MULTIPLY",{value:Math.max(.1,s)}),e.dispatch("CROP_IMAGE_RESIZE_RELEASE")}},100);e.ref.wheel=function(t){if(e.ref.isActive&&ki(e.element,t.target)){if(n.scrollRect){var r=n.scrollRect,i=e.query("GET_ROOT"),o=Ui(t),a={x:o.x-i.leftScroll,y:o.y-i.topScroll};if(a.x<r.x||a.x>r.x+r.width||a.y<r.y||a.y>r.y+r.height)return}t.preventDefault(),d(t)}},document.addEventListener("wheel",e.ref.wheel,{passive:!1}),e.ref.move=function(t){if(e.ref.isActive&&!e.ref.isCropping&&(i.position.x=t.pageX-e.ref.state.offsetX,i.position.y=t.pageY-e.ref.state.scrollY-e.ref.state.offsetY,i.enabled))if(ki(e.element,t.target)){"idle"===e.element.dataset.state&&e.dispatch("RESIZER_SHOW",{position:Pi({},i.position)}),t.preventDefault(),e.dispatch("RESIZER_MOVE",{position:Pi({},i.position)});var r=n.pivotPoint,a=r.x-i.position.x,l=r.y-i.position.y,u={x:r.x+a,y:r.y+l},f=Pi({},i.position);if(i.selecting){var s=(Lt(u,f)-c)/c,d=performance.now();d-o>25&&(o=d,e.dispatch("CROP_IMAGE_RESIZE",{value:s}))}}else e.dispatch("RESIZER_CANCEL")},e.ref.select=function(t){if(e.ref.isActive&&ki(e.element,t.target)){var r=n.pivotPoint,o=r.x-i.position.x,a=r.y-i.position.y,l={x:r.x+o,y:r.y+a},u=i.position;c=Lt(l,u),i.selecting=!0,i.origin.x=t.pageX,i.origin.y=t.pageY,e.dispatch("CROP_IMAGE_RESIZE_GRAB")}},e.ref.confirm=function(t){e.ref.isActive&&ki(e.element,t.target)&&(i.selecting=!1,e.dispatch("CROP_IMAGE_RESIZE_RELEASE"))},e.ref.blur=function(){e.ref.isActive&&(i.selecting=!1,i.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL"))},window.addEventListener("blur",e.ref.blur),document.addEventListener("mousemove",e.ref.move),e.ref.keyDown=function(t){e.ref.isActive&&r.includes(t.keyCode)&&i.position&&(i.enabled=!0,document.addEventListener("mousedown",e.ref.select),document.addEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_SHOW",{position:Pi({},i.position)}))},e.ref.keyUp=function(t){e.ref.isActive&&r.includes(t.keyCode)&&(i.enabled=!1,document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),e.dispatch("RESIZER_CANCEL"))},document.body.addEventListener("keydown",e.ref.keyDown),document.body.addEventListener("keyup",e.ref.keyUp)},destroy:function(t){var e=t.root;document.removeEventListener("touchmove",e.ref.resizeMove),document.removeEventListener("touchend",e.ref.resizeEnd),document.removeEventListener("touchstart",e.ref.resizeStart),document.removeEventListener("wheel",e.ref.wheel),document.removeEventListener("mousemove",e.ref.move),document.removeEventListener("mousedown",e.ref.select),document.removeEventListener("mouseup",e.ref.confirm),document.body.removeEventListener("keydown",e.ref.keyDown),document.body.removeEventListener("keyup",e.ref.keyUp),window.removeEventListener("blur",e.ref.blur)},read:function(t){var e=t.root;e.ref.state.scrollY=window.scrollY;var n=e.element.getBoundingClientRect();e.ref.state.offsetX=n.x,e.ref.state.offsetY=n.y},write:z({CROP_RECT_DRAG_GRAB:function(t){t.root.ref.isCropping=!0},CROP_RECT_DRAG_RELEASE:function(t){t.root.ref.isCropping=!1},SHOW_VIEW:function(t){var e=t.root,n=t.action;e.ref.isActive="crop"===n.id},RESIZER_SHOW:function(t){var e=t.root,n=t.props,r=t.action;e.element.dataset.state="multi-touch",Gi({root:e,props:n,action:r})},RESIZER_CANCEL:function(t){t.root.element.dataset.state="idle"},RESIZER_MOVE:Gi})});function Bi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ni(t,e,n[e])})}return t}function Ni(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ji(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Fi=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"group",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["opacity"],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return F({ignoreRect:!0,name:t,mixins:{styles:["opacity"].concat(ji(e)),animations:Bi({opacity:{type:"spring",stiffness:.25,damping:.5,mass:5}},n)},create:function(t){var e=t.root;t.props.controls.map(function(t){var n=e.createChildView(t.view,t);t.didCreateView&&t.didCreateView(n),e.appendChildView(n)})}})};function zi(t){return(zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){qi(t,e,n[e])})}return t}function qi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Yi=F({ignoreRect:!0,tag:"div",name:"dropdown-list",mixins:{styles:["translateY","opacity"],apis:["selectedValue","options","onSelect"],animations:{translateY:"spring",opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("role","list"),e.ref.handleClick=function(){return n.action&&n.action()},e.element.addEventListener("click",e.ref.handleClick),e.ref.activeOptions=null,e.ref.activeSelectedValue},write:function(t){var e=t.root,n=t.props;if(n.options!==e.ref.activeOptions&&(e.ref.activeOptions=n.options,e.childViews.forEach(function(t){return e.removeChildView(t)}),n.options.map(function(t){var r=e.createChildView(hr,Wi({},t,{action:function(){return n.onSelect(t.value)}}));return e.appendChildView(r)})),n.selectedValue!==e.ref.activeSelectedValue){e.ref.activeSelectedValue=n.selectedValue;var r=n.options.findIndex(function(t){return"object"===zi(t.value)&&n.selectedValue?JSON.stringify(t.value)===JSON.stringify(n.selectedValue):t.value===n.selectedValue});e.childViews.forEach(function(t,e){t.element.setAttribute("aria-selected",e===r)})}},destroy:function(t){var e=t.root;e.element.removeEventListener("click",e.ref.handleClick)}}),Hi=F({ignoreRect:!0,tag:"div",name:"dropdown",mixins:{styles:["opacity"],animations:{opacity:"spring"},apis:["direction","selectedValue","options","onSelect"]},create:function(t){var e=t.root,n=t.props;e.ref.open=!1;var r=function(t){e.ref.open=t,e.dispatch("KICK")};e.ref.button=e.appendChildView(e.createChildView(hr,Wi({},n,{action:function(){r(!e.ref.open)}}))),e.ref.list=e.appendChildView(e.createChildView(Yi,Wi({},n,{opacity:0,action:function(){r(!1)}}))),e.ref.handleBodyClick=function(t){e.element.contains(t.target)||r(!1)},e.element.addEventListener("focusin",function(t){t.target!==e.ref.button.element&&r(!0)}),e.element.addEventListener("focusout",function(t){e.element.contains(t.relatedTarget)||r(!1)}),document.body.addEventListener("click",e.ref.handleBodyClick)},destroy:function(t){var e=t.root;document.body.removeEventListener("click",e.ref.handleBodyClick)},write:function(t){var e=t.root,n=t.props;if(e.ref.list.opacity=e.ref.open?1:0,e.ref.list.selectedValue=n.selectedValue,e.ref.list.options=n.options,"up"===n.direction){var r=e.ref.list.rect.element.height;e.ref.list.translateY=(e.ref.open?-(r+5):-r)-e.rect.element.height}else e.ref.list.translateY=e.ref.open?0:-5}});function Zi(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Xi(t,e,n[e])})}return t}function Xi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ki=function(t,e){return t.style.opacity=e},Qi=function(t,e){var n=Array.from(t.element.querySelectorAll(".doka--icon-crop-limit rect"));n.length&&(Ki(n[0],e?.3:0),Ki(n[1],e?1:0),Ki(n[2],e?0:.3),Ki(n[3],e?0:1))},Ji=function(t,e){var n=t.element.querySelectorAll(".doka--icon-aspect-ratio rect");if(n.length){if(!e)return Ki(n[0],.2),Ki(n[1],.3),void Ki(n[2],.4);Ki(n[0],e>1?1:.3),Ki(n[1],1===e?.85:.5),Ki(n[2],e<1?1:.3)}},$i=function(t){var e,n;t>1?(n=14,e=Math.round(n/t)):(e=14,n=Math.round(e*t));var r=Math.round(.5*(23-e)),i=Math.round(.5*(23-n));return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="'.concat(r,'" y="').concat(i,'" width="').concat(e,'" height="').concat(n,'" rx="2.5"/></g></svg>')},to=F({name:"crop",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden","offsetTop"]},create:function(t){var e=t.root,n=t.props;n.viewId="crop",n.hidden=!1,e.ref.isHiding=!1;var r=[];e.query("GET_CROP_ALLOW_IMAGE_TURN_LEFT")&&r.push({view:hr,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_LEFT"),icon:pr('<g transform="translate(3 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><rect y="9" width="12" height="12" rx="1"/><path d="M9.823 5H11a5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7H9.626l.747-.747A1 1 0 0 0 8.958.84L6.603 3.194a1 1 0 0 0 0 1.415l2.355 2.355a1 1 0 0 0 1.415-1.414L9.823 5z" fill-rule="nonzero" /></g>',26),action:function(){return e.dispatch("CROP_IMAGE_ROTATE_LEFT")}}),e.query("GET_CROP_ALLOW_IMAGE_TURN_RIGHT")&&r.push({view:hr,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ROTATE_RIGHT"),icon:pr('<g transform="translate(5 2)" fill="currentColor" fill-rule="evenodd" class="doka--icon-turn"><path d="M8.177 5H7a5 5 0 0 0-5 5 1 1 0 0 1-2 0 7 7 0 0 1 7-7h1.374l-.747-.747A1 1 0 0 1 9.042.84l2.355 2.355a1 1 0 0 1 0 1.415L9.042 6.964A1 1 0 0 1 7.627 5.55l.55-.55z" fill-rule="nonzero"/><rect x="6" y="9" width="12" height="12" rx="1"/></g>',26),action:function(){return e.dispatch("CROP_IMAGE_ROTATE_RIGHT")}}),e.query("GET_CROP_ALLOW_IMAGE_FLIP_HORIZONTAL")&&r.push({view:hr,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_FLIP_HORIZONTAL"),icon:pr('<g fill="currentColor" fill-rule="evenodd"><path d="M11.93 7.007V20a1 1 0 0 1-1 1H5.78a1 1 0 0 1-.93-1.368l5.15-12.993a1 1 0 0 1 1.929.368z"/><path d="M14 7.007V20a1 1 0 0 0 1 1h5.149a1 1 0 0 0 .93-1.368l-5.15-12.993A1 1 0 0 0 14 7.007z" opacity=".6"/></g>',26),action:function(){return e.dispatch("CROP_IMAGE_FLIP_HORIZONTAL")}}),e.query("GET_CROP_ALLOW_IMAGE_FLIP_HORIZONTAL")&&r.push({view:hr,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_FLIP_VERTICAL"),icon:pr('<g fill="currentColor" fill-rule="evenodd"><path d="M19.993 12.143H7a1 1 0 0 1-1-1V5.994a1 1 0 0 1 1.368-.93l12.993 5.15a1 1 0 0 1-.368 1.93z"/><path d="M19.993 14a1 1 0 0 1 .368 1.93L7.368 21.078A1 1 0 0 1 6 20.148V15a1 1 0 0 1 1-1h12.993z" opacity=".6"/></g>',26),action:function(){return e.dispatch("CROP_IMAGE_FLIP_VERTICAL")}});var i=e.query("GET_CROP_ASPECT_RATIO_OPTIONS");i&&i.length&&r.push({view:Hi,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_ASPECT_RATIO"),icon:pr('<g class="doka--icon-aspect-ratio" fill="currentColor" fill-rule="evenodd"><rect x="2" y="4" opacity=".3" width="10" height="18" rx="1"/><rect opacity=".5" x="4" y="8" width="14" height="14" rx="1"/><rect x="6" y="12" width="17" height="10" rx="1"/></g>',26),options:null,onSelect:function(t){t.width&&t.height?e.dispatch("RESIZE_SET_OUTPUT_SIZE",{width:t.width,height:t.height}):(e.query("GET_CROP_ASPECT_RATIO_OPTIONS").find(function(t){return t.value&&t.value.width||t.value.height})&&e.dispatch("RESIZE_SET_OUTPUT_SIZE",{width:null,height:null}),e.dispatch("CROP_SET_ASPECT_RATIO",{value:t.aspectRatio}))},didCreateView:function(t){e.ref.aspectRatioDropdown=t}}),e.query("GET_CROP_ALLOW_TOGGLE_LIMIT")&&r.push({view:Hi,name:"tool",label:e.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT"),icon:pr('<g class="doka--icon-crop-limit" fill="currentColor" fill-rule="evenodd">\n                    <rect x="2" y="3" width="20" height="20" rx="1"/>\n                    <rect x="7" y="8" width="10" height="10" rx="1"/>\n                    <rect x="4" y="8" width="14" height="14" rx="1"/>\n                    <rect x="12" y="4" width="10" height="10" rx="1"/>\n                </g>',26),options:[{value:!0,label:e.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT_ENABLE"),icon:'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="3" y="3" width="17" height="17" rx="2.5" opacity=".3"/><rect x="7" y="7" width="9" height="9" rx="2.5"/></g></svg>'},{value:!1,label:e.query("GET_LABEL_BUTTON_CROP_TOGGLE_LIMIT_DISABLE"),icon:'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><g fill="currentColor"><rect x="3" y="6" width="13" height="13" rx="2.5" opacity=".3"/><rect x="10" y="3" width="9" height="9" rx="2.5"/></g></svg>'}],onSelect:function(t){e.dispatch("CROP_SET_LIMIT",{value:t})},didCreateView:function(t){e.ref.cropToggleLimitDropdown=t}}),e.ref.menu=e.appendChildView(e.createChildView(Fi("toolbar",["opacity"],{opacity:{type:"spring",mass:15,delay:50}}),{opacity:0,controls:r})),e.ref.menuItemsRequiredWidth=null,e.ref.subject=e.appendChildView(e.createChildView(Si,Zi({},n))),e.ref.rotator=e.appendChildView(e.createChildView(gi,{rotation:0,opacity:0,translateY:20,id:n.id})),e.ref.resizer=e.appendChildView(e.createChildView(Vi,{pivotPoint:{x:0,y:0}})),e.ref.updateControls=function(){var t=e.query("GET_IMAGE");if(function(t,e){Array.from(t.element.querySelectorAll(".doka--icon-turn rect")).forEach(function(t){e>1&&(t.setAttribute("x",t.previousElementSibling?5:4),t.setAttribute("width",9)),e<1&&(t.setAttribute("y",11),t.setAttribute("height",10))})}(e,t.height/t.width),e.ref.cropToggleLimitDropdown&&(e.ref.isLimitedToImageBounds=e.query("GET_CROP_LIMIT_TO_IMAGE_BOUNDS"),Qi(e,e.ref.isLimitedToImageBounds),e.ref.cropToggleLimitDropdown.selectedValue=e.ref.isLimitedToImageBounds),e.ref.aspectRatioDropdown){var n=e.query("GET_MIN_IMAGE_SIZE"),r=i.filter(function(e){if(!e.value.aspectRatio)return!0;if(e.value.aspectRatio<1){if(t.naturalWidth*e.value.aspectRatio<n.height)return!1}else if(t.naturalHeight/e.value.aspectRatio<n.width)return!1;return!0});e.ref.aspectRatioDropdown.options=r.map(function(t){return Zi({},t,{icon:$i(t.value.aspectRatio)})})}},e.ref.isModal=/modal|fullscreen/.test(e.query("GET_STYLE_LAYOUT_MODE"))},read:function(t){var e=t.root,n=t.props;if(n.hidden)e.ref.menuItemsRequiredWidth=null;else{var r=e.rect;if(0!==r.element.width&&0!==r.element.height){if(null===e.ref.menuItemsRequiredWidth){var i=e.ref.menu.childViews.reduce(function(t,e){return t+e.rect.outer.width},0);e.ref.menuItemsRequiredWidth=0===i?null:i}var o=e.ref.subject.rect.element,a=o.left,c=o.top,l=o.width,u=o.height;n.stagePosition={x:a,y:c,width:l,height:u}}}},shouldUpdateChildViews:function(t){var e=t.props,n=t.actions;return!e.hidden||e.hidden&&n&&n.length},write:z({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props,i=e.ref,o=i.menu,a=i.rotator,c=i.subject;r.viewId===n.id?(c.opacity=1,o.opacity=1,a.opacity=1,a.translateY=0,r.hidden=!1,e.ref.isHiding=!1,e.ref.updateControls()):(c.opacity=0,o.opacity=0,a.opacity=0,a.translateY=20,e.ref.isHiding=!0)},UNLOAD_IMAGE:function(t){var e=t.root.ref,n=e.menu,r=e.rotator;n.opacity=0,r.opacity=0,r.translateY=20},DID_PRESENT_IMAGE:function(t){var e=t.root,n=e.ref,r=n.menu,i=n.rotator;r.opacity=1,i.opacity=1,i.translateY=0,e.ref.updateControls()}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.ref,o=i.resizer,a=i.subject,c=i.menu,l=i.rotator,u=i.isHiding,f=i.cropToggleLimitDropdown,s=i.aspectRatioDropdown,d=n.hidden,h=0===a.opacity&&0===c.opacity&&0===l.opacity;if(!d&&u&&h&&(e.ref.isHiding=!1,n.hidden=!0),!n.hidden){var p=e.query("GET_CROP",n.id,r);if(p){if(s){var g=e.query("GET_ACTIVE_CROP_ASPECT_RATIO"),m=e.query("GET_SIZE"),y=s.selectedValue;y?(y.aspectRatio!==g&&Ji(e,g),y.aspectRatio===g&&y.width===m.width&&y.height===m.height||(s.selectedValue={aspectRatio:g,width:m.width,height:m.height})):(s.selectedValue={aspectRatio:g,width:m.width,height:m.height},Ji(e,g))}if(f&&e.ref.isLimitedToImageBounds!==p.isLimitedToImageBounds&&(e.ref.isLimitedToImageBounds=p.isLimitedToImageBounds,Qi(e,p.isLimitedToImageBounds),f.selectedValue=p.isLimitedToImageBounds),o.pivotPoint={x:.5*o.rect.element.width,y:.5*o.rect.element.height},l.animate=!p.isDraft,l.rotation=p.rotation.sub,l.setAllowInteraction(e.query("IS_ACTIVE_VIEW","crop")),c.element.dataset.layout=e.ref.menuItemsRequiredWidth>e.ref.menu.rect.element.width?"compact":"spacious",e.query("GET_CROP_RESIZE_SCROLL_RECT_ONLY")){var v=e.query("GET_STAGE"),E=v.x,w=v.y,_=e.query("GET_ROOT"),T=e.ref.isModal?_.left:0,b=e.ref.isModal?_.top:0;o.scrollRect={x:T+E+p.cropRect.x,y:b+w+p.cropRect.y+n.offsetTop,width:p.cropRect.width,height:p.cropRect.height}}}}})}),eo=F({name:"size-input",mixins:{listeners:!0,apis:["id","value","placeholder","getValue","setValue","setPlaceholder","hasFocus","onChange"]},create:function(t){var e=t.root,n=t.props,r=n.id,i=n.min,o=n.max,a=n.value,c=n.placeholder,l=n.onChange,u=void 0===l?function(){}:l,f=n.onBlur,s=void 0===f?function(){}:f,d="doka--".concat(r,"-").concat(ut()),h=g("input",{type:"number",step:1,id:d,min:i,max:o,value:a,placeholder:c}),p=h.getAttribute("max").length,m=g("label",{for:d});m.textContent=n.label;var y=function(t,e,n){return X(t)?((t=t.replace(/[^0-9]/g,"")).length>p&&(t=t.slice(0,p)),t=parseInt(t,10)):t=Math.round(t),isNaN(t)?null:At(t,e,n)},v=function(t){return t.length?parseInt(h.value,10):null};e.ref.handleInput=function(){h.value=y(h.value,1,o),u(v(h.value))},e.ref.handleBlur=function(){h.value=y(h.value,i,o),s(v(h.value))},h.addEventListener("input",e.ref.handleInput),h.addEventListener("blur",e.ref.handleBlur),e.appendChild(h),e.appendChild(m),e.ref.input=h,n.hasFocus=function(){return h===document.activeElement},n.getValue=function(){return v(h.value)},n.setValue=function(t){return h.value=t?y(t,1,999999):null},n.setPlaceholder=function(t){return h.placeholder=t}},destroy:function(t){var e=t.root;e.ref.input.removeEventListener("input",e.ref.handleInput),e.ref.input.removeEventListener("blur",e.ref.handleBlur)}}),no=F({name:"checkable",tag:"span",mixins:{listeners:!0,apis:["id","checked","onChange","onSetValue","setValue","getValue"]},create:function(t){var e=t.root,n=t.props,r=n.id,i=n.checked,o=n.onChange,a=void 0===o?function(){}:o,c=n.onSetValue,l=void 0===c?function(){}:c,u="doka--".concat(r,"-").concat(ut()),f=g("input",{type:"checkbox",value:1,id:u});f.checked=i,e.ref.input=f;var s=g("label",{for:u});s.innerHTML=n.label,e.appendChild(f),e.appendChild(s),e.ref.handleChange=function(){l(f.checked),a(f.checked)},f.addEventListener("change",e.ref.handleChange),n.getValue=function(){return f.checked},n.setValue=function(t){f.checked=t,l(f.checked)},setTimeout(function(){l(f.checked)},0)},destroy:function(t){var e=t.root;e.ref.input.removeEventListener("change",e.ref.handleChange)}}),ro=null,io=F({ignoreRect:!0,name:"resize-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15,delay:150}}},create:function(t){var e=t.root;e.element.setAttribute("novalidate","novalidate"),e.element.setAttribute("action","#"),e.ref.shouldBlurKeyboard=Tt()||(null===ro&&(ro=/Android/i.test(navigator.userAgent)),ro);var n=e.query("GET_SIZE_MAX"),r=e.query("GET_SIZE_MIN"),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.axisLock,o=void 0===i?"none":i,a=t.enforceLimits,c=void 0!==a&&a,l=e.ref,u=l.inputImageWidth,f=l.inputImageHeight,s=l.buttonConfirm,d=e.query("GET_SIZE_ASPECT_RATIO_LOCK"),h=e.query("GET_CROP_RECTANGLE_ASPECT_RATIO"),p={width:u.getValue(),height:f.getValue()},g=le(p,c?r:{width:1,height:1},c?n:{width:999999,height:999999},d?h:null,o);if(d)"width"===o?f.setValue(g.width/h):"height"===o?u.setValue(g.height*h):(u.setValue(g.width||g.height*h),f.setValue(g.height||g.width/h));else if(g.width&&!g.height){var m=Math.round(g.width/h),y=le({width:g.width,height:m},c?r:{width:1,height:1},c?n:{width:999999,height:999999},h,o);c&&u.setValue(Math.round(y.width)),f.setPlaceholder(Math.round(y.height))}else if(g.height&&!g.width){var v=Math.round(g.height*h);u.setPlaceholder(v)}var E=e.query("GET_SIZE_INPUT"),w=E.width,_=E.height,T=b(w)?Math.round(w):null,O=b(_)?Math.round(_):null,x=u.getValue(),R=f.getValue(),A=x!==T||R!==O;return s.opacity=A?1:0,e.dispatch("KICK"),{width:u.getValue(),height:f.getValue()}},o=e;e.appendChildView(e.createChildView(oo("Image size",function(t){var e=t.root,a=e.query("GET_SIZE"),c=e.appendChildView(e.createChildView(eo,{id:"image-width",label:"Width",value:b(a.width)?Math.round(a.width):null,min:r.width,max:n.width,placeholder:0,onChange:function(){return i({axisLock:"width"})},onBlur:function(){return i({enforceLimits:!1})}})),l=e.appendChildView(e.createChildView(no,{id:"aspect-ratio-lock",label:pr('<g fill="none" fill-rule="evenodd"><path stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="doka--aspect-ratio-lock-ring" d="M9.401 10.205v-.804a2.599 2.599 0 0 1 5.198 0V14"/><rect fill="currentColor" x="7" y="10" width="10" height="7" rx="1.5"/></g>'),checked:e.query("GET_SIZE_ASPECT_RATIO_LOCK"),onSetValue:function(t){var e=t?0:-3;l.element.querySelector(".doka--aspect-ratio-lock-ring").setAttribute("transform","translate(0 ".concat(e,")"))},onChange:function(t){e.dispatch("RESIZE_SET_OUTPUT_SIZE_ASPECT_RATIO_LOCK",{value:t}),i()}})),u=e.appendChildView(e.createChildView(eo,{id:"image-height",label:"Height",value:b(a.height)?Math.round(a.height):null,min:r.height,max:n.height,placeholder:0,onChange:function(){return i({axisLock:"height"})},onBlur:function(){return i({enforceLimits:!1})}}));o.ref.aspectRatioLock=l,o.ref.inputImageWidth=c,o.ref.inputImageHeight=u}))),e.ref.buttonConfirm=e.appendChildView(e.createChildView(hr,{name:"app action-confirm icon-only",label:"Apply",action:function(){},opacity:0,icon:pr('><polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),type:"submit"})),e.ref.confirmForm=function(t){var n=i({enforceLimits:!0});t.preventDefault();var r=e.ref,o=r.shouldBlurKeyboard,a=r.buttonConfirm;o&&(document.activeElement.blur(),a.element.focus()),a.opacity=0,e.dispatch("RESIZE_SET_OUTPUT_SIZE",n)},e.element.addEventListener("submit",e.ref.confirmForm)},destroy:function(t){var e=t.root;e.element.removeEventListener("submit",e.ref.confirmForm)},write:z({EDIT_RESET:function(t){var e=t.root,n=e.query("GET_SIZE"),r=e.ref,i=r.inputImageWidth,o=r.inputImageHeight,a=r.aspectRatioLock,c=r.buttonConfirm;i.setValue(n.width),o.setValue(n.height),a.setValue(e.query("GET_SIZE_ASPECT_RATIO_LOCK")),c.opacity=0},RESIZE_SET_OUTPUT_SIZE:function(t){var e=t.root,n=t.action,r=e.ref,i=r.inputImageWidth,o=r.inputImageHeight;i.setValue(n.width),o.setValue(n.height)},CROP_SET_ASPECT_RATIO:function(t){var e=t.root,n=t.props,r=t.action,i=t.timestamp,o=e.query("GET_CROP",n.id,i);if(o){var a=o.cropStatus,c=e.ref,l=c.inputImageWidth,u=c.inputImageHeight;null!==r.value?(l.setValue(a.image.width),l.setPlaceholder(a.crop.width),u.setValue(a.image.height),u.setPlaceholder(a.crop.height)):l.getValue()&&u.getValue()&&(u.setValue(null),u.setPlaceholder(a.crop.height))}}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o=i.cropStatus,a=e.ref,c=a.inputImageWidth,l=a.inputImageHeight;if(!c.hasFocus()&&!l.hasFocus()){var u=e.query("GET_CROP_RECTANGLE_ASPECT_RATIO");if(null===c.getValue()&&null===l.getValue())c.setPlaceholder(o.crop.width),l.setPlaceholder(o.crop.height);else if(null===c.getValue()&&null!==o.image.height){var f=Math.round(o.image.height*u);c.setPlaceholder(f)}else if(null===l.getValue()&&null!==o.image.width){var s=Math.round(o.image.width/u);l.setPlaceholder(s)}}}})}),oo=function(t,e){return F({tag:"fieldset",create:function(n){var r=n.root,i=g("legend");i.textContent=t,r.element.appendChild(i),e({root:r})}})},ao=F({name:"resize",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="resize",n.hidden=!1,e.ref.isHiding=!1,e.ref.form=e.appendChildView(e.createChildView(io,{opacity:0,id:n.id}))},read:function(t){var e=t.root,n=t.props;if(!n.hidden){var r=e.rect;if(0!==r.element.width&&0!==r.element.height){var i=e.ref.form.rect;n.stagePosition={x:r.element.left,y:r.element.top+i.element.height,width:r.element.width,height:r.element.height-i.element.height}}}},shouldUpdateChildViews:function(t){var e=t.props,n=t.actions;return!e.hidden||e.hidden&&n&&n.length},write:z({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props;n.id===r.viewId?(e.ref.isHiding=!1,e.ref.form.opacity=1):(e.ref.isHiding=!0,e.ref.form.opacity=0)}},function(t){var e=t.root,n=t.props,r=e.ref,i=r.form,o=r.isHiding,a=n.hidden;o&&0===i.opacity&&!a?n.hidden=!0:n.hidden=!1})}),co=F({name:"range-input",tag:"span",mixins:{listeners:!0,apis:["onUpdate","setValue","getValue","setAllowInteraction"]},create:function(t){var e=t.root,n=t.props,r=n.id,i=n.min,o=n.max,a=n.step,c=n.value,l=n.onUpdate,u=void 0===l?function(){}:l,f="doka--".concat(r,"-").concat(ut()),s=g("input",{type:"range",id:f,min:i,max:o,step:a});s.value=c,e.ref.input=s;var d=g("span");d.className="doka--range-input-inner";var h=g("label",{for:f});h.innerHTML=n.label;var p=i+.5*(o-i);e.element.dataset.centered=c===p,e.ref.handleRecenter=function(){n.setValue(p),e.ref.handleChange()};var m=g("button",{type:"button"});m.textContent="center",m.addEventListener("click",e.ref.handleRecenter),e.ref.recenter=m,d.appendChild(s),d.appendChild(m),e.appendChild(h),e.appendChild(d),e.ref.handleChange=function(){var t=n.getValue();e.element.dataset.centered=t===p,u(t)},s.addEventListener("input",e.ref.handleChange);var y=null;e.ref.dragger=Rr(d,function(){y=s.getBoundingClientRect()},function(t){var n=(t.pageX-y.left)/y.width;s.value=i+n*(o-i),e.ref.handleChange()},function(){},{stopPropagation:!0}),n.getValue=function(){return parseFloat(s.value)},n.setValue=function(t){return s.value=t},n.setAllowInteraction=function(t){t?e.ref.dragger.enable():e.ref.dragger.disable()}},destroy:function(t){var e=t.root;e.ref.dragger.destroy(),e.ref.recenter.removeEventListener("click",e.ref.handleRecenter),e.ref.input.removeEventListener("input",e.ref.handleChange)}}),lo={brightness:{icon:pr('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="7"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></g>')},contrast:{icon:pr('<g fill="none" fill-rule="evenodd"><circle stroke="currentColor" stroke-width="3" cx="12" cy="12" r="10"/><path d="M12 2v20C6.477 22 2 17.523 2 12S6.477 2 12 2z" fill="currentColor"/></g>')},exposure:{icon:pr('<g fill="none" fill-rule="evenodd"><rect stroke="currentColor" stroke-width="3" x="2" y="2" width="20" height="20" rx="4"/><path d="M20.828 3.172L3.172 20.828A3.987 3.987 0 0 1 2 18V6a4 4 0 0 1 4-4h12c1.105 0 2.105.448 2.828 1.172zM7 7H5v2h2v2h2V9h2V7H9V5H7v2zM12 15h5v2h-5z" fill="currentColor"/></g>')},saturation:{icon:pr('<g fill="none" fill-rule="evenodd"><rect stroke="currentColor" stroke-width="3" x="2" y="2" width="20" height="20" rx="4"/><path fill="currentColor" opacity=".3" d="M7 2.5h5v18.75H7z"/><path fill="currentColor" opacity=".6" d="M12 2.5h5v18.75h-5z"/><path fill="currentColor" opacity=".9" d="M17 2.5h4v18.75h-4z"/></g>')}},uo=F({ignoreRect:!0,name:"color-form",tag:"form",mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:15}}},create:function(t){var e=t.root;e.element.setAttribute("novalidate","novalidate");var n=e.query("GET_COLOR_VALUES");e.ref.tools=Object.keys(lo).reduce(function(t,r){var i=r,o=lo[r].icon,a=e.query("GET_LABEL_COLOR_".concat(r.toUpperCase())),c=e.query("GET_COLOR_".concat(r.toUpperCase(),"_RANGE")),l=n[r];return t[i]={view:e.appendChildView(e.createChildView(co,{id:i,label:"".concat(o,"<span>").concat(a,"</span>"),min:c[0],max:c[1],step:.01,value:l,onUpdate:function(t){return e.dispatch("COLOR_SET_COLOR_VALUE",{key:i,value:t})}}))},t},{})},write:z({COLOR_SET_VALUE:function(t){var e=t.root,n=t.action;e.ref.tools[n.key].view.setValue(n.value)},SHOW_VIEW:function(t){var e=t.root,n=t.action;Object.keys(e.ref.tools).forEach(function(t){e.ref.tools[t].view.setAllowInteraction("color"===n.id)})}})}),fo=null,so=null,ho=function(t,e){var n=e.brightness,r=e.exposure,i=e.contrast,o=e.saturation;if(0!==n){var a=n<0,c=a?"multiply":"overlay",l=a?0:255,u=a?Math.abs(n):1-n;t.ref.imageOverlay.style.cssText="mix-blend-mode: ".concat(c,"; background: rgba(").concat(l,",").concat(l,",").concat(l,",").concat(u,")")}return t.ref.imageOverlay.style.cssText="background:transparent",t.ref.image.style.cssText="filter: brightness(".concat(r,") contrast(").concat(i,") saturate(").concat(o,")"),e},po=Object.keys(lo),go=function(t){return F({ignoreRect:!0,tag:"li",name:"filter-tile",mixins:{styles:["opacity","translateY"],animations:{translateY:{type:"spring",delay:10*t},opacity:{type:"spring",delay:30*t}}},create:function(t){var e=t.root,n=t.props,r="doka--filter-".concat(n.style,"-").concat(ut()),i=g("input",{id:r,type:"radio",name:"filter"});e.appendChild(i),i.checked=n.selected,i.value=n.style,i.addEventListener("change",function(){i.checked&&n.onSelect()});var o=g("label",{for:r});o.textContent=n.label,e.appendChild(o);var a=n.imageData,c=Math.min(a.width,a.height),l=c,u=g("canvas");u.width=c,u.height=l;var f=u.getContext("2d");e.ref.image=u;var s=g("div");e.ref.imageOverlay=s;var d={x:.5*c-.5*a.width,y:.5*l-.5*a.height},h=g("div");h.appendChild(u),h.appendChild(s),e.appendChild(h),e.ref.imageWrapper=h,n.matrix?(fo||(fo=xn(_n)),clearTimeout(so),fo.post({transforms:[{type:"filter",data:n.matrix}],imageData:a},function(t){f.putImageData(t,d.x,d.y),clearTimeout(so),so=setTimeout(function(){fo.terminate(),fo=null},1e3)},[a.data.buffer]),e.ref.activeColors=ho(e,e.query("GET_COLOR_VALUES"))):f.putImageData(a,d.x,d.y)},write:function(t){var e,n,r=t.root,i=r.query("GET_COLOR_VALUES"),o=r.ref.activeColors;(o||!i)&&(e=o,n=i,po.findIndex(function(t){return e[t]!==n[t]})<0)||(r.ref.activeColors=i,ho(r,i))}})},mo=function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(new Uint8ClampedArray(t.data)),e},yo=function(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every(function(t,n){return t===e[n]})};function vo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Eo=F({ignoreRect:!0,tag:"ul",name:"filter-list",mixins:{apis:["filterOpacity"]},create:function(t){var e=t.root,n=t.props;e.element.setAttribute("role","list"),e.ref.tiles=[];var r=e.query("GET_THUMB_IMAGE_DATA"),i=e.query("GET_FILTERS"),o=[];u(i,function(t,e){o.push(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){vo(t,e,n[e])})}return t}({id:t},e))}),e.ref.activeFilter=e.query("GET_FILTER"),e.ref.tiles=o.map(function(t,i){var o=t.matrix(),a=e.ref.activeFilter===t.id||yo(e.ref.activeFilter,o)||0===i;return e.appendChildView(e.createChildView(go(i),{opacity:0,translateY:-5,id:n.id,style:t.id,label:t.label,matrix:o,imageData:mo(r),selected:a,onSelect:function(){return e.dispatch("FILTER_SET_FILTER",{value:o?t.id:null})}}))})},write:function(t){var e=t.root,n=t.props,r=e.query("GET_FILTER");if(r!==e.ref.activeFilter){e.ref.activeFilter=r;var i=e.query("GET_FILTERS"),o=r?X(r)?r:Gn(r)?Object.keys(i).find(function(t){return yo(i[t].matrix(),r)}):null:"original";Array.from(e.element.querySelectorAll("input")).forEach(function(t){return t.checked=t.value===o})}e.query("IS_ACTIVE_VIEW","filter")?e.ref.tiles.forEach(function(t){t.opacity=1,t.translateY=0}):e.ref.tiles.forEach(function(t){t.opacity=0,t.translateY=-5}),n.filterOpacity=e.ref.tiles.reduce(function(t,e){return t+e.opacity},0)/e.ref.tiles.length}}),wo=F({name:"filter",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="filter",n.hidden=!1,e.ref.isHiding=!1,e.ref.filters=e.appendChildView(e.createChildView(Eo,{id:n.id}))},read:function(t){var e=t.root,n=t.props;if(e.ref.filters&&!n.hidden){var r=e.rect;if(0!==r.element.width&&0!==r.element.height){var i=e.ref.filters.rect,o=0===i.element.top,a=o?r.element.top+i.element.height:r.element.top,c=o?r.element.height-i.element.height:r.element.height-i.element.height-r.element.top;n.stagePosition={x:r.element.left+i.element.left,y:a,width:r.element.width-i.element.left,height:c}}}},shouldUpdateChildViews:function(t){var e=t.props,n=t.actions;return!e.hidden||e.hidden&&n&&n.length},write:z({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props;e.ref.filters&&(n.id===r.viewId?(e.ref.isHiding=!1,r.hidden=!1):e.ref.isHiding=!0)}},function(t){var e=t.root,n=t.props;e.ref.isHiding&&0===e.ref.filters.filterOpacity&&(e.ref.isHiding=!1,n.hidden=!0)})}),_o=F({name:"color",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="color",n.hidden=!1,e.ref.isHiding=!1,e.ref.form=e.appendChildView(e.createChildView(uo,{opacity:0,id:n.id}))},read:function(t){var e=t.root,n=t.props;if(!n.hidden){var r=e.rect;if(0!==r.element.width&&0!==r.element.height){var i=e.ref.form.rect,o=i.element.height,a=0===i.element.top,c=a?r.element.top+o:r.element.top,l=a?r.element.height-o:r.element.height-o-r.element.top;n.stagePosition={x:r.element.left+i.element.left,y:c,width:r.element.width-i.element.left,height:l}}}},shouldUpdateChildViews:function(t){var e=t.props,n=t.actions;return!e.hidden||e.hidden&&n&&n.length},write:z({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props;n.id===r.viewId?(e.ref.isHiding=!1,e.ref.form.opacity=1,r.hidden=!1):(e.ref.isHiding=!0,e.ref.form.opacity=0)}},function(t){var e=t.root,n=t.props;e.ref.isHiding&&0===e.ref.form.opacity&&(e.ref.isHiding=!1,n.hidden=!0)})}),To=F({ignoreRect:!0,tag:"ul",name:"markup-color",mixins:{animations:{opacity:"spring"},styles:["opacity"],apis:["onSelect","setSelectedValue"]},create:function(t){var e=t.root,n=t.props,r=n.colors,i=n.name,o=n.onSelect;n.setSelectedValue=function(t){e.ref.inputs.forEach(function(e){e.checked=e.value===t})},e.element.addEventListener("change",function(t){o(t.target.value),t.stopPropagation()}),e.ref.inputs=r.map(function(t){var n="doka--color-"+ut(),r=g("li"),o=g("input");o.id=n,o.setAttribute("type","radio"),o.setAttribute("name",i),o.value=t[1];var a=g("label");return a.setAttribute("for",n),a.textContent=t[0],a.title=t[0],a.style.backgroundColor=t[2]||t[1],r.appendChild(o),r.appendChild(a),e.element.appendChild(r),o})}});function bo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Oo=["fontFamily","fontSize","fontWeight","textAlign","backgroundColor","fontColor","borderColor","borderWidth","borderStyle","lineColor","lineWidth","lineDecoration","lineJoin","lineCap"],xo=function(t){return'<svg width="23" height="23" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">'.concat(t,"</svg>")},Ro=F({name:"markup-tools",ignoreRect:!0,mixins:{apis:["onUpdate"],animations:{translateY:"spring",opacity:"spring"},styles:["translateY","opacity"]},create:function(t){var e=t.root,n=t.props.onUpdate;e.ref.activeMarkup=null;var r=function(t){e.ref.activeMarkup&&n(e.ref.activeMarkup[1].id,t)};e.ref.colorSelect=e.appendChildView(e.createChildView(To,{onSelect:function(t){var n={};n[Ao(e.ref.activeMarkup[1])]=t,r(n)},name:"color-select",colors:e.query("GET_MARKUP_COLOR_OPTIONS")})),e.ref.shapeStyleSelect=e.appendChildView(e.createChildView(Hi,{onSelect:function(t){e.ref.shapeStyleSelect.selectedValue=t;var n=Io(e.ref.activeMarkup[1]),i=t[1],o=t[2],a=t[3]?null:n;r({borderWidth:i,borderStyle:o,backgroundColor:a,borderColor:n})},name:"tool",label:e.query("GET_LABEL_MARKUP_SELECT_SHAPE_STYLE"),direction:"up",options:e.query("GET_MARKUP_SHAPE_STYLE_OPTIONS").map(function(t){return{value:t,label:t[0],icon:(e=t[3],n=0===e?"currentColor":"none",r=e,xo('<rect stroke="'.concat(0===e?"none":"currentColor",'" fill="').concat(n,'" stroke-width="').concat(r,'" x="2" y="3" width="17" height="17" rx="3"/>')))};var e,n,r})})),e.ref.lineStyleSelect=e.appendChildView(e.createChildView(Hi,{onSelect:function(t){e.ref.lineStyleSelect.selectedValue=t;var n=t[1],i=t[2];r({lineWidth:n,lineStyle:i})},name:"tool",label:e.query("GET_LABEL_MARKUP_SELECT_LINE_STYLE"),direction:"up",options:e.query("GET_MARKUP_LINE_STYLE_OPTIONS").map(function(t){return{value:t,label:t[0],icon:(e=t[3],xo('<line stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width="'.concat(e,'" x1="3" y1="12" x2="20" y2="12"/>')))};var e})})),e.ref.lineDecorationSelect=e.appendChildView(e.createChildView(Hi,{onSelect:function(t){e.ref.lineDecorationSelect.selectedValue=t,r({lineDecoration:t})},name:"tool",label:e.query("GET_LABEL_MARKUP_SELECT_LINE_DECORATION"),direction:"up",options:e.query("GET_MARKUP_LINE_DECORATION_OPTIONS").map(function(t){return{value:t[1],label:t[0]}})})),e.ref.fontFamilySelect=e.appendChildView(e.createChildView(Hi,{onSelect:function(t){e.ref.fontFamilySelect.selectedValue=t,r({fontFamily:t})},name:"tool",label:e.query("GET_LABEL_MARKUP_SELECT_FONT_FAMILY"),direction:"up",options:e.query("GET_MARKUP_FONT_FAMILY_OPTIONS").map(function(t){return{value:t[1],label:'<span style="font-family:'.concat(t[1],';font-weight:600;">').concat(t[0],"</span>")}})})),e.ref.fontSizeSelect=e.appendChildView(e.createChildView(Hi,{onSelect:function(t){e.ref.fontSizeSelect.selectedValue=t,r({fontSize:t})},name:"tool",label:e.query("GET_LABEL_MARKUP_SELECT_FONT_SIZE"),direction:"up",options:e.query("GET_MARKUP_FONT_SIZE_OPTIONS").map(function(t){return{value:t[1],label:t[0]}})}))},write:z({MARKUP_SELECT:function(t){var e=t.root,n=t.action,r=e.ref,i=r.colorSelect,o=r.fontFamilySelect,a=r.fontSizeSelect,c=r.shapeStyleSelect,l=r.lineStyleSelect,u=r.lineDecorationSelect;e.ref.activeMarkup=n.id?e.query("GET_MARKUP_BY_ID",n.id):null;var f=[i,o,a,c,l,u],s=[];if(e.ref.activeMarkup){var d=bo(e.ref.activeMarkup,2),h=d[0],p=d[1],g=Array.isArray(p.allowEdit)?p.allowEdit:!1===p.allowEdit?[]:Oo,m=Oo.reduce(function(t,e){return t[e]=-1!==g.indexOf(e),t},{});if(m.color=!!g.find(function(t){return/[a-z]Color/.test(t)}),"image"!==h&&m.color&&(i.setSelectedValue(Io(p)),s.push(i)),"text"===h&&(m.fontFamily&&(o.selectedValue=p.fontFamily,s.push(o)),m.fontSize&&(a.selectedValue=p.fontSize,s.push(a))),("rect"===h||"ellipse"===h)&&m.borderStyle){var y=e.query("GET_MARKUP_SHAPE_STYLE_OPTIONS").find(function(t){var e=p.borderWidth===t[1],n=p.borderStyle===t[2]||yo(p.borderStyle,t[2]);return e&&n});c.selectedValue=y,s.push(c)}if("line"===h){if(m.lineWidth){var v=e.query("GET_MARKUP_LINE_STYLE_OPTIONS").find(function(t){var e=p.lineWidth===t[1],n=p.lineStyle===t[2]||yo(p.lineStyle,t[2]);return e&&n});l.selectedValue=v,s.push(l)}m.lineDecoration&&(u.selectedValue=p.lineDecoration,s.push(u))}f.forEach(function(t){t.element.dataset.active="false"}),s.forEach(function(t){t.element.dataset.active="true"})}}})}),Ao=function(t){return t.borderWidth?"borderColor":t.lineWidth?"lineColor":t.fontColor?"fontColor":t.backgroundColor?"backgroundColor":void 0},Io=function(t){var e=t.fontColor,n=t.backgroundColor,r=t.lineColor,i=t.borderColor;return e||n||r||i};function Co(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){So(t,e,n[e])})}return t}function So(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Mo=F({name:"markup",ignoreRect:!0,mixins:{apis:["viewId","stagePosition","hidden"]},create:function(t){var e=t.root,n=t.props;n.viewId="markup",n.hidden=!1,e.ref.isHiding=!1,e.ref.defaultRect={x:.5,y:.5,width:.25,height:.25};var r=function(){return.5*Math.random()-.25},i=function(){return Co({},e.ref.defaultRect,{x:e.ref.defaultRect.x-.5*e.ref.defaultRect.width+r(),y:e.ref.defaultRect.y-.5*e.ref.defaultRect.height+r()})},o=function(t){return e.query("GET_MARKUP_".concat(t,"_OPTIONS"))[e.query("GET_MARKUP_".concat(t,"_DEFAULT"))]},a=function(){return{backgroundColor:0===o("SHAPE_STYLE")[3]?o("COLOR")[1]:null,borderWidth:o("SHAPE_STYLE")[1],borderStyle:o("SHAPE_STYLE")[2]?o("SHAPE_STYLE")[2]:null,borderColor:o("COLOR")[1]}},c=[{view:hr,name:"tool",label:e.query("GET_LABEL_MARKUP_TYPE_RECTANGLE"),icon:pr('<g fill="currentColor"><rect x="5" y="5" width="16" height="16" rx="2"/></g>',26),action:function(){return e.dispatch("MARKUP_ADD",["rect",Co({},i(),a())])}},{view:hr,name:"tool",label:e.query("GET_LABEL_MARKUP_TYPE_ELLIPSE"),icon:pr('<g fill="currentColor"><circle cx="13" cy="13" r="9"/></g>',26),action:function(){return e.dispatch("MARKUP_ADD",["ellipse",Co({},i(),a())])}},{view:hr,name:"tool",label:e.query("GET_LABEL_MARKUP_TYPE_TEXT"),icon:pr('<g transform="translate(5 5)" fill="currentColor" fill-rule="evenodd"><<path d="M10 4v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4H1a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-5z"/></g>',26),action:function(){return e.dispatch("MARKUP_ADD",["text",Co({},i(),{width:0,height:0,fontColor:o("COLOR")[1],fontSize:o("FONT_SIZE")[1],fontFamily:o("FONT_FAMILY")[1],text:"Text"})])}},{view:hr,name:"tool",label:e.query("GET_LABEL_MARKUP_TYPE_LINE"),icon:pr('<g transform="translate(3 4.5)" fill-rule="nonzero" fill="currentColor" stroke="none"><path d="M15.414 9.414l-6.01 6.01a2 2 0 1 1-2.829-2.828L9.172 10H2a2 2 0 1 1 0-4h7.172L6.575 3.404A2 2 0 1 1 9.404.575l6.01 6.01c.362.363.586.863.586 1.415s-.224 1.052-.586 1.414z"/></g>',26),action:function(){return e.dispatch("MARKUP_ADD",["line",Co({},i(),{lineColor:o("COLOR")[1],lineWidth:o("LINE_STYLE")[1],lineStyle:o("LINE_STYLE")[2]?o("LINE_STYLE")[2]:null,lineDecoration:o("LINE_DECORATION")[1]})])}}];e.query("GET_MARKUP_ALLOW_ADD_MARKUP")&&(e.ref.menu=e.appendChildView(e.createChildView(Fi("toolbar",["opacity"],{opacity:{type:"spring",mass:15,delay:50}}),{opacity:0,controls:c}))),e.ref.tools=e.appendChildView(e.createChildView(Ro,{opacity:0,onUpdate:function(t,n){e.dispatch("MARKUP_UPDATE",{id:t,props:n})}})),e.ref.menuItemsRequiredWidth=null},read:function(t){var e=t.root,n=t.props;if(n.hidden)e.ref.menuItemsRequiredWidth=null;else{var r=e.rect;if(0!==r.element.width&&0!==r.element.height){if(e.ref.menu&&null===e.ref.menuItemsRequiredWidth){var i=e.ref.menu.childViews.reduce(function(t,e){return t+e.rect.outer.width},0);e.ref.menuItemsRequiredWidth=0===i?null:i}var o=e.ref.menu&&e.ref.menu.rect,a=e.ref.tools.rect.element.height,c=o?o.element.height:a,l=!o||0===o.element.top,u=l?r.element.top+c:r.element.top,f=l?r.element.height-c:r.element.height-c-r.element.top;n.stagePosition={x:r.element.left+20,y:u,width:r.element.width-40,height:f-a}}}},shouldUpdateChildViews:function(t){var e=t.props,n=t.actions;return!e.hidden||e.hidden&&n&&n.length},write:z({SHOW_VIEW:function(t){var e=t.root,n=t.action,r=t.props;n.id===r.viewId?(r.hidden=!1,e.ref.isHiding=!1,e.ref.menu&&(e.ref.menu.opacity=1)):(e.ref.isHiding=!0,e.ref.menu&&(e.ref.menu.opacity=0),e.ref.tools.opacity=0,e.ref.tools.translateY=5)},MARKUP_SELECT:function(t){var e=t.root,n=t.action;e.ref.tools.opacity=n.id?1:0,e.ref.tools.translateY=n.id?0:5,e.ref.tools.element.dataset.active=n.id?"true":"false"}},function(t){var e=t.root,n=t.props,r=t.timestamp;if(e.ref.isHiding&&e.ref.menu&&0===e.ref.menu.opacity&&(e.ref.isHiding=!1,n.hidden=!0),!n.hidden){var i=e.query("GET_CROP",n.id,r);if(i){var o=i.cropRect,a=o.height/o.width;e.ref.defaultRect.height=e.ref.defaultRect.width/a,e.ref.menu.element.dataset.layout=e.ref.menuItemsRequiredWidth>e.ref.menu.rect.element.width?"compact":"spacious"}}})});function Lo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Po={crop:to,resize:ao,filter:wo,color:_o,markup:Mo},Do=F({name:"view-stack",ignoreRect:!0,mixins:{apis:["offsetTop"]},create:function(t){var e=t.root;e.ref.activeView=null,e.ref.activeStagePosition=null,e.ref.shouldFocus=!1},write:z({SHOW_VIEW:function(t){var e=t.root,n=t.props,r=t.action,i=0===e.childViews.length,o=e.childViews.find(function(t){return t.viewId===r.id});o||(o=e.appendChildView(e.createChildView(Po[r.id],function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Lo(t,e,n[e])})}return t}({},n)))),e.ref.activeView=o,e.childViews.map(function(t){return t.element}).forEach(function(t){t.dataset.viewActive="false",t.removeAttribute("tabindex")});var a=e.ref.activeView.element;a.dataset.viewActive="true",a.setAttribute("tabindex",-1),e.ref.shouldFocus=!i},DID_PRESENT_IMAGE:function(t){var e=t.root;e.dispatch("CHANGE_VIEW",{id:e.query("GET_UTILS")[0]})},DID_SET_UTILS:function(t){var e=t.root;e.dispatch("CHANGE_VIEW",{id:e.query("GET_UTILS")[0]})}},function(t){var e,n,r=t.root,i=t.props,o=r.ref,a=o.activeView,c=o.previousStagePosition;if(a&&a.stagePosition&&(r.childViews.forEach(function(t){t.offsetTop=i.offsetTop,t.element.viewHidden!==t.hidden&&(t.element.viewHidden=t.hidden,t.element.dataset.viewHidden=t.hidden)}),e=a.stagePosition,n=c,!e||!n||!Gt(e,n))){var l=a.stagePosition,u=l.x,f=l.y,s=l.width,d=l.height;if(0===s&&0===d)return;r.dispatch("DID_RESIZE_STAGE",{offset:{x:u,y:f},size:{width:s,height:d},animate:!0}),r.ref.previousStagePosition=a.stagePosition}}),didWriteView:function(t){var e=t.root;e.ref.shouldFocus&&(e.ref.activeView.element.focus({preventScroll:!0}),e.ref.shouldFocus=!1)}}),ko=F({name:"content",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(t){var e=t.root,n=t.props;e.opacity=1,e.ref.viewStack=e.appendChildView(e.createChildView(Do,{id:n.id})),e.ref.image=null},write:z({DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.image=e.appendChildView(e.createChildView(hi,{id:n.id}))}},function(t){var e=t.root,n=e.ref,r=n.image,i=n.viewStack;if(r){var o=e.rect.element.top;i.offsetTop=o,r.offsetTop=o}})});function Go(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Uo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Vo=F({name:"utils",create:function(t){var e=t.root,n={crop:{title:e.query("GET_LABEL_BUTTON_UTIL_CROP"),icon:pr('<g fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" stroke-width="2"><path d="M23 17H9a2 2 0 0 1-2-2v-5m0-3V1"/><path d="M1 7h14a2 2 0 0 1 2 2v7m0 4v3"/></g>')},filter:{title:e.query("GET_LABEL_BUTTON_UTIL_FILTER"),icon:pr('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.347 9.907a6.5 6.5 0 1 0-1.872 3.306M3.26 11.574a6.5 6.5 0 1 0 2.815-1.417"/><path d="M10.15 17.897A6.503 6.503 0 0 0 16.5 23a6.5 6.5 0 1 0-6.183-8.51"/></g>')},color:{title:e.query("GET_LABEL_BUTTON_UTIL_COLOR"),icon:pr('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 1v5.5m0 3.503V23M12 1v10.5m0 3.5v8M20 1v15.5m0 3.5v3M2 7h4M10 12h4M18 17h4"/></g>')},markup:{title:e.query("GET_LABEL_BUTTON_UTIL_MARKUP"),icon:pr('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.086 2.914a2.828 2.828 0 1 1 4 4l-14.5 14.5-5.5 1.5 1.5-5.5 14.5-14.5z"/></g>')},resize:{title:e.query("GET_LABEL_BUTTON_UTIL_RESIZE"),icon:pr('<g fill="none" fill-rule="evenodd" stroke-width="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="12" width="10" height="10" rx="2"/><path d="M4 11.5V4a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-5.5"/><path d="M14 10l3.365-3.365M14 6h4v4" class="doka--icon-resize-arrow-ne"/><path d="M14 10l3.365-3.365M14 6v4h4" class="doka--icon-resize-arrow-sw"/></g>')}};e.ref.utils=Object.keys(n).map(function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Uo(t,e,n[e])})}return t}({id:t},n[t])}),e.ref.utilMenuRequiredWidth=null},read:function(t){var e=t.root;if(null===e.ref.utilMenuRequiredWidth){var n=e.childViews.reduce(function(t,e){return t+e.rect.outer.width},0);e.ref.utilMenuRequiredWidth=0===n?null:n}},write:z({DID_SET_UTILS:function(t){var e=t.root,n=Go(e.query("GET_UTILS"));e.childViews.forEach(function(t){return e.removeChildView(t)}),e.element.dataset.utilCount=n.length,1===n.length&&(n.length=0),n.forEach(function(t){var n=e.ref.utils.find(function(e){return e.id===t}),r=e.appendChildView(e.createChildView(hr,{name:"tab",view:hr,label:n.title,opacity:1,icon:n.icon,id:n.id,action:function(){return e.dispatch("CHANGE_VIEW",{id:n.id})}}));e.ref["util_button_".concat(n.id)]=r})},SHOW_VIEW:function(t){var e=t.root,n=t.action;e.childViews.forEach(function(t){t.element.dataset.active=t.id===n.id})}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o,a,c=i.cropStatus;e.ref.util_button_resize&&(o=e.ref.util_button_resize,a=c.image.width?c.image.width/c.crop.width:null,o.element.dataset.scaleDirection=null===a||a>1?"up":"down"),e.element.dataset.layout=e.ref.utilMenuRequiredWidth>e.rect.element.width?"compact":"spacious"}})}),Bo=wt()&&function(){try{var t={antialias:!1,alpha:!1},e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl",t)||e.getContext("experimental-webgl",t))}catch(t){return!1}}();function No(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){jo(t,e,n[e])})}return t}function jo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Fo=F({name:"container",create:function(t){var e=t.root,n=[{view:hr,opacity:0,label:e.query("GET_LABEL_BUTTON_RESET"),didCreateView:function(t){return e.ref.btnReset=t},name:"app action-reset icon-only",icon:pr('<g fill="currentColor" fill-rule="nonzero"><path d="M6.036 13.418L4.49 11.872A.938.938 0 1 0 3.163 13.2l2.21 2.209a.938.938 0 0 0 1.326 0l2.209-2.21a.938.938 0 0 0-1.327-1.326l-1.545 1.546zM12 10.216a1 1 0 0 1 2 0V13a1 1 0 0 1-2 0v-2.784z"/><path d="M15.707 14.293a1 1 0 0 1-1.414 1.414l-2-2a1 1 0 0 1 1.414-1.414l2 2z"/><path d="M8.084 19.312a1 1 0 0 1 1.23-1.577 6 6 0 1 0-2.185-3.488 1 1 0 0 1-1.956.412 8 8 0 1 1 2.912 4.653z"/></g>',26),action:function(){return e.dispatch("EDIT_RESET")}}];e.query("GET_ALLOW_BUTTON_CANCEL")&&n.unshift({view:hr,label:e.query("GET_LABEL_BUTTON_CANCEL"),name:"app action-cancel icon-fallback",opacity:1,icon:pr('<g fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></g>'),didCreateView:function(t){e.ref.btnCancel=t},action:function(){e.dispatch("EDIT_CANCEL")}}),n.push({view:Vo}),e.query("GET_ALLOW_BUTTON_CONFIRM")&&n.push({view:hr,label:e.query("GET_LABEL_BUTTON_CONFIRM"),name:"app action-confirm icon-fallback",opacity:1,icon:pr('<polyline fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="20 6 9 17 4 12"></polyline>'),didCreateView:function(t){e.ref.btnConfirm=t},action:function(){e.dispatch("EDIT_CONFIRM")}}),e.ref.menu=e.appendChildView(e.createChildView(Fi("menu"),{controls:n})),e.ref.menu.opacity=0,e.ref.status=e.appendChildView(e.createChildView(wr)),e.ref.hasWebGL=Bo,e.ref.hasWebGL?e.dispatch("AWAIT_IMAGE"):e.dispatch("MISSING_WEBGL"),e.ref.handleFocusOut=function(){var t=e.ref.status;"busy"===t.element.dataset.viewStatus&&t.element.focus()},e.ref.handleFocusIn=function(t){var n=e.ref,r=n.menu,i=n.content,o=t.target;if(!r.element.contains(o)&&i&&i.element.contains(o)){if(!Array.from(e.element.querySelectorAll("[data-view-active=false]")).reduce(function(t,e){return e.contains(o)&&(t=!0),t},!1))return;r.element.querySelector("button,input,[tabindex]").focus()}},e.element.addEventListener("focusin",e.ref.handleFocusIn),e.element.addEventListener("focusout",e.ref.handleFocusOut),e.ref.previousState=null},destroy:function(t){var e=t.root;e.element.removeEventListener("focusin",e.ref.handleFocusIn),e.element.removeEventListener("focusout",e.ref.handleFocusOut)},write:z({UNLOAD_IMAGE:function(t){var e=t.root;e.ref.content&&(e.ref.content.opacity=0,e.ref.menu.opacity=0)},DID_UNLOAD_IMAGE:function(t){var e=t.root;e.removeChildView(e.ref.content),e.ref.content=null},DID_LOAD_IMAGE:function(t){var e=t.root,n=t.props;e.ref.hasWebGL&&(e.ref.content=e.appendChildView(e.createChildView(ko,{opacity:null,id:n.id})),e.ref.menu.opacity=1)},SHOW_VIEW:function(t){var e=t.root,n=t.action;e.element.dataset.limitOverflow="resize"===n.id}},function(t){var e=t.root,n=t.props,r=t.timestamp,i=e.query("GET_CROP",n.id,r);if(i){var o={crop:{width:i.cropStatus.currentWidth,height:i.cropStatus.currentHeight}};zo(e.ref.previousState,o)&&(e.dispatch("DID_UPDATE",{state:No({},o)}),e.ref.previousState=o);var a=e.ref,c=a.btnCancel,l=a.content,u=i.canReset;if(e.ref.btnReset.opacity=u?1:0,c&&e.query("GET_UTILS").length>1){var f=e.query("GET_ROOT_SIZE");c.opacity=u&&f.width<600?0:1}l&&0===l.opacity&&e.dispatch("DID_UNLOAD_IMAGE")}})}),zo=function(t,e){return!t||(t.crop.width!==e.crop.width||t.crop.height!==e.crop.height)};function Wo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var qo=function(t){return t.preventDefault()},Yo=F({name:"editor",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}},apis:["markedForRemoval"]},create:function(t){var e=t.root,n=t.props;n.markedForRemoval=!1,e.element.addEventListener("touchmove",qo,{passive:!1}),e.element.addEventListener("gesturestart",qo),e.ref.pointerPolyfill=function(t){var e={destroy:function(){}};if("onpointerdown"in window||t.pointersPolyfilled)return e;t.pointersPolyfilled=!0;var n=0,r=[],i=function(t,e,n){var r=new UIEvent(e.type,{view:window,bubbles:!n});Object.keys(e).forEach(function(t){Object.defineProperty(r,t,{value:e[t],writable:!1})}),t.dispatchEvent(r)},o=function(t,e,o){return Array.from(e.changedTouches).map(function(a){var c=r[a.identifier],l={type:t,pageX:a.pageX,pageY:a.pageY,pointerId:a.identifier,isPrimary:c?c.isPrimary:0===n,preventDefault:function(){return e.preventDefault()}};return i(a.target,l,o),l})},a=function(t){o("pointerdown",t).forEach(function(t){r[t.pointerId]=t,n++})},c=function(t){o("pointermove",t)},l=function(t){o("pointerup",t).forEach(function(t){delete r[t.pointerId],n--})},u=function(t,e,n){var r={type:t,pageX:e.pageX,pageY:e.pageY,pointerId:0,isPrimary:!0,preventDefault:function(){return e.preventDefault()}};return i(e.target,r,n),r},f=function(t){u("pointerdown",t)},s=function(t){u("pointermove",t)},d=function(t){u("pointerup",t)};return"ontouchstart"in window?(t.addEventListener("touchstart",a),t.addEventListener("touchmove",c),t.addEventListener("touchend",l)):"onmousedown"in window&&(t.addEventListener("mousedown",f),t.addEventListener("mousemove",s),t.addEventListener("mouseup",d)),e.destroy=function(){r.length=0,t.pointersPolyfilled=!1,t.removeEventListener("touchstart",a),t.removeEventListener("touchmove",c),t.removeEventListener("touchend",l),t.removeEventListener("mousedown",f),t.removeEventListener("mousemove",s),t.removeEventListener("mouseup",d)},e}("root"===e.query("GET_POINTER_EVENTS_POLYFILL_SCOPE")?e.element:document.documentElement),e.appendChildView(e.createChildView(Fo,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Wo(t,e,n[e])})}return t}({},n)))},destroy:function(t){var e=t.root;e.ref.pointerPolyfill.destroy(),e.element.removeEventListener("touchmove",qo,!0),e.element.removeEventListener("gesturestart",qo)}});function Ho(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Zo=function(){function t(){e.fire("touch-detected"),window.removeEventListener("touchstart",t,!1)}var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ho(t,e,n[e])})}return t}({},ft(),{destroy:function(){window.removeEventListener("touchstart",t,!1)}});return window.addEventListener("touchstart",t,!1),e};function Xo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ko=function(t){var e,n={browseEnabled:!1},r=function(){e.files.length&&i.fire("drop",Array.from(e.files))},i=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Xo(t,e,n[e])})}return t}({},ft(),{enableBrowse:function(){n.browseEnabled||((e=document.createElement("input")).style.display="none",e.setAttribute("type","file"),e.addEventListener("change",r),t.appendChild(e),t.addEventListener("click",o),n.browseEnabled=!0)},disableBrowse:function(){n.browseEnabled&&(e.removeEventListener("change",r),e.parentNode.removeChild(e),t.removeEventListener("click",o),n.browseEnabled=!1)},destroy:function(){t.removeEventListener("dragover",a),t.removeEventListener("drop",c),t.removeEventListener("click",o),e.removeEventListener("change",r)}}),o=function(){return e.click()},a=function(t){return t.preventDefault()},c=function(t){t.preventDefault();var e=Array.from(t.dataTransfer.items||t.dataTransfer.files).map(function(t){return t.getAsFile&&"file"===t.kind?t.getAsFile():t});i.fire("drop",e)};return t.addEventListener("dragover",a),t.addEventListener("drop",c),i},Qo=function(t){return t.ref.isFullscreen},Jo=function(t){return/fullscreen/.test(t.query("GET_STYLE_LAYOUT_MODE"))},$o=function(t){return/fullscreen|preview/.test(t.query("GET_STYLE_LAYOUT_MODE"))},ta=function(t){return t.query("GET_ALLOW_AUTO_CLOSE")},ea=$o,na=$o,ra=function(t){var e=t.ref,n=e.environment,r=e.isSingleUtil,i=e.canBeControlled;t.element.dataset.styleViewport=ca(t.rect.element.width,t.rect.element.height)+" "+n.join(" ")+(r?" single-util":" multi-util")+(i?" flow-controls":" no-flow-controls")},ia=function(t){var e=t.element,n=t.ref,r=n.handleFullscreenUpdate,i=n.handleEscapeKey;e.setAttribute("tabindex",-1),r(),t.ref.focusTrap=function(t){var e=function(e){if(9===e.keyCode){var n=Array.from(t.querySelectorAll("button,input,[tabindex]")).filter(function(t){return"hidden"!==t.style.visibility&&-1!==t.tabIndex}),r=n[0],i=n[n.length-1];e.shiftKey?document.activeElement===r&&(i.focus(),e.preventDefault()):document.activeElement===i&&(r.focus(),e.preventDefault())}};return t.addEventListener("keydown",e),{destroy:function(){t.removeEventListener("keydown",e)}}}(e),e.addEventListener("keydown",i),window.addEventListener("resize",r),document.body.classList.add("doka--parent"),document.body.appendChild(e);var o=document.querySelector("meta[name=viewport]");t.ref.defaultViewportContent=o?o.getAttribute("content"):null,o||((o=document.createElement("meta")).setAttribute("name","viewport"),document.head.appendChild(o)),o.setAttribute("content","width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=0"),t.opacity=1,t.element.contains(document.activeElement)||e.focus(),t.dispatch("INVALIDATE_VIEWPORT"),t.ref.isFullscreen=!0},oa=function(t){var e=t.element,n=t.ref,r=n.handleFullscreenUpdate,i=n.focusTrap,o=n.handleEscapeKey;e.removeAttribute("tabindex"),i.destroy(),e.removeEventListener("keydown",o),window.removeEventListener("resize",r),document.body.classList.remove("doka--parent");var a=document.querySelector("meta[name=viewport]");t.ref.defaultViewportContent?(a.setAttribute("content",t.ref.defaultViewportContent),t.ref.defaultViewportContent=null):a.parentNode.removeChild(a),t.ref.isFullscreen=!1},aa=F({name:"root",ignoreRect:!0,mixins:{styles:["opacity"],animations:{opacity:{type:"tween",duration:350}}},create:function(t){var e=t.root,n=t.props;e.element.id=e.query("GET_ID")||"doka-".concat(n.id);var r=e.query("GET_CLASS_NAME");r&&e.element.classList.add(r),e.ref.environment=[],e.ref.shouldBeDestroyed=!1,e.ref.isClosing=!1,e.ref.isClosed=!1,e.ref.isFullscreen=!1,e.query("GET_ALLOW_DROP_FILES")&&(e.ref.catcher=Ko(e.element),e.ref.catcher.on("drop",function(t){t.forEach(function(t){e.dispatch("REQUEST_LOAD_IMAGE",{source:t})})})),e.ref.touchDetector=Zo(),e.ref.touchDetector.onOnce("touch-detected",function(){e.ref.environment.push("touch")}),e.ref.editor=e.appendChildView(e.createChildView(Yo,{id:n.id})),e.query("GET_STYLES").filter(function(t){return!q(t.value)}).map(function(t){var n=t.name,r=t.value;e.element.dataset[n]=r}),e.ref.updateViewport=function(){e.dispatch("INVALIDATE_VIEWPORT")},window.addEventListener("resize",e.ref.updateViewport),window.addEventListener("scroll",e.ref.updateViewport),e.ref.isSingleUtil=1===e.query("GET_UTILS").length,e.ref.canBeControlled=e.query("GET_ALLOW_BUTTON_CONFIRM")||e.query("GET_ALLOW_BUTTON_CANCEL"),ra(e);var i=document.createElement("div");i.style.cssText="position:fixed;height:100vh;top:0;",e.ref.measure=i,document.body.appendChild(i),e.ref.handleEscapeKey=function(t){27===t.keyCode&&e.dispatch("EDIT_CANCEL")},e.ref.initialScreenMeasureHeight=null,e.ref.handleFullscreenUpdate=function(){e.element.dataset.styleFullscreen=window.innerHeight===e.ref.initialScreenMeasureHeight},e.ref.clientRect={left:0,top:0}},read:function(t){var e=t.root,n=e.ref.measure;n&&(e.ref.initialScreenMeasureHeight=n.offsetHeight,n.parentNode.removeChild(n),e.ref.measure=null),e.ref.clientRect=e.element.getBoundingClientRect(),e.ref.clientRect.leftScroll=e.ref.clientRect.left+(window.scrollX||window.pageXOffset),e.ref.clientRect.topScroll=e.ref.clientRect.top+(window.scrollY||window.pageYOffset)},write:z({ENTER_FULLSCREEN:function(t){var e=t.root;ia(e)},EXIT_FULLSCREEN:function(t){var e=t.root;oa(e)},SHOW_VIEW:function(t){var e=t.root,n=t.action;e.element.dataset.view=n.id},DID_SET_STYLE_LAYOUT_MODE:function(t){var e=t.root,n=t.action;e.element.dataset.styleLayoutMode=n.value||"none",/fullscreen/.test(n.value)&&!/fullscreen/.test(n.prevValue)&&e.dispatch("ENTER_FULLSCREEN")},AWAITING_IMAGE:function(t){var e=t.root;e.ref.catcher&&e.query("GET_ALLOW_BROWSE_FILES")&&e.ref.catcher.enableBrowse()},DID_REQUEST_LOAD_IMAGE:function(t){var e=t.root;if(e.ref.catcher&&e.query("GET_ALLOW_BROWSE_FILES")&&e.ref.catcher.disableBrowse(),0===e.opacity&&(e.opacity=1),e.ref.isClosing=!1,e.ref.isClosed=!1,!Jo(e)||Qo(e)){var n=e.query("GET_STYLE_LAYOUT_MODE");null!==n&&"modal"!==n||e.element.parentNode||e.dispatch("SET_STYLE_LAYOUT_MODE",{value:("fullscreen "+(n||"")).trim()})}else e.dispatch("ENTER_FULLSCREEN")},DID_CANCEL:function(t){var e=t.root;ea(e)&&ta(e)&&e.dispatch("EDIT_CLOSE")},DID_CONFIRM:function(t){var e=t.root;ea(e)&&ta(e)&&e.dispatch("EDIT_CLOSE")},EDIT_CLOSE:function(t){var e=t.root;na(e)&&(e.opacity=e.opacity||1,e.opacity=0,e.ref.isClosed=!1,e.ref.isClosing=!0,e.query("GET_ALLOW_AUTO_DESTROY")&&(e.ref.shouldBeDestroyed=!0),Qo(e)&&e.dispatch("EXIT_FULLSCREEN"))},DID_SET_UTILS:function(t){var e=t.root;e.ref.isSingleUtil=1===e.query("GET_UTILS").length}},function(t){var e=t.root;ra(e);var n=e.query("GET_ROOT"),r=e.rect.element;n.width===r.width&&n.height===r.height&&n.y===e.ref.clientRect.top&&n.topScroll===e.ref.clientRect.topScroll||e.dispatch("UPDATE_ROOT_RECT",{rect:{x:e.ref.clientRect.left,y:e.ref.clientRect.top,left:e.ref.editor.rect.element.left,top:e.ref.editor.rect.element.top,leftScroll:e.ref.clientRect.leftScroll,topScroll:e.ref.clientRect.topScroll,width:e.rect.element.width,height:e.rect.element.height}})}),didWriteView:function(t){var e=t.root,n=e.ref,r=n.isClosed,i=n.isClosing,o=n.shouldBeDestroyed;!r&&i&&0===e.opacity&&(e.dispatch("DID_CLOSE"),e.ref.isClosed=!0,e.ref.isClosing=!1,Jo(e)&&e.element.parentNode&&document.body.removeChild(e.element),o&&e.dispatch("EDIT_DESTROY"))},destroy:function(t){var e=t.root;Qo(e)&&oa(e),Jo(e)&&e.element.parentNode&&document.body.removeChild(e.element),window.removeEventListener("resize",e.ref.updateViewport),e.ref.touchDetector.destroy(),e.ref.catcher&&e.ref.catcher.destroy()}}),ca=function(t,e){var n="";return 0===t&&0===e?"detached":(n+=e>t?"portrait":"landscape",(n+=t<=600?" x-cramped":t<=1e3?" x-comfortable":" x-spacious").trim())};function la(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ua(t,e,n[e])})}return t}function ua(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var fa=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Ot(),o=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=c({},t),i=[],o=[],a=function(t,e,n){n?o.push({type:t,data:e}):(s[t]&&s[t](e),i.push({type:t,data:e}))},l=function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return f[t]?(e=f)[t].apply(e,r):null},u={getState:function(){return c({},r)},processActionQueue:function(){var t=[].concat(i);return i.length=0,t},processDispatchQueue:function(){var t=[].concat(o);o.length=0,t.forEach(function(t){var e=t.type,n=t.data;a(e,n)})},dispatch:a,query:l},f={};e.forEach(function(t){f=c({},t(r),f)});var s={};return n.forEach(function(t){s=c({},t(a,l,r),s)}),u}((t={noImageTimeout:null,options:it(n)},ot(t),t),[we,lt(n)],[sr,ct(n)]);o.dispatch("SET_OPTIONS",{options:e});var l=function(){document.hidden||o.dispatch("KICK")};document.addEventListener("visibilitychange",l);var s=ut();o.dispatch("SET_UID",{id:s});var d=null,h=aa(o,{id:s}),p=!1,g={_read:function(){p||h._read()},_write:function(t){var e=o.processActionQueue().filter(function(t){return!/^SET_/.test(t.type)});p&&!e.length||(v(e),(p=h._write(t,e))&&o.processDispatchQueue(),e.find(function(t){return"EDIT_DESTROY"===t.type})&&E())}},m=function(t){return function(e){var n={type:t};return e?(e.hasOwnProperty("error")&&(n.error=a(e.error)?la({},e.error):e.error||null),e.hasOwnProperty("output")&&(n.output=e.output),e.hasOwnProperty("image")&&(n.image=e.image),e.hasOwnProperty("source")&&(n.source=e.source),e.hasOwnProperty("state")&&(n.state=e.state),n):n}},y={DID_CONFIRM:m("confirm"),DID_CANCEL:m("cancel"),DID_REQUEST_LOAD_IMAGE:m("loadstart"),DID_LOAD_IMAGE:m("load"),DID_LOAD_IMAGE_ERROR:m("loaderror"),DID_UPDATE:m("update"),DID_CLOSE:m("close"),DID_DESTROY:m("destroy"),DID_INIT:m("init")},v=function(t){t.length&&t.forEach(function(t){if(y[t.type]){var e=y[t.type];(Array.isArray(e)?e:[e]).forEach(function(e){setTimeout(function(){!function(t){var e=la({doka:w},t);delete e.type,h&&h.element.dispatchEvent(new CustomEvent("Doka:".concat(t.type),{detail:e,bubbles:!0,cancelable:!0,composed:!0}));var n=[];t.hasOwnProperty("error")&&n.push(t.error);var r=["type","error"];Object.keys(t).filter(function(t){return!r.includes(t)}).forEach(function(e){return n.push(t[e])}),w.fire.apply(w,[t.type].concat(n));var i=o.query("GET_ON".concat(t.type.toUpperCase()));i&&i.apply(void 0,n)}(e(t.data))},0)})}})},E=function(){w.fire("destroy",h.element),document.removeEventListener("visibilitychange",l),h._destroy(),o.dispatch("DID_DESTROY")},w=la({},ft(),g,function(t,e){var n={};return u(e,function(r){var i=X(e[r])?e[r]:r;n[r]={get:function(){return t.getState().options[i]},set:function(e){t.dispatch("SET_".concat(at(i,"_").toUpperCase()),{value:e})}}}),n}(o,n),{setOptions:function(t){return o.dispatch("SET_OPTIONS",{options:t})},setData:function(t){o.dispatch("SET_DATA",t)},getData:function(t){return new Promise(function(e,n){o.dispatch("GET_DATA",la({},t,{success:e,failure:n}))})},open:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){t&&o.dispatch("REQUEST_LOAD_IMAGE",{source:t,options:e,success:n,failure:r,resolveOnConfirm:!!e&&e.resolveOnConfirm})})},edit:function(t,e){return w.open(t,la({},e,{resolveOnConfirm:!0}))},save:function(t){return new Promise(function(e,n){o.dispatch("GET_DATA",la({},t,{success:e,failure:n}))})},clear:function(){return o.dispatch("REQUEST_REMOVE_IMAGE")},close:function(){return o.dispatch("EDIT_CLOSE")},destroy:E,insertBefore:function(t){r(h.element,t)},insertAfter:function(t){i(h.element,t)},appendTo:function(t){t.appendChild(h.element)},replaceElement:function(t){r(h.element,t),t.parentNode.removeChild(t),d=t},restoreElement:function(){d&&(i(d,h.element),h.element.parentNode.removeChild(h.element),d=null)},isAttachedTo:function(t){return!!h&&(h.element===t||d===t)},element:{get:function(){return h?h.element:null}}});return o.dispatch("DID_INIT"),f(w)};function sa(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var da=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Ot(),n={};return u(e,function(t,e){X(e)||(n[t]=e[0])}),fa(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){sa(t,e,n[e])})}return t}({},n,t))},ha=function(t){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return t.replace(new RegExp("".concat(e,"."),"g"),function(t){return t.charAt(1).toUpperCase()})}(t.replace(/^data-/,""))},pa=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];u(t.attributes,function(e){return n.push(t.attributes[e])});var r=n.filter(function(t){return t.name}).reduce(function(e,n){var r=s(t,n.name);return e[ha(n.name)]=r===n.name||r,e},{});return function t(e,n){u(n,function(n,r){u(e,function(t,i){var o=new RegExp(n);if(o.test(t)&&(delete e[t],!1!==r))if(X(r))e[r]=i;else{var c,l=r.group;a(r)&&!e[l]&&(e[l]={}),e[l][(c=t.replace(o,""),c.charAt(0).toLowerCase()+c.slice(1))]=i}}),r.mapping&&t(e[r.group],r.mapping)})}(r,e),r};function ga(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ma=function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){ga(t,e,n[e])})}return t}({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=pa(t,{"^class$":"className"});Object.keys(n).forEach(function(t){a(n[t])?(a(e[t])||(e[t]={}),Object.assign(e[t],n[t])):e[t]=n[t]}),"CANVAS"!==t.nodeName&&"IMG"!==t.nodeName||(e.src=t.dataset.dokaSrc?t.dataset.dokaSrc:t);var r=da(e);return r.replaceElement(t),r};function ya(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var va=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e[0]instanceof HTMLElement?ma.apply(void 0,e):da.apply(void 0,ya(e.filter(function(t){return t})))},Ea=["fire","_read","_write"],wa=function(t){var e,n,r,i={};return e=t,n=i,r=Ea,Object.getOwnPropertyNames(e).filter(function(t){return!r.includes(t)}).forEach(function(t){return Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}),i};n.d(e,"supported",function(){return Ta}),n.d(e,"OptionTypes",function(){return xa}),n.d(e,"create",function(){return Ra}),n.d(e,"destroy",function(){return Aa}),n.d(e,"parse",function(){return Ia}),n.d(e,"find",function(){return Ca}),n.d(e,"getOptions",function(){return Sa}),n.d(e,"setOptions",function(){return Ma});var _a,Ta=(_a=wt()&&!("[object OperaMini]"===Object.prototype.toString.call(window.operamini))&&"visibilityState"in document&&"Promise"in window&&"slice"in Blob.prototype&&"URL"in window&&"createObjectURL"in window.URL&&"performance"in window,function(){return _a}),ba={apps:[]},Oa=function(){},xa={},Ra=Oa,Aa=Oa,Ia=Oa,Ca=Oa,Sa=Oa,Ma=Oa;if(Ta()){!function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,r="__framePainter";if(window[r])return window[r].readers.push(t),void window[r].writers.push(e);window[r]={readers:[t],writers:[e]};var i=window[r],o=1e3/n,a=null,c=null,l=null,u=null,f=function(){document.hidden?(l=function(){return window.setTimeout(function(){return s(performance.now())},o)},u=function(){return window.clearTimeout(c)}):(l=function(){return window.requestAnimationFrame(s)},u=function(){return window.cancelAnimationFrame(c)})};document.addEventListener("visibilitychange",function(){u&&u(),f(),s(performance.now())});var s=function t(e){c=l(t),a||(a=e);var n=e-a;n<=o||(a=e-n%o,i.readers.forEach(function(t){return t()}),i.writers.forEach(function(t){return t(e)}))};f(),s(performance.now())}(function(){ba.apps.forEach(function(t){return t._read()})},function(t){ba.apps.forEach(function(e){return e._write(t)})});var La=function t(){document.dispatchEvent(new CustomEvent("doka:loaded",{detail:{supported:Ta,create:Ra,destroy:Aa,parse:Ia,find:Ca,setOptions:Ma}})),document.removeEventListener("DOMContentLoaded",t)};"loading"!==document.readyState?setTimeout(function(){return La()},0):document.addEventListener("DOMContentLoaded",La);xa={},u(Ot(),function(t,e){xa[t]=e[1]}),Ra=function(){var t=va.apply(void 0,arguments);return t.on("destroy",Aa),ba.apps.push(t),wa(t)},Aa=function(t){var e=ba.apps.findIndex(function(e){return e.isAttachedTo(t)});return e>=0&&(ba.apps.splice(e,1)[0].restoreElement(),!0)},Ia=function(t){return Array.from(t.querySelectorAll(".".concat("doka"))).filter(function(t){return!ba.apps.find(function(e){return e.isAttachedTo(t)})}).map(function(t){return Ra(t)})},Ca=function(t){var e=ba.apps.find(function(e){return e.isAttachedTo(t)});return e?wa(e):null},Sa=function(){var t={};return u(Ot(),function(e,n){t[e]=n[0]}),t},Ma=function(t){return a(t)&&(ba.apps.forEach(function(e){e.setOptions(t)}),function(t){u(t,function(t,e){Rt[t]&&xt(t,e)})}(t)),Sa()}}}])});